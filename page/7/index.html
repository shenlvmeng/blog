<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/favicon.png">
  <link rel="mask-icon" href="/blog/favicon.png" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shenlvmeng.github.com","root":"/blog/","images":"/blog/images","scheme":"Muse","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"N573WZGUR1","apiKey":"f4b654279103617a4cefb92a132ff0c3","indexName":"blog","hits":{"per_page":10}}}</script><script src="/blog/js/config.js"></script>

    <meta name="description" content="Be sharp, my friend.">
<meta property="og:type" content="website">
<meta property="og:title" content="Shenlvmeng&#39;s Blog">
<meta property="og:url" content="http://shenlvmeng.github.com/blog/page/7/">
<meta property="og:site_name" content="Shenlvmeng&#39;s Blog">
<meta property="og:description" content="Be sharp, my friend.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="shenlvmeng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://shenlvmeng.github.com/blog/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Shenlvmeng's Blog</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Shenlvmeng's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="shenlvmeng"
      src="/blog/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">shenlvmeng</p>
  <div class="site-description" itemprop="description">Be sharp, my friend.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">153</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">470</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/shenlvmeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shenlvmeng" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/shenlvmeng" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;shenlvmeng" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://shenlvmeng.github.com/blog/2020/06/01/principles-of-macroeconomics-terms/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
      <meta itemprop="name" content="shenlvmeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shenlvmeng's Blog">
      <meta itemprop="description" content="Be sharp, my friend.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Shenlvmeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/06/01/principles-of-macroeconomics-terms/" class="post-title-link" itemprop="url">《经济学原理》 - 宏观经济学原理笔记 附：术语</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-01 23:55:58" itemprop="dateCreated datePublished" datetime="2020-06-01T23:55:58+08:00">2020-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-08-04 22:51:27" itemprop="dateModified" datetime="2020-08-04T22:51:27+08:00">2020-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%80%9D%E8%80%83/" itemprop="url" rel="index"><span itemprop="name">思考</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2020/06/01/principles-of-macroeconomics-terms/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/06/01/principles-of-macroeconomics-terms/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>正文：<a target="_blank" rel="noopener" href="//shenlvmeng.github.io/blog/2020/06/01/principles-of-macroeconomics/">《经济学原理》 - 宏观经济学原理笔记</a></p>
</blockquote>
<h2 id="宏观经济学的数据"><a href="#宏观经济学的数据" class="headerlink" title="宏观经济学的数据"></a>宏观经济学的数据</h2><h3 id="一国收入的衡量"><a href="#一国收入的衡量" class="headerlink" title="一国收入的衡量"></a>一国收入的衡量</h3><ul>
<li>微观经济学：研究家庭和企业如何做出决策，以及它们如何在市场上相互影响</li>
<li>宏观经济学：研究整体经济现象，包括通货膨胀、失业和经济增长</li>
<li>国内生产总值（gross domestic product，GDP）：在某一既定时期一个国家内生产的所有最终物品和服务的市场价值</li>
<li>消费：家庭处购买新住房外用于物品和服务的支出</li>
<li>投资：用于资本设备、存活、建筑物的支出</li>
<li>净出口：外国人对国内生产物品的支出减国内居民对外国物品的支出</li>
<li>名义GDP：按现期价格评价的物品和服务的生产</li>
<li>真实GDP：按不变价格评价的物品和服务的生产</li>
<li>GDP平减指数：用名义GDP与真实GDP的比率乘以100得到的物价水平衡量指标</li>
</ul>
<h3 id="生活费用的衡量"><a href="#生活费用的衡量" class="headerlink" title="生活费用的衡量"></a>生活费用的衡量</h3><ul>
<li>消费物价指数（CPI）：普通消费者所购买的物品和服务的总费用的衡量指标</li>
<li>通货膨胀率：从前一个时期以来，物价指数变动的百分比</li>
<li>生产物价指数：企业所购买的一揽子物品与服务的费用的衡量指标</li>
<li>指数化：根据法律或合同按照通货膨胀的影响对货币数量的自动调整</li>
<li>名义利率：通常公布的、为根据通货膨胀影响校正的利率</li>
<li>真实利率：根据通货膨胀影响校正过的利率</li>
</ul>
<h2 id="长期中的真实经济"><a href="#长期中的真实经济" class="headerlink" title="长期中的真实经济"></a>长期中的真实经济</h2><h3 id="生产与增长"><a href="#生产与增长" class="headerlink" title="生产与增长"></a>生产与增长</h3><ul>
<li>生产率：每单位劳动投入所生产的物品和服务的数量</li>
<li>收益递减：随着投入量的增加，每一单位额外投入得到的收益减少的特性</li>
<li>追赶效应：开始贫穷的国家倾向于比开始富裕的国家增长更快的特征</li>
</ul>
<h3 id="储蓄、投资和金融体系"><a href="#储蓄、投资和金融体系" class="headerlink" title="储蓄、投资和金融体系"></a>储蓄、投资和金融体系</h3><ul>
<li>金融体系：经济中促使一个人的储蓄和另一个人的投资相匹配的一组机构</li>
<li>金融市场：储蓄者可以借以直接向借款者提供资金的金融机构</li>
<li>债券：一种债务证明书</li>
<li>股票：企业部分所有权的索取权</li>
<li>金融中介机构：储蓄者借以间接向借款者提供资金的金融机构</li>
<li>共同基金：向公共出售股份，并用收入来购买股票和债券资产组合的机构</li>
<li>国民储蓄（储蓄），用于消费和政府购买后剩下的一个经济中的总收入</li>
<li>私人储蓄：家庭支付税收和消费后剩下的收入</li>
<li>公共储蓄：政府在支付支出后剩下的税收收入</li>
<li>预算盈余：税收收入大于政府支出的余额</li>
<li>预算赤字：政府支出引起的税收收入短缺</li>
<li>可贷资金市场：想储蓄的人借以提供资金、想借钱投资的人借以借贷资金的市场</li>
<li>挤出：政府借款引起的投资减少</li>
</ul>
<h3 id="金融学基本工具"><a href="#金融学基本工具" class="headerlink" title="金融学基本工具"></a>金融学基本工具</h3><ul>
<li>金融学：研究人们如何在某时期内做出关于配置资源和应对风险的决策的学科</li>
<li>现值：用现行利率产生一定量未来货币所需要的现在货币量</li>
<li>终值：现行利率既定时，现在货币量将带来的未来货币量</li>
<li>复利：货币量的累积，赚得的利润停留在账户中赚取更多利息</li>
<li>风险厌恶：不喜欢不确定性</li>
<li>多元化：通过用大量<strong>不相关</strong>的小风险代替一种风险来降低风险</li>
<li>企业特有风险：只影响单独公司的风险</li>
<li>市场风险：影响股市上所有公司的风险</li>
<li>基本面分析：为决定一家公司的价值而对其会计报表和未来前景进行的研究</li>
<li>有效市场假说：认为资产价格反映了关于一种资产价值的所有公开、可获得的信息的理论</li>
<li>信息有效：以理性方式反映所有可获得信息的关于资产价格的描述</li>
</ul>
<h3 id="失业"><a href="#失业" class="headerlink" title="失业"></a>失业</h3><ul>
<li>劳动力：就业者和失业者的工人总数</li>
<li>失业率：劳动力中失业者所占比例</li>
<li>劳动力参工率：劳动力占成年人口的百分比</li>
<li>自然失业率：失业率曲线围绕波动的正常失业率</li>
<li>周期性失业：失业率对自然失业率的周期性背离</li>
<li>丧失信心的工人：想工作但已放弃寻找工作的人</li>
<li>摩擦性失业：由于工人寻找符合自己嗜好和技能的工作需要时间带来的失业</li>
<li>结构性失业：由于劳动市场提供的工作岗位不足或工资高于均衡工资引起的失业</li>
<li>失业保险：工人失业时，位置提供部分收入保障的政府计划</li>
<li>工会：与雇主就工资、津贴、工作条件进行谈判的工人协会</li>
<li>集体谈判：工会和企业就就业条件达成一致的过程</li>
<li>效率工资：企业为了提供工人生产率而支付的高于均衡水平的工资</li>
</ul>
<h2 id="长期中的货币与物价"><a href="#长期中的货币与物价" class="headerlink" title="长期中的货币与物价"></a>长期中的货币与物价</h2><h3 id="货币制度"><a href="#货币制度" class="headerlink" title="货币制度"></a>货币制度</h3><ul>
<li>货币：经济中人们经常用于向其他人购买物品和服务的一组资产</li>
<li>交互媒介：卖者在购买物品和服务时给予卖者的东西</li>
<li>计价单位：人们用来表示价格和记录债务的标准</li>
<li>价值储藏手段：人们用来把现在的购买力转变为未来购买力的东西</li>
<li>流动性：一种资产兑换为经济中交换媒介的容易程度</li>
<li>商品货币：以由内在价值的商品为形式的货币</li>
<li>法定货币：没有内在价值、由政府法令确定通货使用的货币</li>
<li>通货：公众手中持有的纸币钞票和铸币</li>
<li>中央银行：为了监管银行体系和调节经济中货币量设计的机构</li>
<li>准备金：银行得到但是没有贷出去的存款</li>
<li>部分准备金银行：只把部分存款作为准备金的银行</li>
<li>准备金率：作为准备金持有的存款比例</li>
<li>货币乘数：银行体系有1单位准备金产生的货币量</li>
<li>银行资本：银行的所有者投入机构的资源</li>
<li>杠杆：将借到的货币追加到投资的现有资金上</li>
<li>杠杆率：资产和银行资本的比率</li>
<li>资本需要量：政府管制确定的最低银行资本量</li>
<li>公开市场操作：美联储买卖美国政府债券</li>
<li>贴现率：美联储向银行发放贷款的利率</li>
<li>法定准备金：银行必须根据其存款持有的最低准备金量的规定</li>
<li>联邦基准利率：银行向另一家银行进行隔夜贷款时的利率</li>
</ul>
<h3 id="货币增长和通货膨胀"><a href="#货币增长和通货膨胀" class="headerlink" title="货币增长和通货膨胀"></a>货币增长和通货膨胀</h3><ul>
<li>货币数量论：一种认为可得到的货币量决定物价水平，可得到货币量增长率决定通货膨胀率的理论</li>
<li>名义变量：按货币单位衡量的变量</li>
<li>真实变量：按实物单位衡量的变量</li>
<li>古典二分法：名义变量和真实变量的理论区分</li>
<li>货币流通速度：货币易手的速度</li>
<li>通货膨胀税：政府通过创造货币而筹集的收入</li>
<li>费雪效应：名义利率对通货膨胀率所进行的一对一的调整</li>
<li>皮鞋成本：当通货膨胀鼓励人们减少货币持有量时所浪费的资源</li>
<li>菜单成本：改变价格的成本</li>
</ul>
<h2 id="面向开放经济的宏观经济学"><a href="#面向开放经济的宏观经济学" class="headerlink" title="面向开放经济的宏观经济学"></a>面向开放经济的宏观经济学</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul>
<li>封闭经济：不与世界上其他经济交易的经济</li>
<li>开放经济：与其他经济交易的经济</li>
<li>出口：在国内生产国外销售的物品和服务</li>
<li>进口：在国外生产国内销售的物品和服务</li>
<li>净出口：一国出口值减进口值，又称<em>贸易余额</em></li>
<li>贸易赤字：进口大于出口</li>
<li>资本净流出：本国居民购买的外国资产减去外国人购买的本国资产</li>
<li>名义汇率：用一国通货交换另一国通货的比率</li>
<li>升值：能购买到外国通货量衡量的一国通货的价值增加</li>
<li>贬值：能购买到外国通货量衡量的一国通货的价值降低</li>
<li>购买力平价：一种认为任何一单位通货应该能在所有国家买到等量物品的汇率理论</li>
</ul>
<h3 id="宏观经济理论"><a href="#宏观经济理论" class="headerlink" title="宏观经济理论"></a>宏观经济理论</h3><ul>
<li>贸易政策：直接影响一国进口或出口的物品与服务数量的政府政策</li>
<li>资本外逃：一国资产需求大量且突然地减少</li>
</ul>
<h2 id="短期经济波动"><a href="#短期经济波动" class="headerlink" title="短期经济波动"></a>短期经济波动</h2><h3 id="解释短期经济波动"><a href="#解释短期经济波动" class="headerlink" title="解释短期经济波动"></a>解释短期经济波动</h3><ul>
<li>衰退：真实收入下降和失业增加的时期</li>
<li>萧条：严重的衰退</li>
<li>自然产出水平：一个经济在长期中当失业处于正常时达到的物品与服务的生成水平</li>
<li>滞涨：产量减少而物价上升的时期</li>
</ul>
<h3 id="货币政策和财政政策对总需求的影响"><a href="#货币政策和财政政策对总需求的影响" class="headerlink" title="货币政策和财政政策对总需求的影响"></a>货币政策和财政政策对总需求的影响</h3><ul>
<li>流动性偏好理论：凯恩斯认为，利率的调整使货币供给与需求平衡</li>
<li>财政政策：政府决策者对政府支出和税收水平的确定</li>
<li>乘数效应：扩张性财政政策增加收入的同时增加消费支出引起总需求的额外变动</li>
<li>挤出效应：扩张性财政政策引起利率上升，从而减少投资支出引起的总需求减少</li>
<li>自动稳定器：经济进入衰退时，决策者不必采取任何行动就可以刺激总需求的财政政策变动（如税制、政府支出）</li>
</ul>
<h3 id="通货膨胀和失业间的短期权衡"><a href="#通货膨胀和失业间的短期权衡" class="headerlink" title="通货膨胀和失业间的短期权衡"></a>通货膨胀和失业间的短期权衡</h3><ul>
<li>菲利普斯曲线：表示通货膨胀和失业间短期关系的曲线</li>
<li>自然率假说：认为无论通货膨胀如何，失业都要回到正常率或自然率的观点</li>
<li>牺牲率：通货膨胀降低一个百分比过程中每年产量损失的百分比数</li>
<li>理性预期：人们能充分利用他们可以获取到的全部信息，如政策信息等，用来预测未来</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://shenlvmeng.github.com/blog/2020/06/01/principles-of-macroeconomics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
      <meta itemprop="name" content="shenlvmeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shenlvmeng's Blog">
      <meta itemprop="description" content="Be sharp, my friend.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Shenlvmeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/06/01/principles-of-macroeconomics/" class="post-title-link" itemprop="url">《经济学原理》 - 宏观经济学原理笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-01 23:55:46" itemprop="dateCreated datePublished" datetime="2020-06-01T23:55:46+08:00">2020-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-07-30 17:13:21" itemprop="dateModified" datetime="2020-07-30T17:13:21+08:00">2020-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%80%9D%E8%80%83/" itemprop="url" rel="index"><span itemprop="name">思考</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2020/06/01/principles-of-macroeconomics/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/06/01/principles-of-macroeconomics/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>30 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="宏观经济学中的数据"><a href="#宏观经济学中的数据" class="headerlink" title="宏观经济学中的数据"></a>宏观经济学中的数据</h2><h3 id="一国收入的衡量"><a href="#一国收入的衡量" class="headerlink" title="一国收入的衡量"></a>一国收入的衡量</h3><p>微观经济学研究家庭和企业如何做决策，宏观经济学研究整个经济，本章主要考察<strong>国内生产总值（GDP）</strong>。</p>
<p>GDP<strong>同时衡量着经济中所有人的总支出和总收入</strong>。因为对于一个整体经济来说，收入必定等于支出。</p>
<h4 id="衡量方式"><a href="#衡量方式" class="headerlink" title="衡量方式"></a>衡量方式</h4><p><strong>国内生产总值是在一个既定时期一个国家内生产的所有最终物品和服务的市场价值</strong>。</p>
<ul>
<li>既定时期：一般是一个季度公布一次，统计时会调整季度数据，避开季节性周期</li>
<li>一个国家内：GDP衡量的生产价值局限于一个国家的地理范围内。即外国人在本国的工作产出会计入GDP，但是本国人在外国的产出则不会</li>
<li>所有：GDP包括经济中生产并在市场上合法出售的所有物品，如家庭内生产和消费没有进入市场的这种则不会被计入</li>
<li>生产的：不包括过去生产的物品交易，比如二手车</li>
<li>最终：GDP只包括最终物品，而不包含中间物品。当然如果生产出来的中间物品没有被使用，而是增加了企业存货，这时可以暂时算作最终物品</li>
<li>物品和服务：实体物品和无形服务</li>
<li>市场价值：市场价格能反映物品的价值，如鱼子酱就是比汉堡包要贵</li>
</ul>
<p>上面这种描述是从支出出发，也可以从收入角度出发。还有几个和GDP类似的指标：</p>
<ul>
<li>GNP：国民生产总值，一国永久居民赚到的收入</li>
<li>NNP：国民生产净值，是GNP减去折旧</li>
<li>国民收入：一国居民在物品和服务生产中赚到的总收入，几乎和NNP相等</li>
<li>个人收入：家庭和非公司制企业得到的收入，和国民收入不同，它不包括留存收益——公司获得但是没有支付给所得者的收入</li>
<li>个人可支配收入：个人收入扣减对政府的义务后剩下的收入，如个税、非税收支付</li>
</ul>
<h4 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h4><p>Y &#x3D; C + I + G + NX</p>
<p>其中Y是GDP，C是消费，I是投资，G是政府购买，NX是净出口。</p>
<ul>
<li>消费：家庭<strong>除购买新住房外</strong>用于物品和服务的支出，也包括教育支出。</li>
<li>投资：对用于未来生产更多物品和服务的物品的购买，把汗家庭用于购买新住房的支出</li>
<li>政府购买：包括地方、州、政府用于物品和服务的支出，一部分“转移支付”，如社会保障补助，不计入考虑</li>
<li>净出口：外国与国内生产的物品的购买减去国内对外国物品的购买</li>
</ul>
<h4 id="真实GDP和名义GDP"><a href="#真实GDP和名义GDP" class="headerlink" title="真实GDP和名义GDP"></a>真实GDP和名义GDP</h4><p>GDP的增长来自两种形式：</p>
<ul>
<li>生产了更多的物品的服务</li>
<li>物品和服务的价格增高</li>
</ul>
<p><strong>真实GDP</strong>去掉了物价水平的增长部分，使用<strong>固定在过去水平</strong>上的价格评价现期生产。真实GDP首先需要选择一个<strong>基年</strong>，然后用基年的价格计算各年的物品和服务的价值。由于真实GDP不受价格变动的影响，所以只会反映<em>产量</em>的变动。真实GDP作为衡量经济福利的指标要优于名义GDP。</p>
<p>对应的有<strong>GDP平减指数</strong>的概念，用于衡量物价水平。它等于名义GDP除以真实GDP再乘以100。通常我们用<strong>通货膨胀</strong>来描述经济中整体物价水平上升的情况。通货膨胀率是一个时期到下一个时期某个物价水平衡量指标变动的百分比。它可以由两年的GDP平减指数推算出来。</p>
<h4 id="GDP能衡量幸福吗"><a href="#GDP能衡量幸福吗" class="headerlink" title="GDP能衡量幸福吗"></a>GDP能衡量幸福吗</h4><p>GDP是个好指标，但是不是全面的指标。大多数人都希望有更高的收入和支出，人均GDP自然成为平均经济福利的衡量指标。然后在闲暇、环境质量、收入分配等方面，GDP并不能作为唯一的衡量因素。不过，GDP倒是衡量我们追求这些方面的能力。</p>
<h3 id="生活费用的衡量"><a href="#生活费用的衡量" class="headerlink" title="生活费用的衡量"></a>生活费用的衡量</h3><p>消费物价指数可以比较好地反映消费者购买的物品和服务，是较常用的通货膨胀指标。</p>
<h4 id="消费物价指数（CPI）"><a href="#消费物价指数（CPI）" class="headerlink" title="消费物价指数（CPI）"></a>消费物价指数（CPI）</h4><p>消费物价指数（Customer Price Index，CPI）是普通消费者所购买的物品和服务的总费用的衡量指标。一般由国家统计局统计并发布，包含下面几步：</p>
<ul>
<li>确定“篮子”：即根据购买数量的多少，确定哪些物价对普通消费者是最重要的，订下不同物品的权数</li>
<li>找出价格：确定时间点上的物品物价</li>
<li>计算不同权数下所有物品的总费用</li>
<li>选择基年并计算指数</li>
<li>通过CPI的增长率确定通货膨胀率</li>
</ul>
<p>一般在统计CPI的同时，也会统计生产物价指数，即衡量企业而不是消费者购买的一篮子物品与服务的费用，由于企业最终会把这些费用以更高价格转移给消费者，它对于预测CPI的变动是有意义的。在使用CPI的时候会遇到3个问题:</p>
<ul>
<li>CPI无法衡量消费者的<em>替代偏好</em>，即使用便宜的物品替代昂贵的物品</li>
<li>CPI无法衡量新物品的引进带来的生活费用下降</li>
<li>CPI无法衡量质量的变动</li>
</ul>
<p>CPI和GDP平减指数比较相似，都可以衡量物价的变化，但由于计算方式的不同，两个数字还是有所差异：</p>
<ul>
<li>GDP平减指数反映了<strong>国内生产</strong>的物品和服务的价格，而CPI反映<strong>消费者购买</strong>的物品和服务，如波音生产的飞机会影响GDP，但不会影响CPI；石油价格的上涨对CPI影响很大，但是对GDP影响较小</li>
<li>GDP平减指数在加权时跟<strong>现期生产</strong>的所有物品和服务的比例有关，而CPI则是通过<strong>固定篮子</strong>的物品和服务的价格来计算</li>
</ul>
<h4 id="根据通货膨胀校正经济变量"><a href="#根据通货膨胀校正经济变量" class="headerlink" title="根据通货膨胀校正经济变量"></a>根据通货膨胀校正经济变量</h4><ul>
<li>衡量物价水平的目的之一是能让我们比较不同时期的美元数字。使用物价水平指数换算就可以比较不同时代明星的薪水或是电影的票房。</li>
<li>当某货币量根据法律或合同<strong>自动</strong>按物价水平变动校正时，成为通货膨胀的<strong>指数化</strong></li>
<li>储蓄时，<strong>名义利率</strong>只衡量货币量的变动，<strong>真实利率</strong>是根据通货膨胀校正后的衡量货币<strong>购买力</strong>变动的利率。除非通货紧缩，否则名义利率永远大于真实利率<ul>
<li><strong>真实利率 &#x3D; 名义利率 - 通货膨胀率</strong></li>
</ul>
</li>
</ul>
<h2 id="长期中的真实经济"><a href="#长期中的真实经济" class="headerlink" title="长期中的真实经济"></a>长期中的真实经济</h2><h3 id="生产与增长"><a href="#生产与增长" class="headerlink" title="生产与增长"></a>生产与增长</h3><p>一国的生活水平取决于它生产物品和服务的能力。在《鲁滨逊漂流记》中，鲁滨逊捕获鱼类的生产率直接影响他能享用多少食物。生产率取决于下面几个因素：</p>
<ul>
<li><strong>人均物质资本</strong>，即人均用于生产物品和服务的设备和建筑物存量，或简称为<strong>资本</strong>。工具越多，越高级，自然可以生产更多更好的产品。资本的重要特征是，它是一种<strong>生产出来的生产要素</strong>。</li>
<li><strong>人均人力资本</strong>，指工人通过教育、培训和经验获得的知识和技能，可以通过学习或培训得到，实际上，学生的日常学习就是用来未来生产的人力资本</li>
<li><strong>人均自然资源</strong>，即自然界提供的用于生产物品和服务的投入</li>
<li><strong>技术知识</strong>，即对生产物品和服务的最好方法的了解。技术知识是指社会对世界如何运行的理解，而人力资本是把这种理解传递给劳动力的资源消耗</li>
</ul>
<p>以上几点可以构成生产函数：<code>Y=AF(L,K,H,N)</code>。其中：</p>
<ul>
<li>L指劳动量</li>
<li>A代表生产技术</li>
<li>K代表物质资本</li>
<li>N代表自然资源</li>
</ul>
<p>去掉规模带来的收益能得到<code>Y/L=AF(1, K/L, H/L, N/L)</code>。即生产率取决于技术知识、<strong>人均</strong>物质资本、<strong>人均</strong>人力资本和<strong>人均</strong>自然资源。</p>
<h3 id="经济增长与公共政策"><a href="#经济增长与公共政策" class="headerlink" title="经济增长与公共政策"></a>经济增长与公共政策</h3><p>上面提到的生产率的影响因素，那么那些政策有助于提高生产率和生活水平呢？</p>
<ul>
<li>储蓄和投资：即减少现期资源的消费，用于投资资本的生产。不过资本会受到<strong>收益递减</strong>和<strong>追赶效应</strong>的影响，即随着资源的投入，边际产出越来越少，且贫穷的国家在同样政策下的增长更高</li>
<li>来自国外的投资：一种是由外国实体拥有并经营的资本投资，叫做<strong>外国直接投资</strong>，或者由外国实体购买国内公司的股票，叫做<strong>外国有价证券投资</strong>。这种投资可以有效增加一国的资本存量。因此大多数穷国都鼓励吸引外国投资</li>
<li>教育：属于一种人力资本投资，且具有<strong>正外部性</strong>，即一个人的行为对旁观者福利有积极影响。不过，<strong>人才外流</strong>是穷国面临的一个问题</li>
<li>健康与营养：健康的身体可以使工人获得更高的生产率，从而促进经济增长，而经济增长又会改善人们的健康状况，形成一个良性循环</li>
<li>产权和政治稳定：尊重产权即保护人们对自己拥有资源行使权力的能力，不尊重产权的环境下，人们不糊积极地利用资源；类似地，稳定的政治可以比较好地保护产权。经济繁荣也部分取决于政治繁荣。</li>
<li>自由贸易：外向型经济比内向型经济更容易提高生活水平</li>
<li>研究与开发：对技术知识研究的鼓励或者资助</li>
<li>人口增长：正面上，人口增长带来劳动力规模提升，且消费人群提升，同时从事技术研究的人更多；反面上，导致了自然资源紧张（这个可以通过创造新技术改善），稀释了资本存量，比如人力资本。</li>
</ul>
<h3 id="储蓄、投资和金融系统"><a href="#储蓄、投资和金融系统" class="headerlink" title="储蓄、投资和金融系统"></a>储蓄、投资和金融系统</h3><p>前面提到了，储蓄和投资是一国长期经济增长的关键因素。然后储蓄和投资间是需要协调的，有一些人为未来考虑将收入储蓄起来，也有一些人想借钱为新的增长中的企业投资筹资。金融机构应运而生。</p>
<h4 id="美国经济中的金融机构"><a href="#美国经济中的金融机构" class="headerlink" title="美国经济中的金融机构"></a>美国经济中的金融机构</h4><p>金融体系会使经济中的稀缺资源从储蓄者流动到借款者的手中。金融体系就由帮助协调储蓄者和借款者的各种金融机构组成。这些机构可以分为两类：<strong>金融市场</strong>和<strong>金融中介机构</strong>。</p>
<h5 id="金融市场"><a href="#金融市场" class="headerlink" title="金融市场"></a>金融市场</h5><p>金融市场即想储蓄的人可以借以直接向想借款的人提供资金的机构。它包含<strong>债券市场</strong>和<strong>股票市场</strong>。</p>
<ul>
<li>债券市场：债券即借款人向债券持有人负有债务的证明，通常会说明到期日和利率，在到期日时偿还债券利息以及本金。债券间有3个不同的特性：<ul>
<li>期限：从短期债券到长期债券甚至永久债券（只付利息，不偿还本金）。通常任务长期债券风险更高，所以利率也通常更高</li>
<li>信用风险：即拖欠的可能性。国家发型的债券信用风险较低，利率一般也比较低；状况不稳定公司发行的<strong>垃圾债券</strong>的利率则很高。</li>
<li>税收待遇：绝大多数债券都属于应纳税收入，而政府发行的债券则一般不需缴纳所得税</li>
</ul>
</li>
<li>股票市场：股票代表企业的部分所有权，也代表对企业获得利润的索取权。不同于<strong>债务融资</strong>，出售股票的筹集资金方式称为<strong>权益融资</strong>。和债券相比，股票会面临公司发展波动的不确定性，风险更高，然而潜在收益也会更高。公司在向公众出售股份而发行股票后，股票持有者可以在有组织的股票市场上交易。<strong>股票市场上股票的价格由股票本身的供求状况决定</strong>，即人们对公司<strong>未来盈利性</strong>的预期。<ul>
<li>股票指数：计算出来的一组股票价格的平均数，如道琼斯指数由美国最主要的30家公司平均而来，标准普尔500指数由500家主要公司股票价格计算得到</li>
</ul>
</li>
</ul>
<p>对于股市观察者来说，股票的价格、红利（公司把一些利润支付给股东，没有支付的利润称为<em>留存收益</em>，用于增加投资）、价格-收益比都是需要关心的关键数字。</p>
<h5 id="金融中介机构"><a href="#金融中介机构" class="headerlink" title="金融中介机构"></a>金融中介机构</h5><p>储蓄者可以借以中介机构向借款者提供资金。下面分析两种中介机构：</p>
<ul>
<li>银行：从想储蓄的人手里吸收存款，并用存款向想借款的人发放贷款，从中收取利润。同时，银行借助存款帮助创造出人们借以作为交换媒介的特殊资产，如信用卡、支票等</li>
<li>共同基金：向公众出售股份，并用收入购买股票和债券组合。它的首要优点是可以使钱不多的人也可以进行多元化投资，其次可以使普通人获得专业资金管理者的服务。第二点会受到金融学家的质疑。在资金管理者都密切关注每家公司的前景时，跑赢市场是很困难的。实际上，有种<strong>指数基金</strong>的共同基金，按一个既定的股票指数购买所有股票，它的表现甚至更好些。</li>
</ul>
<h4 id="国民收入账户中的储蓄和投资"><a href="#国民收入账户中的储蓄和投资" class="headerlink" title="国民收入账户中的储蓄和投资"></a>国民收入账户中的储蓄和投资</h4><p>首先回忆一个恒等式：<code>Y=C+I+G+NX</code>。为了更好分析，我们考虑一个<em>封闭经济</em>，即<code>NX</code>为0的经济。换算一下得到<code>Y-C-G=I</code>。我们把左边算式即总收入减去消费和政府购买的结果称为<strong>国民储蓄</strong>，又叫储蓄，简写为<code>S</code>，因此<code>S=I</code>，即<strong>储蓄等于投资</strong>。</p>
<p>假设<code>T</code>为政府以税收形式从家庭得到的数量减去转移支付（社保和福利）形式返回家庭的数量。则有<code>S=(Y-T-C)+(T-G)</code>。其中，<code>(Y-T-G)</code>称为私人储蓄，即家庭支付了税收和消费后剩下的收入，<code>(T-G)</code>称为公共储蓄，即政府在支付其指出后剩下的税收收入。T大于G时，政府得到的资金大于其指出而有<strong>预算盈余</strong>，T小于G时，政府会有<strong>预算赤字</strong>。</p>
<h4 id="可贷资金市场"><a href="#可贷资金市场" class="headerlink" title="可贷资金市场"></a>可贷资金市场</h4><p><strong>可贷资金</strong>是指<strong>人们选择储蓄并贷出而不是用于消费的所有收入</strong>。</p>
<ul>
<li>可贷资金的供给来自有额外收入想储蓄和贷出的人。贷出可以直接购买债券或者借助银行进行。这种情况，储蓄是可贷资金供给的来源。</li>
<li>可贷资金的需求来自希望借款进行投资的家庭和企业，可以用来用抵押贷款购置住房、或者企业借款购买新设备、建设新工厂。这种情况下，投资是可贷资金需求的来源。</li>
</ul>
<p>利率可以视为贷款的价格。综合上面可贷资金的供需，可以绘制出可贷资金的供求图。利率会自行调整使可贷资金供给、需求达到平衡。在分析中的“利率”指“真实利率”。</p>
<ul>
<li>储蓄激励。在这种激励下，借款成本较低，家庭和企业倾向于更多借款为投资筹资，从而<strong>利率下降且投资增加</strong></li>
<li>投资激励。比如对投资付税减免政策。此时会<strong>利率上升且储蓄增加</strong></li>
<li>政府预算赤字，赤字减少了国民储蓄，也就减少了可用于家庭和企业筹资的可贷资金的供给。由于政府借款引起的投资减少也被称为<strong>挤出</strong>。最终导致<strong>利率上升和投资减少</strong></li>
<li>政府预算英语，相反会增加可贷资金的攻击，<strong>减低利率并刺激投资</strong></li>
</ul>
<p>金融市场也是市场的一种，可贷资金的价格——利率——也由供求的力量决定。金融市场的一个特点是，它有联系着现在和未来的重要作用。</p>
<h3 id="金融学的基本工具"><a href="#金融学的基本工具" class="headerlink" title="金融学的基本工具"></a>金融学的基本工具</h3><h4 id="现值"><a href="#现值" class="headerlink" title="现值"></a>现值</h4><p><strong>现值</strong>，即用当下利率产生给定未来货币量所需的当下货币量。是基础的用来衡量货币时间价值的工具。今天的钱永远比未来同样数量的钱更值钱。寻找未来货币量对应到当下货币量的过程，被称为<strong>贴现</strong>。计算现值时，会用到复利的概念，根据<strong>70规则</strong>，如果变量每年的增长率为x%，那么大约70&#x2F;x年后，变量会翻一番。</p>
<h4 id="风险管理"><a href="#风险管理" class="headerlink" title="风险管理"></a>风险管理</h4><p>经济学家用<strong>效用</strong>的概念衡量一个人对福利或满足的主观衡量，效用函数会体现出边际递减的性质。即拥有的财富越多，获得等量财富得到的效用越少。同时，也由于边际递减性质，几乎所有人都有<strong>风险厌恶</strong>的特征。即不愿冒着失去x元的风险赌可能获得x元的可能性。那么怎么应对这种风险厌恶呢？</p>
<ul>
<li><strong>保险市场</strong>，购买保险，用保险费的方式让保险公司帮你承担风险。保险的作用并不是消除风险，而是能够更有效的分摊风险。保险市场受到两个制约分摊能力的因素影响：<ul>
<li>逆向选择：高风险的人申请保险的几率更高</li>
<li>道德风险：购买保险后，人们规避风险的激励变小了</li>
</ul>
</li>
<li><strong>企业特有风险</strong>的<strong>多元化</strong>：即选择更丰富的<strong>不相关</strong>的股票组合，避免受到一家公司的风险影响。也即“不要把所有鸡蛋都放在一个篮子里”。需要注意的是，多元化只能解决企业特有风险，不能消除市场固有风险，比如金融危机。</li>
</ul>
<p>人们可以在收益和风险间选择取舍，股票收益更高，但是标准差也更大。政府债券等安全替代品基本没有标准差，因此收益也更低。</p>
<h4 id="资产评估"><a href="#资产评估" class="headerlink" title="资产评估"></a>资产评估</h4><p>OK！我们现在对时间以及风险都有了了解，那么怎样去购买股票呢？股票的价格时怎么受供给和需求控制的呢？我们在购买股票的时候，更希望所购买的股票<strong>价格</strong>低于其<strong>价值</strong>。</p>
<ul>
<li><strong>基本面分析</strong>，即对一家公司做足够详尽的分析，以确定其价值。你可以自行阅读公司年报来做研究，或者听从专业分析师的建议，再或者购买<strong>共同基金</strong>让它来帮你进行基本面分析</li>
<li><strong>有效市场假说</strong>，这种假说认为股市上的所有上市公司信息足够透明，也处于基金管理者的跟踪之下，他们的工作就是在价格低于价值时买进，高于时抛出；从而让价格稳定在价值附近。另外，供求均衡也决定了市场价值，即所有股票都已被公正的估价。根据这一理论，股票市场表现出<strong>信息有效</strong>，它反映了关于资产价值可获得的所有信息。从而股票价格应该是<strong>随机游走</strong>的，因为有关股票价格的所有信息都已在当下体现在价格上了。</li>
</ul>
<p>有效市场假说最有力的证据来自指数基金的业绩。即按照既定股票指数购买所有股票的共同基金。它的表现大体上优于经过精心挑选的股票组合的共同基金。普通共同基金的频繁交易也导致了更多的交易费用。关于金融市场的研究证实了，<strong>胜过市场是极为困难的</strong>。</p>
<p>在有效市场假说外，也有经济学家认为，非理性的心理因素也会影响资产的价格，当你评价一个股票时，你不仅必须估算企业的价值，还有估算其他人认为企业未来值多少。</p>
<h3 id="失业"><a href="#失业" class="headerlink" title="失业"></a>失业</h3><p>很显然，那些<em>想工作</em>但是找不到工作的人对经济中物品和服务的生产没有做出贡献。失业对于GDP自然是有所影响的。失业问题中包含<strong>自然失业率</strong>和<strong>周期性失业</strong>，前者是经济中长期存在的失业量。</p>
<p>在政府衡量失业率时，会同时统计<strong>就业者</strong>、<strong>失业者</strong>和<strong>非劳动力</strong>。</p>
<ul>
<li>就业者：作为得到报酬的员工工作的人，在自己企业工作得到报酬的人，在家族企业工作但没有报酬的人等。不论是全职还是兼职都计算在内。</li>
<li>失业者：能够工作且有努力找工作，但没有找到的人，还包括被解雇正在等待重新回到工作岗位的人</li>
<li>非劳动力：上面两类以外的人，如全日制学生、退休人员、家务劳动者</li>
</ul>
<p>劳动力由就业者和失业者组成。失业率也等于失业者和劳动力的比值。劳动率参工率等于劳动力和成年人口的比值。在美国的统计结果中，最佳工作年龄的女性参工率低于男性，黑人失业率更高，青少年参工率低很多，失业率也更高。随着时代的变化，新技术和社会态度的变化让女性的参工率渐渐向男性靠拢。</p>
<p>衡量失业其实并不仅仅是失业率那么简单。一方面，有<strong>丧失信心的工人</strong>和避免纳税等人群存在，会影响失业率指标的准确性。我们同事也要具体细分失业人群。大多数情况下，<strong>大多数失业是短期的，然而既定时间段内观察到的失业都是长期的</strong>。那么为什么会有人一直失业呢？在一个理想的劳动市场，工资会调整劳动的供给和需求，并保证工人充分就业。但是这只是宏观的结论，对于具体的每个人，可能有因为个人偏好和技能不匹配引发的<strong>摩擦性失业</strong>，另外，由于某些原因引发的工作岗位不足、工资高于均衡水平（最低工资法、工会、效率工资），也会带来<strong>结构性失业</strong>。</p>
<h4 id="寻找工作"><a href="#寻找工作" class="headerlink" title="寻找工作"></a>寻找工作</h4><p>经济中总存在失业一方面和寻找工作有关。因为部门转移或经济发生结构性变化，总会带来摩擦性失业。摩擦性失业是不可避免的，因为经济总处在变化之中。针对这种情况，政府可以组织就业培训，或干脆直接发布职位。但也有人认为应该把决策交给工人和雇主。</p>
<p>美国的<strong>失业保险</strong>政策可以给享有的普通工人在26周内提供以前工资50%的补助。这提高了工人与工作相匹配的能力，但这一方面也反方面激励人们不认真找工作，和不在乎雇主对工作保障的保证。</p>
<h4 id="最低工资"><a href="#最低工资" class="headerlink" title="最低工资"></a>最低工资</h4><p>最低工资在少数情况下，会高于劳动市场供需平衡的均衡价格（绝大多数情况下，工人的工资都大大高于最低工资）。因此，最低工资的存在值解释了那些工资极低的劳动力存在结构性失业的可能性。这些工人通常都是年轻人、受教育少的人、从事兼职的人。</p>
<h4 id="工会和集体谈判"><a href="#工会和集体谈判" class="headerlink" title="工会和集体谈判"></a>工会和集体谈判</h4><p>工会作为工人的一种卡特尔，代表工人和雇主就津贴、工资、工作条件等进行谈判，并以罢工作为抗议手段。经过调查发现，参与工会的工人得到的收入比类似条件下，不参与工会的工人高出10%-20%。当工会把工资提高到均衡水平之上时，劳动供给增加、需求减少，引发结构性失业。这部分因此失业的劳动力情况反而变差。政府对于工会出台了一些政策和法律加以保护。</p>
<p>至于工会对于经济是好是坏，没有准确的答案，有人说工会对于工人的收益是以另一些工人的损失为代价的，也有人说工会可以平衡企业的市场势力，保护工人免受企业所有者的摆布。</p>
<h4 id="效率工资理论"><a href="#效率工资理论" class="headerlink" title="效率工资理论"></a>效率工资理论</h4><p><strong>均衡工资</strong>理论告诉我们，如果<strong>工资高于均衡水平，企业的经营会更有效率</strong>。这也是导致结构性失业的一个原因。乍一听这个理论和我们的第一印象相反。但实际高工资可以提高企业的工人效率。</p>
<ul>
<li><strong>工人健康</strong>，高工资可以提高工人身体素质</li>
<li><strong>工人流动率</strong>，高工资下，更少工人选择辞职，降低了工人流动率；企业雇佣和培训新工人也是有成本的，且新工人一开始的生产率也不如有经验的工人高</li>
<li><strong>高素质工人</strong>，重赏之下必有勇夫，同样的，高工资能吸引更好的工人来申请工作。</li>
<li><strong>工人忠诚度</strong>，高工资使工人更渴望保持他们的工作，从而给予工人付出最大努力的激励。</li>
</ul>
<h2 id="长期中的货币与物价"><a href="#长期中的货币与物价" class="headerlink" title="长期中的货币与物价"></a>长期中的货币与物价</h2><h3 id="货币制度"><a href="#货币制度" class="headerlink" title="货币制度"></a>货币制度</h3><h4 id="货币的含义"><a href="#货币的含义" class="headerlink" title="货币的含义"></a>货币的含义</h4><p>在没有货币这种被大众接受的媒介出现时，你们不得不依靠物物交换，这种经济需要需求的双向一致性，即刚好彼此都有对方想要的物品或服务；货币在经济中有着相当重要的作用。</p>
<p>货币是经济中人们经常用于相互购买物品和服务的一组资产。它有着多种职能：<strong>交换媒介</strong>、<strong>计价单位</strong>、<strong>价值储藏手段</strong>。经济中通常用<strong>流动性</strong>来说明一种资产兑换为经济中交换媒介的容易程度，如货币的流动性是最强的，而房产、艺术品就比较弱。人们决定以不同形式持有自己财富时，会努力在流动性和价值储藏手段上寻求平衡。货币在流动性上很好，但是作为价值储藏手段就不大行了。</p>
<p>货币大体上可以分为<strong>商品货币</strong>和<strong>法定货币</strong>两类：</p>
<ul>
<li>商品货币：货币本身有内在价值，如黄金</li>
<li>法定货币：由政府法令确定的货币，没有内在价值</li>
</ul>
<p>经济中流通的货币量称为货币存量，它包含<strong>通货</strong>（手中持有的纸币和铸币）、活期存款等。在美国有美联储负责管理法定货币制度。它主要有两个工作：</p>
<ul>
<li>管制银行并保证银行的正常运作，充当银行的<em>最后贷款者</em>，保证银行体系的稳定</li>
<li>控制经济中可以得到的货币量，又称<strong>货币供给</strong>，从而调节经济。美联储的主要工具是<em>公开市场操作</em>——买卖美国政府债券</li>
</ul>
<h4 id="银行和货币供给"><a href="#银行和货币供给" class="headerlink" title="银行和货币供给"></a>银行和货币供给</h4><p>你持有的货币量除了通货还包含你的活期存款。因此银行也会影响货币供给。在一家得到不贷出的银行里，<strong>准备金</strong>即存款，且<strong>准备金率</strong>为100%。这种情况下，银行不增加货币供给。如果银行将一部分存款贷出来收取利息，准备金率则小于1，这种银行也叫作<strong>部分准备金银行</strong>。准备金率是由政府管制和银行政策一同制定的。在有部分存款被贷出后，增加的货币量以贷款人的负债形式存在，整体上看增加了货币量。最终通过准备金可以产生的货币量等于准备金乘以准备金率的倒数。这个系数也被称为<strong>货币乘数</strong>，即1单位准备金所产生的货币量。准备金率越高，银行贷出的款越少，货币乘数也越小。准备金率为1时，货币乘数为1，银行不贷款，也不创造货币。</p>
<p>上面的讨论是一种简单的场景，实际上银行的资产负债表上，还会包括银行向其所有者发行的股票中的得到的<strong>银行资本</strong>，以及发行债券得到的债务，利用<strong>存款、债务和自身资本</strong>，银行在保留一定准备金时，可以向外贷款或购买有价证券。经济中许多经营活动依赖<strong>杠杆</strong>，即将借到的货币追加到用于投资的现有资金上。银行正是利用了杠杆。银行的<strong>杠杆率</strong>是银行总资产和银行资本的比值。在下面的假设中，银行资本只有50，剩下的部分用过吸收存款和发行债券得到。杠杆率为20,。资产价值5%的增加就会使所有者权益增加100%，相反如果资产价值下降超过5%，银行的资本就会减少到低于负债，从而<strong>破产</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    资产         负债和所有者权益</span><br><span class="line">——————————————————————————————————</span><br><span class="line">准备金   200   |   存款         800</span><br><span class="line">贷款    700    |   债务         150</span><br><span class="line">有价证券 100   |资本（所有者权益）  50</span><br></pre></td></tr></table></figure>

<p>银行管制者要求银行持有一定量资本，保证银行能偿还储户的存款（不依赖政府帮助情况下）。</p>
<h4 id="美联储控制货币的工具"><a href="#美联储控制货币的工具" class="headerlink" title="美联储控制货币的工具"></a>美联储控制货币的工具</h4><p>美联储主要通过<strong>影响准备金量</strong>和<strong>影响准备金率</strong>来影响货币乘数。</p>
<ul>
<li>影响准备金量：可以通过公开市场操作，即公开买卖政府债券，增大和减小货币供给；也可以通过<em>贴现窗口</em>向银行发放贷款，贷款的利率被称为<strong>贴现率</strong>。提高和降低贴现率分别会减少和鼓励向美联储借款，从而减少和增加货币供给</li>
<li>影响准备金率：可以通过改变<strong>法定准备金</strong>规定银行持有的最低准备金量，由于许多银行超额持有准备金，这个方法现在使用不多；还可以通过支付准备金利息，即以美联储存款的方式持有准备金时，向银行支付利息。</li>
</ul>
<p>在实际场景中，美联储并不能控制家庭选择以存款的方式持有的货币量，以及不能控制银行选择的贷款量，所以经济中的货币量部分取决于储户和银行家的行为。比如银行挤兑。现在，银行挤兑已经不是美国银行体系或美联储的主要问题，因为联邦存款保险公司（FDIC）保证大多数银行存款的安全。储户确信即使银行破产，他们的存款也将完好无损。</p>
<h5 id="联邦基金利率"><a href="#联邦基金利率" class="headerlink" title="联邦基金利率"></a>联邦基金利率</h5><p>联邦基金利率即银行向另一家银行进行隔夜贷款时的利率。这种贷款是短期的，通常只有一夜。它和贴现率有所不同，一个是向银行借款，一个是向美联储借款，一般在银行缺乏准备金时，哪个方法便宜用哪个。由于金融体系各部分高度相关，联邦基金利率虽然只和银行借钱有关，但实际上也和其他类型贷款利率密切相关。美联储会定期开会确定联邦基金利率的目标，并通过公开市场操作等方式去实现该目标。</p>
<h3 id="货币增长和通货膨胀"><a href="#货币增长和通货膨胀" class="headerlink" title="货币增长和通货膨胀"></a>货币增长和通货膨胀</h3><p>人们日常感受到的物价升高是通货膨胀的一种体现，相反还有通货紧缩。在<a target="_blank" rel="noopener" href="https://shenlvmeng.github.io/blog/2019/05/07/principles-of-microeconomics/">微观经济学</a>第一章中的经济学十大原理之一：政府发行货币过多时，物价上升。通货膨胀的成本可能并不像民众想象的那么大。</p>
<h4 id="古典通货膨胀理论"><a href="#古典通货膨胀理论" class="headerlink" title="古典通货膨胀理论"></a>古典通货膨胀理论</h4><p>古典通货膨胀理论可以用来说明物价水平和通货膨胀率的长期决定因素。物价水平的上升从另一个角度理解即<strong>每单位货币的价值下降</strong>。因此<strong>物价水平也可以看做货币价值的一种衡量指标</strong>。</p>
<p>而货币的价值也通过<strong>货币供给</strong>和<strong>货币需求</strong>决定。</p>
<ul>
<li>货币供给：美联储的公开市场操作，出售或买入政府债券时可以减少和扩大货币供给</li>
<li>货币需求：热门想以流动性形式持有的财富量</li>
</ul>
<p><strong>在长期中，物价总水平总会调整到使货币需求等于货币供给的水平</strong>。当有货币注入时，根据<strong>货币数量论</strong>，经济中可得到的货币量决定了货币的价值。而在两个稳态间的整个调整过程可以描述为：人们会试图用消费或储蓄的方式花掉超额货币供给，储蓄的方式又可以通过贷款再度转化到消费，去<strong>增加人们对物品和服务的需求</strong>。然而经济中生成物品和服务的能力并不会随着货币注入而增加（它和物质资本、人力资源、自然资源、生产技术相关），因此需求的增加引起价格上升，这增加了人们的货币需求量。从而达到新的均衡。</p>
<h5 id="古典二分法、货币中性和流通速度"><a href="#古典二分法、货币中性和流通速度" class="headerlink" title="古典二分法、货币中性和流通速度"></a>古典二分法、货币中性和流通速度</h5><p>大卫·休谟提出，所有的经济变量可以分为两类：<strong>名义变量</strong>是按货币单位衡量的变量，如农民的收入，<strong>真实变量</strong>是按实物单位衡量的变量，如玉米的产量。这种将名义变量和真实变量区分开的理论成为<strong>古典二分法</strong>。根据古典分析，名义变量会受到货币制度发展影响，而货币和真实变量是基本无关的。如我们在前面曾讨论过的：</p>
<ul>
<li>经济中物品和服务的生产主要取决于生产率和要素供给</li>
<li>真实利率的调节可以使可贷资金供给平衡</li>
<li>真实工资调整高于均衡水平时，会引起失业</li>
</ul>
<p>这种货币供给对真实变量的无关性称为<strong>货币中性</strong>。货币中性在短期内不完全正确，但是在长期经济上是正确的。</p>
<p>货币流通速度用来衡量货币易手的速度。用Y代表真实GDP，P代表GDP平减指数，M代表货币量，V作为货币流通速度，则有MV &#x3D; PY，即<strong>数量方程式</strong>。在经济体中，货币流通速度基本是不变的，它主要和社会观念、人们习惯、科学发展等相关。在货币数量论中有下面几个关键结论：</p>
<ol>
<li>货币流通速度一直是比较稳定的</li>
<li>由于1，所以当货币量M改变时，PY也会等比例变动</li>
<li>Y由要素供给（劳动、物质资本、人力资本、自然资源）和生产技术决定，由于货币中性，它并不影响产量</li>
<li>由于3，M的变动会反映在物价水平P的变动上</li>
<li>从而中央银行迅速增加货币供给时，结果就是高通货膨胀率</li>
</ol>
<h5 id="通货膨胀税和费雪效应"><a href="#通货膨胀税和费雪效应" class="headerlink" title="通货膨胀税和费雪效应"></a>通货膨胀税和费雪效应</h5><p>尽管通货膨胀会导致货币贬值，有些国家政府为了更方便快捷支付其支出（通常在高额支出且税收借款能力不足时），会选择创造货币。政府在通过印发货币筹集收入时，可以认为在征收一种<strong>向每个持有货币的人征收的通货膨胀税</strong>。这样导致的物价水平飞涨一般会随着货币制度改革而消除。</p>
<p>我们在前面提到，真实利率&#x3D;名义利率-通货膨胀率。可贷资金的供求决定<strong>真实利率</strong>。货币增长的变动不会影响真实利率，但是会一比一地体现在名义利率上，因为反过来名义利率&#x3D;真实利率+通货膨胀率。这种<strong>名义利率根据通货膨胀率所做的调整</strong>也称为<strong>费雪效应</strong>。</p>
<h4 id="通货膨胀的成本"><a href="#通货膨胀的成本" class="headerlink" title="通货膨胀的成本"></a>通货膨胀的成本</h4><p>首先，通货膨胀并不会导致购买力下降。因为在物价膨胀时，出卖物品、服务的人收入也得到了膨胀。也正如上一节所说，真实收入是由真实变量决定的。不过通胀还是会带来一些成本。</p>
<ul>
<li><strong>皮鞋成本</strong>：通货膨胀像一种税，税收这种激励的扭曲给社会带来了无谓损失。皮鞋成本字面意义是更经常去银行会使你的鞋磨损得更快。实际上是指减少货币持有量的成本，比如你牺牲的时间和便利。</li>
<li><strong>菜单成本</strong>：相反地，企业为应对通胀不得不改变定价。这种改变价格的成本成为菜单成本。</li>
<li>通胀会扭曲相对价格，扭曲消费者的决策，从而带来<strong>资源配置不当</strong></li>
<li>税收扭曲：许多税收都以名义量作为标尺,通胀夸大了资本收益的规模，无形中增加了这种收入的税收负担。税收<strong>指数化</strong>可以缓解这种情况</li>
<li>通胀侵蚀计价单位的真实价值带来的<strong>混乱和不方便</strong></li>
<li>未预期到的通货膨胀会带来意料之外的<strong>财富再分配</strong>。<em>超速通货膨胀</em>会转移债务人负担到债权人，相反通货紧缩会增大债务人负担</li>
</ul>
<p>整体来看，超速通胀期间，上面这些成本是可观的。不过温和通胀期间，如每年物价上涨10%以内时，这些成本的大小则还没有定论。另一方面，通货紧缩会减小经济中物品和服务的需求，从而带来收入减少和失业增加。这可能比通胀的成本更高。</p>
<h2 id="面向开放经济的宏观经济学"><a href="#面向开放经济的宏观经济学" class="headerlink" title="面向开放经济的宏观经济学"></a>面向开放经济的宏观经济学</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>我们在前面提到，贸易使每个人的状况更好。因此，前面在<em>封闭经济</em>基础上讨论的结论有必要放在<em>开放经济</em>的环境下探讨。当然，首先要了解一些概念：</p>
<ul>
<li>出口</li>
<li>进口</li>
<li>净出口</li>
<li>贸易余额</li>
<li>贸易盈余、贸易赤字、贸易平衡</li>
</ul>
<p>一个开放经济以两种方式和其他经济交易：<strong>在世界市场上购买并出售物品和服务</strong>；<strong>在世界金融市场上购买和出售股票、债券等资产</strong>。其中，衡量资本流动的有<strong>资本净流出</strong>的概念。它表示本国购买国外资本减去外国购买本国资本。这个值会受到各种因素影响。但整体来看，<strong>净出口等于资本净流出</strong>，即<strong>NCO&#x3D;NX</strong>。从概念上看，这个等式必然成立。</p>
<p>应用这个结论，可以很快得到：</p>
<ul>
<li>一国有贸易盈余（NX &gt; 0）时，资本从一国流出（NCO &gt; 0）</li>
<li>一国有贸易赤字时（NX &lt; 0），资本从外国流入（NCO &lt; 0）</li>
</ul>
<h4 id="储蓄、投资和国际流动的关系"><a href="#储蓄、投资和国际流动的关系" class="headerlink" title="储蓄、投资和国际流动的关系"></a>储蓄、投资和国际流动的关系</h4><p>在GDP的讨论中，我们已经知道<strong>Y&#x3D;C+I+G+NX</strong>。其中国民储蓄S等于<strong>Y-C-G</strong>。所以可以很快得到<strong>S&#x3D;I+NX</strong>。另外，从上面的结论<strong>NCO&#x3D;NX</strong>，可以得出<strong>S&#x3D;I+NCO</strong>。即储蓄等于国内投资加上资本净流出。或者可以说储蓄有两种用途：国内投资和资本净流出。在封闭经济中，NCO&#x3D;0，所以<strong>S&#x3D;I</strong>。</p>
<h4 id="真实汇率和名义汇率"><a href="#真实汇率和名义汇率" class="headerlink" title="真实汇率和名义汇率"></a>真实汇率和名义汇率</h4><ul>
<li><strong>名义汇率</strong>是国家间通货交换的比率，可以用<strong>升值</strong>以及<strong>贬值</strong>衡量这种比率的变化（或者坚挺、疲软）。</li>
<li><strong>真实汇率</strong>是国家间物品与服务交换的比率，它是名义汇率在价格比率的换算下得到的。一国的真实汇率是其物品和服务净出口的关键决定因素。真实汇率的下降意味着本国物品&#x2F;服务更便宜，从而带来净出口增加，汇率上升则有相反效果</li>
</ul>
<h4 id="汇率决定理论"><a href="#汇率决定理论" class="headerlink" title="汇率决定理论"></a>汇率决定理论</h4><p><strong>购买力平价</strong>是最简单的<em>长期</em>汇率决定理论。它认为长期来看，<strong>任何一单位通货应该能在所有国家买到等量物品</strong>。它基于<strong>一价定律</strong>，这个定律从反证法出发，认为如果一种物品在不同地方具有不同价格，则存在<strong>套利</strong>可能，即利用价格差获益。这个获益过程会让价格还原到一致的水平。从而达到<strong>购买力平价</strong>的效果。</p>
<p>购买力评价也意味着真实汇率为1，即<strong>名义汇率等于外国物价水平和国内物价水平的比值</strong>。因此，当国内中央银行引发大量货币时，不仅从能买到的物品和服务来看，还是从能换取的其他通货来看，货币价值都减少了。购买力评价理论的局限性在于，假定条件太理想化。</p>
<ul>
<li>许多物品和服务并不能贸易，至少不那么容易贸易</li>
<li>不同国家的物品和服务具有差异化，这种不可替代性也削弱了套利的可能</li>
</ul>
<p>但是从长期看，大幅度且持久的名义汇率变动还是反映了国内外物价水平的变化。</p>
<h3 id="宏观经济理论"><a href="#宏观经济理论" class="headerlink" title="宏观经济理论"></a>宏观经济理论</h3><p>在上一章介绍了净出口、资本净流出、真实汇率、名义汇率等概念，这章分为可贷资金市场、外汇市场加以讨论。这两个模型的建立基于GDP是既定的，以及经济中的物价水平是既定的。</p>
<h4 id="可贷资金市场和外汇市场"><a href="#可贷资金市场和外汇市场" class="headerlink" title="可贷资金市场和外汇市场"></a>可贷资金市场和外汇市场</h4><ul>
<li>可贷资金市场：协调经济中的储蓄和投资，受<code>S=I+NCO</code>等式的支配。在这个市场中，供给来自于国民储蓄，需求来自于投资和资本净流出。而<strong>真实利率</strong>影响供需的均衡。在真实利率上升时，会同时抑制本国人购买外国资产且吸引外国人购买本国资产。</li>
<li>外汇市场：协调交换国内外通货的人，受<code>NCO=NX</code>等式的支配。在这个市场中，通货供给来自资本净流出，需求来自净出口中外国所需要的本国通货。而<strong>真实汇率</strong>影响着供需均衡。真实汇率衡量了国内外物品的相对价格。真实汇率上升时，会减少外汇市场上对本国货币的需求量。由于汇率变动既影响购买外国资产，也影响这些资产的受益，这两种印象相互抵消。资本净流出的供给曲线几乎是垂直的。</li>
</ul>
<h4 id="开发经济中的均衡"><a href="#开发经济中的均衡" class="headerlink" title="开发经济中的均衡"></a>开发经济中的均衡</h4><p>在上面的两个市场中，资本净流出（NCO）作为两个均衡的桥梁。在上面的开放经济模型中：</p>
<ul>
<li><strong>真实利率</strong>用来衡量<strong>未来</strong>的物品和服务相较当下物品与服务的价格</li>
<li><strong>真实汇率</strong>用来衡量<strong>国外</strong>的物品和服务相较本国物品与服务的价格</li>
</ul>
<p>在真实利率确定后，可以得到均衡时资本净流出，从而再结合外汇市场需求曲线得到均衡时的真实汇率。</p>
<h4 id="开放经济如何受政策和局势影响"><a href="#开放经济如何受政策和局势影响" class="headerlink" title="开放经济如何受政策和局势影响"></a>开放经济如何受政策和局势影响</h4><p>上面用两个市场和供需图对宏观经济的几个关键指标进行了建模。两个市场通过资本净流出建立起联系。接下来就利用这个模型分析政策对这些指标的影响。</p>
<ul>
<li><strong>政府预算赤字</strong>：减少国民储蓄，提高真实利率，减少资本净流出，减少净出口，使贸易趋向赤字</li>
<li><strong>贸易政策</strong>，贸易政策如关税或进口配额会影响进口，从而增加了美元需求，并导致真实汇率上升，但是资本净流出和净出口都不变。很多经济学家认为，贸易政策的微观经济影响会大于宏观经济影响</li>
<li><strong>政治不稳定&#x2F;资本外逃</strong>，资本外逃增大了资本净流出，扩大了可贷资金需求和世界市场上的通货需求，并带来通货贬值和真实利率上升。相反，资本流入会让通货坚挺，并引起贸易赤字。</li>
</ul>
<p>往往鼓励资本流出的国家，会引起通货疲软和贸易盈余，接受资本流入的国家通货坚挺和贸易赤字。</p>
<h2 id="短期经济波动"><a href="#短期经济波动" class="headerlink" title="短期经济波动"></a>短期经济波动</h2><p>经济活动有繁荣，也有衰退甚至是萧条时期，可以借助总需求和总供给曲线分析。首先有三个事实：</p>
<ul>
<li>经济波动是无规律且不可预测的</li>
<li>经济波动时，大多数宏观经济变量同时波动</li>
<li>产量下降时，失业上升</li>
</ul>
<h3 id="解释短期经济波动"><a href="#解释短期经济波动" class="headerlink" title="解释短期经济波动"></a>解释短期经济波动</h3><p>根据古典经济学的古典二分法和货币中性，名义变量不会影响人们的生活，也不会影响真实变量。不过<em>短期</em>中，名义变量和真实变量却是有相关性的。这里我们借助<strong>总需求和总供给</strong>模型来分析。这里的供给需求和我们在微观经济学中提到的供需不是一个概念。这里的供给和需求是衡量整个市场而非特定市场的。</p>
<h4 id="总需求曲线"><a href="#总需求曲线" class="headerlink" title="总需求曲线"></a>总需求曲线</h4><p>整体来看，总需求曲线是向右下倾斜的。从3个角度来看：</p>
<ul>
<li>消费-财富效应：物价下降使人们手里的财富升值，提升了购买物品和服务的能力，鼓励人们支出。</li>
<li>投资-利率效应：物价下降引起财富升值，多余的钱会鼓励人们在投资上的支出</li>
<li>净出口-汇率效应：物价下降时，涌入储蓄和投资的钱会引起利率下降，带来资本净流出增加，货币贬值，国内物品相对国外更便宜，刺激净出口增加，提高了物品和服务的需求量</li>
</ul>
<p>相反的，物价上升会从消费、投资、净出口的角度抑制物品和服务的需求量。上面这个分析是建立在货币量一定的基础上。一些因素会引起总需求曲线的移动：</p>
<ul>
<li>消费：风气、文化、税收，如鼓励向远看，会让总需求曲线左移</li>
<li>投资：税收政策、货币供给，如短期货币供给增加降低利率刺激总需求曲线右移</li>
<li>政府购买：基础建设工程、武器航天</li>
<li>净出口：经济复苏、萧条</li>
</ul>
<h4 id="总供给曲线"><a href="#总供给曲线" class="headerlink" title="总供给曲线"></a>总供给曲线</h4><p>由于总供给曲线和<strong>真实GDP</strong>密切相关。所以在<em>长期</em>上，它是垂直的，但是短期中，总供给曲线则是向右上方倾斜。</p>
<p>在长期中，能引起总供给曲线变化的是决定真实GDP的那些因素：</p>
<ul>
<li>劳动变动：受自然失业率影响，比如最低工资调整</li>
<li>资本变动：包括物质资本和人力资本</li>
<li>自然资源变动：发现新的资源，或已有资源枯竭</li>
<li>科学技术更新</li>
</ul>
<p>长期中，技术和货币政策会引起总供给和总需求曲线共同右移，从而带来持续的通货膨胀。</p>
<p>短期中，总供给曲线是向右上倾斜的，即短期物价水平会影响经济中的产量，这个原因有3个相关的理论。</p>
<ul>
<li>粘性工资理论：名义工资对经济状况变动的调整缓慢，从而让工厂根据物价水平调整雇佣工人数目和产量</li>
<li>粘性价格理论：即一些物品和服务的价格对经济状况变动的调整也是滞后的（部分是因为菜单成本）。从而在物价高于当前水平时增产，低于当前水平时减产</li>
<li>错觉理论：供给者误认为相对价格下降&#x2F;上升，</li>
</ul>
<p>三种理论都说明，当实际物价背离人们预期物价水平时，短期产量会背离自然产出水平。这是个<strong>暂时</strong>存在的问题。因为人们的预期适应只是需要时间而已，但总会适应的。影响长期总供给曲线移动的因素也会引起短期总供给曲线移动。另外，<strong>预期物价水平</strong>的变动也会引起曲线移动，预期更高时，曲线左移，预期更低时曲线右移。</p>
<h4 id="经济波动的原因"><a href="#经济波动的原因" class="headerlink" title="经济波动的原因"></a>经济波动的原因</h4><p>根据上一节提到的总供给和总需求模型，短期经济波动的基本原因来自：<strong>总需求曲线移动和总供给曲线移动</strong>。分析宏观经济波动的步骤和之前也是通过供需图完成。</p>
<ul>
<li>总需求曲线变动：通过总需求曲线和<em>短期</em>总供给曲线得到短期变动，产量和物价波动；再通过和<em>长期</em>总供给曲线得到最终变动，产量还原，物价上升或下降。由短期变动到长期均衡的过程受到粘性工资等原因影响。决策者可以通过政策干预减缓经济波动的严重性</li>
<li>总供给曲线变动：同上，供给减少会引起滞涨，即产量减少和物价上升，并带来工资——物价螺旋式上升，但是长期来看，产量会回升，物价进一步上升。同样地，政策可以减缓产量的不利影响，但是<strong>只能以加剧通货膨胀作为代价</strong>。</li>
</ul>
<h3 id="货币、财政政策对总需求的影响"><a href="#货币、财政政策对总需求的影响" class="headerlink" title="货币、财政政策对总需求的影响"></a>货币、财政政策对总需求的影响</h3><p>上面提到，在短期经济中，可以用总需求和总供给曲线解释一些现象，这一章主要介绍了货币和财政政策对总需求曲线的影响。</p>
<h4 id="货币政策"><a href="#货币政策" class="headerlink" title="货币政策"></a>货币政策</h4><p>总需求曲线向右下倾斜的三个因素：财富效应、利率效应、汇率效应中，利率效应是影响最大的。根据凯恩斯的<strong>流动性偏好理论</strong>，<strong>利率的调整使货币供给与货币需求平衡</strong>。</p>
<ul>
<li>货币供给：美联储可以通过公开市场买卖政府债券或改变贴现率或修改法定准备金等手段调整货币供给，因此货币供给只和美联储政策有关，与利率无关。这条曲线是垂直的</li>
<li>货币需求：利率是持有货币的机会成本，利率上升提高了这个成本，因此货币需求向右下方倾斜</li>
</ul>
<p>根据流动性偏好理论，在均衡利率下，货币供给和需求达到平衡。</p>
<p>在之前的章节中，我们提到利率的调节使可贷资金的供给和需求达到平衡。这是长期角度的判断，在长期上，产量即自然产出水平是固定的，利率的调整使可贷资金供求平衡，物价水平的调整再使货币的供求平衡。但是短期内，物价总水平变化是缓慢的，利率的调整使货币供求平衡，确定的利率再影响产量水平。正好是反过来的。可贷资金理论更强调经济中储蓄倾向和投资机会的平衡，短期决定因素上，流动性偏好理论强调了货币政策的重要性。</p>
<ul>
<li>货币供给固定时，较高的货币需求引起较高利率，从而减少了物品和服务的盈利程度和需求量</li>
<li>货币供给变动时，比如增加货币供给，会降低利率，增加物品和服务的需求量，使需求曲线右移</li>
</ul>
<p>美联储在政策制定上并非直接以货币供给直接作为政策工具，而是使用<strong>联邦基金利率</strong>最为目标制定政策。而根据上面的理论，<em>使用货币供给或是利率都可以描述一个货币政策</em>。美联储以利率作为目标时，也意味着它承诺或调整<em>货币供给</em>来达到这个目标。简单来记忆的话：</p>
<ul>
<li>扩大总需求的货币政策 &#x3D; 增加货币供给 &#x3D; 利率降低</li>
<li>紧缩总需求的货币政策 &#x3D; 减少货币供给 &#x3D; 利率提高</li>
</ul>
<h5 id="流动性陷阱"><a href="#流动性陷阱" class="headerlink" title="流动性陷阱"></a>流动性陷阱</h5><p>在一些特殊时期，利率甚至会降至接近0，由于名义利率不可能降低至0以下，这种时候扩张性货币政策通过降低利率和刺激投资支出带来的额外流动性就很难再起到作用，即<strong>流动性陷阱</strong>。当然还有其他的扩张经济的工具，如承诺未来的货币扩张来提高<em>预期</em>通货膨胀，或购买抵押贷款或公司债券降低这类贷款利率（量化宽松）。</p>
<p>美联储的目标之一是稳定总需求，因此在股市上涨时，美联储货币政策会偏向紧缩，而在股市下跌时，政策会偏向宽松。</p>
<h4 id="财政政策"><a href="#财政政策" class="headerlink" title="财政政策"></a>财政政策</h4><p>财政政策主要包括<strong>政府购买</strong>和<strong>税收</strong>。</p>
<h5 id="政府购买"><a href="#政府购买" class="headerlink" title="政府购买"></a>政府购买</h5><p>整体上会让总需求曲线右移，但是<strong>乘数效应</strong>和<strong>挤出效应</strong>会让总需求曲线移动的幅度大于和小于预期。</p>
<ul>
<li>乘数效应：政府购买带来的增加了收入，刺激的消费支出，同时也让工厂雇佣更多工人，进一步刺激投资和消费，引起连锁反应。这种正反馈有时也被称为<strong>投资加速数</strong>，如果用<strong>边际消费倾向</strong>（MPC）来衡量家庭额外收入用来消费而不是储蓄的倾向，最终乘数等于<code>1/(1-MPC)</code>。乘数说明经济可以将支出变动影响扩大。</li>
<li>挤出效应：政府购买刺激物品和服务的总需求的同时，必然带来利率提升，从而减少投资支出，阻止总需求增加。</li>
</ul>
<p>最终政府购买带来的总需求曲线移动取决于乘数效应和挤出效应的大小。</p>
<h5 id="税收政策"><a href="#税收政策" class="headerlink" title="税收政策"></a>税收政策</h5><p>税收政策变化会直接影响人们的消费欲望。但是影响幅度取决于家庭对税收变动持久性的判断。判断越持久，影响越大。</p>
<h4 id="运用政策来稳定经济"><a href="#运用政策来稳定经济" class="headerlink" title="运用政策来稳定经济"></a>运用政策来稳定经济</h4><p>在是否支持政策来稳定经济上有两派意见：</p>
<ul>
<li>支持：政府应对经济中的变动的概念做出反应以便稳定总需求。因为人总有<em>动物本能</em>在，悲观主义和乐观主义情绪会带来经济的波动。不过有些政策的效果也取决于人们对政府政策的态度（如税收）</li>
<li>反对：政策产生以及带来影响都有时滞，且经济预测并不一定准确，政策发生作用时很可能已不是当初的经济环境，从而带来副作用</li>
</ul>
<p>类似税制、政府支出这样的政策可以<strong>自动</strong>适应经济变化，在经济衰退时，政府征收的税随着人们收入的减少而减少，政府支出譬如福利随着人们生活条件变差而增加，从而起到刺激经济的作用。因此它们也被统称为<strong>自动稳定器</strong>。</p>
<h3 id="通货膨胀和失业间的短期权衡"><a href="#通货膨胀和失业间的短期权衡" class="headerlink" title="通货膨胀和失业间的短期权衡"></a>通货膨胀和失业间的短期权衡</h3><p>长期来看，自然失业率受最低工资、工会、效率工资等影响，而通货膨胀率取决于央行控制的货币供给的增长。这两个几乎互不相关。但是在短期中，总需求的变化会体现在短期总供给曲线上，增加或减少失业。总需求增加带来产量增加、失业减少和物价上升、通货膨胀；总需求减少带来产量下降、失业上升和物价下跌、通胀减少。</p>
<h4 id="菲利普斯曲线"><a href="#菲利普斯曲线" class="headerlink" title="菲利普斯曲线"></a>菲利普斯曲线</h4><p>1958年，菲利普斯发现失业率和名义工资间的负相关特性，而后被发展成失业率和通货膨胀率间的负相关特性，并将相关关系称为菲利普斯曲线。菲利普斯曲线说明，短期中通货膨胀和失业的组合是由于<strong>总需求曲线的移动使经济沿总供给曲线变动</strong>。</p>
<h4 id="长期菲利普斯曲线：预期的作用"><a href="#长期菲利普斯曲线：预期的作用" class="headerlink" title="长期菲利普斯曲线：预期的作用"></a>长期菲利普斯曲线：预期的作用</h4><p>菲利普斯曲线在短期内是比较典型的，但根据之前的“货币中性”的观点，在长期，不可能用名义变量的控制去钉住真实变量。同样的，不能通过控制货币量去影响<strong>自然失业率</strong>和产量这些真实变量。<strong>从长期来看，失业并不取决于货币量增长和通货膨胀</strong>。它和我们在失业一章中提到的<strong>最低工资法</strong>、<strong>工会谈判</strong>、<strong>在职培训计划</strong>等有关。</p>
<p>那么又怎么去解释短期内菲利普斯曲线的表现呢？和总需求、总供给中说到的一样，是<strong>预期</strong>发挥的作用，<strong>预期的通货膨胀</strong>造成了短期的失业率下降。我们可以概括成下面的式子：</p>
<p>失业率 &#x3D; 自然失业率 - a(实际通货膨胀 - 预期通货膨胀)</p>
<p>其中<strong>实际通货膨胀</strong>可以通过美联储的货币政策快速调整，然而<strong>预期通货膨胀</strong>需要个人和企业慢慢适应和调整，并最终抵消货币政策的效果。根据这个理论，<strong>自然率假说</strong>提出，选择较高的通货膨胀来减少失业只能起到暂时性效果。</p>
<h4 id="总供给冲击"><a href="#总供给冲击" class="headerlink" title="总供给冲击"></a>总供给冲击</h4><p>1970到1980年期间，石油输出国组织大幅削减石油出口，导致油价飙升，总供给曲线左移，菲利普斯曲线右移，经济陷入滞涨（产量下降、物价上升）。对于同样的通货膨胀，失业率更高；类似地，对于同样的失业率，通货膨胀效率更高。一方面，决策者希望紧缩总需求来对付通货膨胀，但这会进一步增加短期失业；另一方面，扩大总需求对付失业，则会进一步提高通货膨胀。这种两难的处境比之前更甚。这种情况以及菲利普斯曲线的移动的维持时间取决于人们的预期通货膨胀的调整时间。</p>
<h4 id="牺牲率与反通货膨胀"><a href="#牺牲率与反通货膨胀" class="headerlink" title="牺牲率与反通货膨胀"></a>牺牲率与反通货膨胀</h4><p><strong>反通货膨胀</strong>并不等于通货紧缩，它旨在减少通货膨胀的比率，而不是把它变成负数。<strong>牺牲率</strong>可以用来衡量减少通货膨胀需要“牺牲”的每年产量。一部分经济学家认为，在<strong>理性预期</strong>，即人们充分运用政策信息，且快速调整预期时，牺牲率并不会像想象中那么高。最终反通货膨胀的起效速度和程度取决于人们对侦测的相信程度。</p>
<h2 id="经济政策的讨论和思考"><a href="#经济政策的讨论和思考" class="headerlink" title="经济政策的讨论和思考"></a>经济政策的讨论和思考</h2><ul>
<li>是否要采取财政政策和货币政策来稳定经济<ul>
<li>是：可以采取政策来稳定总需求，从而稳定生产和就业</li>
<li>否：政策都有时滞，需要政治过程，然而经济是有时间窗口的，错过时机就难以找回</li>
</ul>
</li>
<li>政府反衰退应该增加支出还是减税<ul>
<li>增加支出：传统凯恩斯主义中，衰退的原因就是总需求不足，而政府购买增加相比减税更有效率地增加总需求</li>
<li>减税：减税可以增加家庭可支配收入，我们可以通过改变减税方向，超特定方向激励用户增加总需求。政府购买可能会引发人们对未来高税收的预期从而减少消费。同时政府能否明智而迅速的花钱也是存疑的。减税对比政府购买<strong>分散</strong>了支出决策，绕开了不可靠的政治过程</li>
</ul>
</li>
<li>货币政策应该按规则指定还是见机行事<ul>
<li>按规则：灵活度过高会让让滥用权力没有限制，比如总统竞选时采取扩张性货币政策以获得暂时性比较好的就业，同时还容易存在政策的前后不一致性，影响人们对通货膨胀的预期</li>
<li>灵活制定：能更快速地应对经济形式的变化，同时政治性经济周期和前后不一致性在实践中并不明显</li>
</ul>
</li>
<li>是否应该把零通货膨胀作为目标<ul>
<li>是：通胀带来真实成本，同时降低通胀可能并不像想象中那么困难</li>
<li>否：零通胀好处并不大，然而实现零通胀的成本却是很大的，反通货膨胀引起的衰退会留下痕迹。另外，一个合理的通货膨胀不会给人们带来负担，同时还能留下更大的缓冲区域</li>
</ul>
</li>
<li>政府是否应该平衡预算<ul>
<li>是：更高的政府债务给了后代更大的负担，同时财政赤字代表负的公共储蓄，它降低了国民储蓄引起真实利率上升和投资减少。不过相对高税率来说，高债务相对好点</li>
<li>否：下一代人身上背的债务被夸大的，如果从他们一生的收入来相比，身上背的债务并不算多。另外，政府债务也需要和其他政策放在一起看，政府债务带来的更好的教育、医疗等，同时也有助于财产再分配</li>
</ul>
</li>
<li>应该为了鼓励储蓄而修改税法么<ul>
<li>应该：各种税收政策抑制了储蓄需求，会减少国民储蓄</li>
<li>不应该：税收有助于增大公共储蓄，同时合理的征税也可以保证储蓄</li>
</ul>
</li>
</ul>
<p>很少有什么政策只有好处而没有代价。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://shenlvmeng.github.com/blog/2020/05/31/pragmatic-thinking-and-learning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
      <meta itemprop="name" content="shenlvmeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shenlvmeng's Blog">
      <meta itemprop="description" content="Be sharp, my friend.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Shenlvmeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/05/31/pragmatic-thinking-and-learning/" class="post-title-link" itemprop="url">《程序员思维修炼》—— 思维方式和学习技巧</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-05-31 19:07:14 / 修改时间：22:03:42" itemprop="dateCreated datePublished" datetime="2020-05-31T19:07:14+08:00">2020-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%80%9D%E8%80%83/" itemprop="url" rel="index"><span itemprop="name">思考</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2020/05/31/pragmatic-thinking-and-learning/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/05/31/pragmatic-thinking-and-learning/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>程序设计其实就是解决问题，它需要发明、创造和灵感</p>
</blockquote>
<p>《程序员思维修炼》的作者同时也是《程序员修炼之道》的作者，在书中都有体现实用主义的影子。而在本书中，思考的角度则更高。从思维方式、学习能力等角度出发，提出了对不同人有着不同借鉴意义的真知灼见。全书思路发散，图结构而非树状结构的全书脉络让人较难在脑海中一次回忆起全部内容。开头对于专家模型的介绍稍显突兀，而后对R型思维的介绍，包括概念介绍、需要重视和如何培养，思路上比较连贯。整体上还是读者自己形成看法和认识。后面对学习能力、注意力控制等的介绍倒是比较有实用性，可操作性较高。按第一章的专家模型来界定，就是面向新手、高级新手阶段的指令集。书中大脑调试一章对于有心理学基础的读者来讲，聊胜于无。整体来看，也完全可以面向非程序员群体，全书前半段更能开阔视野，后半段更有使用价值。</p>
<p><em>吐槽一点，把书中对于“情境”一词翻译成“上下文”之后，我读起来舒服了很多。因此下面我也做了这样的“翻译”</em></p>
<p>下面分章节简单摘录一些闪光点。</p>
<h2 id="绪论"><a href="#绪论" class="headerlink" title="绪论"></a>绪论</h2><h3 id="个人理解"><a href="#个人理解" class="headerlink" title="个人理解"></a>个人理解</h3><p>写代码是项脑力运动，软件项目运作中，弱点实际上在人，而非机器和代码。因此对于思维上的练习是很有裨益的。</p>
<h3 id="摘录"><a href="#摘录" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li>“软件产品处于应用、用户、规则和硬件的合力之下。这些因为总是在不断变化，迫使软件产品也随之改变” ——《没有银弹》</li>
<li>始终关注上下文</li>
<li>有些东西是基础的、各领域相通的。那么必然是存在某些根本和重要的东西。（然而作者没有举例）</li>
</ul>
<h2 id="从新手到专家"><a href="#从新手到专家" class="headerlink" title="从新手到专家"></a>从新手到专家</h2><h3 id="个人概括"><a href="#个人概括" class="headerlink" title="个人概括"></a>个人概括</h3><p>人对技能的掌握是可以分阶段的。在低能阶段，更需要固定的<strong>指令集</strong>，这可以通过培训、手册等手段实现；经过不断的<strong>模仿</strong>和意外情况以及新手自己的努力总结后，可以一步步进化到高能阶段，这个阶段会偏向按<strong>直觉</strong>行事，在新手看来就像是magic。<strong>对于新手和专家的管理方式一定是不同的</strong>，新手更需要规则去避免思考，以及去做标准化；专家更需要自由化的工作环境来避免人为限制。</p>
<h3 id="摘录-1"><a href="#摘录-1" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li>专家的很多行为是如此的熟练以至于已经变成无意识的了</li>
<li>德雷福斯模型的5个阶段：新手、高级新手、胜任者、精通者、专家。大多数人都停留在前两阶段。专家的比例极低，需要海量的时间积累。<ul>
<li>新手只是要<strong>一个立竿见影的目标</strong>，他们需要一个指令清单和决策树能按部就班的执行下去</li>
<li>高级新手已经可以根据经验从正确的上下文中采纳建议，但他们没有更高的全局思维</li>
<li>胜任者能建立<strong>问题领域的概念模型</strong>，并有效的应用</li>
<li>精通者有全局思维，并不断纠正以往不好的工作表现</li>
<li>专家是各领域知识和信息的主要来源，根据直觉行事而不需要理由</li>
</ul>
</li>
<li>任何对开发指定严格规则的方法或企业文化都会拖累专家业绩表现到新手水平</li>
<li>元认知，即自我认知能力，往往在较高的技能层级才会具有，即知道自己不知道什么</li>
<li>积极的实践需要4个条件<ul>
<li>一个明确定义的任务</li>
<li>任务具有适当难度</li>
<li>环境能提供大量反馈</li>
<li>提供重复犯错和纠正错误的机会</li>
</ul>
</li>
<li>没有实践就没有技能，先通过<strong>模仿</strong>来学习进步</li>
<li>要警惕工具中忽视上下文造成的不灵活性，结合实际保证一定的灵活度</li>
<li><strong>培养知觉</strong></li>
<li>学习学习能力</li>
</ul>
<h2 id="认识大脑"><a href="#认识大脑" class="headerlink" title="认识大脑"></a>认识大脑</h2><h3 id="个人概括-1"><a href="#个人概括-1" class="headerlink" title="个人概括"></a>个人概括</h3><p>人的大脑并没有明显区分出左脑司情感，右脑司逻辑。但是思维模式上却是区分出L（Logic）型和R（Rich）型。L型偏细节、偏实现、偏逻辑；R型偏整体、偏设计、偏模式。L型能帮助你100%解决问题，R型则需要等待idea<strong>涌现</strong>出来。我们不能因为R型在日常生活或学习工作生涯中较少出现而忽视了它。</p>
<h3 id="摘录-2"><a href="#摘录-2" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li>L型又叫线性模式，R型又叫富模式。R型对知觉、问题解决和创造性非常重要，L型让你细致工作并实现目标、</li>
<li>两种模式会竞争大脑总线。就像你回忆梦的时候，R型能帮你想象出来；但是想要把梦讲出来时，L型占用了总线，你无法获取到R型记忆了。</li>
<li>R型思维不能直接控制</li>
<li>大脑并没有一个中心主管思想，各种想法会分布式的涌现和竞争，不断刷新大脑闪存。只有胜利者能成为你的意识。所以你需要做好准备，记录你随时可能出现的idea</li>
<li>每个人都有好点子，但是你不捕获的话，很容易沉没在脑海里</li>
<li>L型处理让人踏实、舒适、可预期；R型则更像<strong>直觉</strong>，它喜欢综合学习，模式分析，而不愿受理性约束，因为它并不需要基于原因或已有事实来输出结果。因此R型具有直觉性、跳跃性。我们日常生活做出的决定，几乎都不是纯L型或纯R型的结果，比如，你为什么结婚？</li>
<li>R型的<strong>综合</strong>和L型的<strong>分析</strong>不同。综合意味着脱离细节、在乎全貌。有些任务专注细节反而难以完成，而从全貌出发可能更简单，比如左手画圆，右手画方?</li>
<li>社会和教育鼓励L型，但是R型也是不可缺少的。</li>
<li>一成不变的工作环境不利于大脑发展，丰富的感官机会会更有利。</li>
<li>“美学在于选择、共鸣、同化和爱，而非创造”</li>
<li>L型看树木，R型看森林</li>
</ul>
<h2 id="利用右脑"><a href="#利用右脑" class="headerlink" title="利用右脑"></a>利用右脑</h2><h3 id="个人概括-2"><a href="#个人概括-2" class="headerlink" title="个人概括"></a>个人概括</h3><p>R型对于工作和生活是一定有帮助的，先体验对问题有个感官认识，而后上手会更快。有些时候，难题会被意外的灵感解决。R型可以通过一些方式去培养，如晨写来培养找到感觉的过程、或散步沉思来转移L型注意力给R型发挥空间等。我们在日常中会无意识的用到R型，比如类比、隐喻甚至是幽默。</p>
<h3 id="摘录-3"><a href="#摘录-3" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li><strong>利用多感官反馈</strong>，可以从视觉、触觉、听觉或者其他角度创造多种体验，<strong>刺激你的大脑</strong>，让它发挥魔力</li>
<li>L型思维会符号化感官输入，要创造条件避免这样，比如<strong>角色扮演</strong>，洞察真实事物</li>
<li>R型引入日常工作，可以提高工作效率<ul>
<li><strong>先体验去感受模式</strong>，一次多感官、亲身实践的上下文更有助于学习。当然，对于没有门槛或者低门槛的活动这么做会更好用</li>
<li>让R型开路，之后L型紧跟，酒醉写作，酒醒修改，综合两种思维模式</li>
<li>结对编程：一个使用R型发现模式，一个使用L型专心实现（比较理想化了）</li>
</ul>
</li>
<li>隐喻是最日常的沟通R型和L型的方式。隐喻的参考系差别越大，创造性的成果就越大<ul>
<li>随机并列锻炼联想能力</li>
<li><strong>系统隐喻</strong>，使用日常事物去类比代码模型。但是有时很难找到这样的类比</li>
</ul>
</li>
<li>幽默在于在不同想法中制造新奇的联系，也可以锻炼R型</li>
<li>你的大脑会记录所有输入，R型负责组织和模式发现，并随机涌现结果。很多时候，涌现的结果是无法用言语表达的。这个时候，可以利用图像流或者自由笔记<ul>
<li>图像流：想象一个问题，观察图像，大声描述出来，努力用各种感官去想象</li>
<li>自由笔记：去写作，不要分心</li>
<li>晨写：让无防备的大脑倾倒想法</li>
<li>利用散步：使用散步，比如在树林或公园等安全的环境里随便走走，做到<strong>心不在焉</strong>，让R型自己工作。</li>
</ul>
</li>
<li><strong>L型是命令性的，主动工作；R性则不能被命令，只能去邀请</strong></li>
<li>R型除了帮助你形成想法，还能帮你发现模式。如代码、神谕</li>
<li>尝试新鲜事物，锻炼大脑</li>
</ul>
<h2 id="调试大脑"><a href="#调试大脑" class="headerlink" title="调试大脑"></a>调试大脑</h2><h3 id="个人概括-3"><a href="#个人概括-3" class="headerlink" title="个人概括"></a>个人概括</h3><p>人的大脑因为进化原因，是有些先天“缺陷”的。你需要了解它们避免决策时的误差。这些“缺陷”在心理学领域的书籍中会有更加详细和科学的<a target="_blank" rel="noopener" href="https://shenlvmeng.github.io/blog/2019/07/26/social-psychology-part-1/">介绍</a>。</p>
<h3 id="摘录-4"><a href="#摘录-4" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li>人具有认知偏见，如思维定势、基本归因错误、自我服务偏见等</li>
<li>大脑处理现实复杂性的方法就是把庞大、复杂的系统符号化为简单易操作的对象。这也使得人类非常不善于从过去的事情推断未来的事情。我们总是假定事情是一个稳定和线性的递进，然而现实是非线性的。<ul>
<li>“很少”不意味着没有，<em>黑天鹅事件</em>总会发生</li>
<li>过早下结论</li>
</ul>
</li>
<li>重视上下文：认清时代影响，一个人的特性可能和其时代有关。</li>
<li>了解个体倾向，每个人有不同的性格特征，<strong>你无法改变别人</strong>。</li>
<li><strong>记住你是高级动物</strong>，在一些时候，避免大脑中进化而来的低级动物逻辑。比如见样学样，非好即坏。</li>
<li>如何避免认识误差：<strong>自我辩论</strong>，如果你认为自己已经明确一些事情，尝试解释一下它的反面</li>
</ul>
<h2 id="主动学习"><a href="#主动学习" class="headerlink" title="主动学习"></a>主动学习</h2><h3 id="个人概括-4"><a href="#个人概括-4" class="headerlink" title="个人概括"></a>个人概括</h3><p>学习能力是可以有一些可量化可落地的手段去提高的。首先，学习一定是个<strong>主动</strong>的过程，你需要明确自己的目标（可以使用SMART模型），建立自己的学习计划。找到更适合自己的感官模式。之后有一些具体的手段，比如<strong>小组学习</strong>、<strong>SQ3R</strong>、<strong>思维导图</strong>、<strong>写文档</strong>、<strong>以教代学</strong>。</p>
<h3 id="摘录-5"><a href="#摘录-5" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li>“大脑不是一个用于灌输的容器，而是一束需要点燃的火焰”<ul>
<li>学习需要你自己主动做</li>
<li>仅仅掌握知识，不去实践，没有用</li>
<li>需要有目标和反馈去纠正效果</li>
</ul>
</li>
<li>SMART帮你明确目标<ul>
<li>Specific，Measurable，Achievable，Relavant，Time-boxed。</li>
<li>具体的：不能只是简单的想法</li>
<li>可度量：可以量化</li>
<li>可实现</li>
<li>相关的：需要能在你掌控中</li>
<li>时间可控的：需要有deadline</li>
</ul>
</li>
<li><strong>时间是无法创造和销毁的</strong></li>
<li>要有知识投资计划，就像理财一样<ul>
<li>设定目标</li>
<li>多样化投资，考虑风险和回报率</li>
<li>主动投资</li>
<li>定期投资：养成一种习惯</li>
</ul>
</li>
<li>总有一种感官模式更适合你：视觉、听觉、动觉</li>
<li>成人更适合<strong>小组学习</strong>，大家一起学习，相互促进，互相学习，学得更有效</li>
<li><strong>相比经验式学习，阅读是一种效率极低的学习方式</strong>，SQ3R让阅读更有效<ul>
<li>Survey、Question、Read、Recite、Review</li>
<li><strong>概览</strong>：粗略阅读目录，形成整体印象</li>
<li><strong>问题</strong>：搞清楚你想弄明白的问题</li>
<li><strong>阅读</strong>：困难的地方可以放慢速度</li>
<li><strong>复述</strong>：合上书本，用R型记忆感受，用你自己的语言复述内容</li>
<li><strong>回顾</strong>：重读，扩展笔记，和人讨论</li>
<li>这个方法也可以用来初高中学习</li>
</ul>
</li>
<li>根据遗忘曲线，可以定期回顾来增强记忆</li>
<li>思维导图提供了更高的自由度来表现关系，更有助于增强连接，获得更多感悟<ul>
<li>绘制思维导图时可以不容那么认真</li>
<li><strong>手写是关键</strong>，动觉可以帮助你在视觉外刺激大脑，加深记忆</li>
<li>探索性的思维导图：想到哪儿画到哪儿，然后再整理，发现模式</li>
</ul>
</li>
<li><strong>写文档的过程比写文档更重要</strong></li>
<li>以教代学可以考验你是否真的理解了，同时解释过程中的隐喻可能会让你有新的收获。<ul>
<li>在给聪明人解释时，对聪明人挑毛病的顾虑也是一大动力</li>
</ul>
</li>
</ul>
<h2 id="经验积累"><a href="#经验积累" class="headerlink" title="经验积累"></a>经验积累</h2><h3 id="个人概括-5"><a href="#个人概括-5" class="headerlink" title="个人概括"></a>个人概括</h3><p>实践是学习中必不可少的一步，如何更有效的从实践中学习也有些诀窍。</p>
<h3 id="摘录-6"><a href="#摘录-6" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li>经验主义：通过实践来构建认知，而不是通过学习来灌输。<ul>
<li>让学习更有趣味性</li>
</ul>
</li>
<li>波利亚的解题法：先确认已知量、未知量、上下文环境。然后有些方法<ul>
<li>努力回忆类似未知量的问题</li>
<li>画图</li>
<li>是否用上所有已知量和条件</li>
<li>换一种问题描述方式</li>
<li>从未知量推到已知量</li>
</ul>
</li>
<li>一个高效有益的学习环境应该允许你<strong>安全和方便</strong>地做3件事情：探索、创造和应用<ul>
<li>在编码领域，这意味着，至少要有<strong>版本控制</strong>、<strong>单元测试</strong>和<strong>项目自动化</strong></li>
</ul>
</li>
<li>失败分两种，其中<strong>没有产生任何知识的失败会阻止我们学习</strong></li>
<li>上下文反馈是一种内在诀窍技术，其让学习者关注于非常简单的反馈循环，避免向学生传授一长串指令，从而形成一种意识，来纠正学生的学习表现。这种意识是非判断性的。内在诀窍的理念关注反馈，以此增长专业知识。</li>
<li>面对时间压力时，人会缺乏创造性。要允许失败。建立允许失败的领域。</li>
<li>参加一个周围都是专家的会议或聚会时，你的能力也会有提高。<strong>我们是天生的模仿者</strong>，把自己想象成专家甚至也有效果。可以想象实践并从中学习，会如同真实体验一样有效</li>
</ul>
<h2 id="注意力控制"><a href="#注意力控制" class="headerlink" title="注意力控制"></a>注意力控制</h2><h3 id="个人概括-6"><a href="#个人概括-6" class="headerlink" title="个人概括"></a>个人概括</h3><p>在信息化社会，过滤信息，管理注意力会提高你的工作效率。一方面要注意积累，管理好个人知识体系；另一方面要管理好自己的上下文，避免频繁切换，保持一个大的上下文环境，不管是物理上的还是软件上的。</p>
<h3 id="摘录-7"><a href="#摘录-7" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li>时间是你自己分配的，并不是我们没有时间了，而是我们的注意力不够</li>
<li>着眼于现在，没有任何分心，没有任何自言自语。缓和L型嘈杂的声音带来的痛苦。<ul>
<li>冥想：学习集中注意力。在冥想中，会沉浸到一种宽松的思维状态中。在这里你可以意识到自己和你的上下文，不用做出任何判断和回应。在这种风格的冥想中，需要做的只是注意自己的呼吸。不要与自己交谈，保持清醒。</li>
</ul>
</li>
<li>在过度几种后，可以有意识地忘掉问题，让问题在思维中“浸泡”一会儿。注意把浸泡和拖延分开。</li>
<li>使用wiki管理自己的知识体系<ul>
<li>wiki页面间的相互链接会形成自然的知识体系和模型</li>
</ul>
</li>
<li>维护上下文的成本时昂贵的，要较好地管理<ul>
<li>避免大脑频繁切换上下文，这样会提高错误率。在深入进行的任务被打断后，需要10~20分钟的时间找回状态</li>
<li>远离会打断思路的工具，比如即时聊天或者邮件</li>
<li>利用外部缓存维护清单，如纸片或多窗口，只在大脑里存储“指针”</li>
<li>切换时，可以做一些记录，方便切换回来</li>
<li>保持足够大的上下文，比如所有信息都放在桌面，或使用多窗口维护上下文栈</li>
<li>管理好你的多窗口</li>
</ul>
</li>
</ul>
<h2 id="超越专家"><a href="#超越专家" class="headerlink" title="超越专家"></a>超越专家</h2><blockquote>
<p>人们看却没有看见，听却没有听见，吃却没有味觉，接触却没有触觉，说话却没有思考. —— 达芬奇</p>
</blockquote>
<h3 id="摘录-8"><a href="#摘录-8" class="headerlink" title="摘录"></a>摘录</h3><ul>
<li>现在就开始动手吧<ul>
<li>有私人wiki，建立知识图谱</li>
<li>给思维放个假，让散步成为生活的一部分</li>
</ul>
</li>
<li>专家容易见怪不怪，要避免这样</li>
</ul>
<p><em>–END–</em></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://shenlvmeng.github.com/blog/2020/05/18/some-tips-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
      <meta itemprop="name" content="shenlvmeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shenlvmeng's Blog">
      <meta itemprop="description" content="Be sharp, my friend.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Shenlvmeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/05/18/some-tips-7/" class="post-title-link" itemprop="url">工作中的遇到的一些小知识 7</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-18 17:02:41" itemprop="dateCreated datePublished" datetime="2020-05-18T17:02:41+08:00">2020-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-05-31 19:00:52" itemprop="dateModified" datetime="2020-05-31T19:00:52+08:00">2020-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">工程</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2020/05/18/some-tips-7/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/05/18/some-tips-7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>DNS作为用来映射域名和IP地址的<strong>分布式</strong>数据库，使用TCP&#x2F;UDP端口号53。其中每一级域名限制63个字符，总长度不超过253个字符。</p>
<p>DNS系统中，常见的资源记录类型有：</p>
<ul>
<li>A（Address）记录：最重要的记录，用于将特定主机名映射到对应主机的IPv4地址上</li>
<li>MX记录：用于将特定邮箱地址映射到对应邮箱服务器上</li>
<li>CNAME（Canonical Name Record）别名记录：用于将某个别名指向某个A记录上</li>
<li>AAAA记录：和A记录对应，用于将特定主机名映射到对应主机的IPv6地址上</li>
</ul>
<p>实现上，全球范围近1000台根域名服务器分为13组，编号A到M，剩下的Internet DNS命名空间被委托给其他DNS服务器。DNS系统也有各种各样的DNS软件所支持，其中最普遍的是BIND（Berkeley Internet Name Domain）。在查询时，有两种实现方式：<strong>递归</strong>和<strong>迭代</strong>，客户端使用递归，DNS服务器间使用迭代。如查询<code>shenlvmeng.github.io</code>（忽略本地host和DNS缓存和路由器DNS缓存）：</p>
<ul>
<li>客户端发送查询报文<code>query shenlvmeng.github.io</code>到边缘DNS服务器（一般是ISP的DNS服务器），DNS先检查缓存，若存在记录则直接返回结果</li>
<li>若不存在或记录已过期，则：<ul>
<li>DNS服务器向根域名服务器发送同样的查询报文，根服务器返回顶级域<code>.io</code>的权威域名服务器地址</li>
<li>DNS服务器向<code>.io</code>域的权威域名服务器发送查询报文，得到二级域<code>.github.io</code>的权威域名服务器地址</li>
<li>DNS服务器向<code>.github.io</code>域的权威域名服务器发送查询报文，得到主机<code>shenlvmeng</code>的A记录，<strong>存入自身缓存，设置TTL</strong>，返回给客户端</li>
</ul>
</li>
</ul>
<p>最初的DNS域名使用字符仅限于ASCII字符的子集，2008年后，ICANN通过决议，可以使用其他语言作为顶级域名的字符，如“xxx.中国”。使用punnycode码的IDNA系统，可以将unicode字符映射为有效的DNS字符集，有效避免IDN欺骗（即使用长得很像的不同字符作为钓鱼网站）。</p>
<p>域名的所有者和IP也可以通过查找WHOIS域名数据库查询。对于大多数根域名，由ICANN维护，WHOIS的细节由控制那个域的域注册机构维护。</p>
<h3 id="域名污染"><a href="#域名污染" class="headerlink" title="域名污染"></a>域名污染</h3><p>指一些刻意制造或无意制造的域名服务器数据包，指向错误的IP地址。这种错误有可能是域名服务器错误工作带来，也有可能是刻意为之。</p>
<p>对于GFW来说，它会对所有经过它的在UDP端口53上的域名查询进行IDS入侵检测，一旦发现与黑名单关键词相匹配的域名查询请求，会伪装成目标域名的解析服务器返回虚假的查询结果。</p>
<ul>
<li>系统默认会从使用ISP提供的域名查询服务器去查询国外的权威服务器时，便被GFW污染，缓存虚假的IP地址。</li>
<li>由于TCP连接的机制可靠，理论上无法对TCP协议的域名查询进行污染，理论上可以通过TCP协议查询真实的IP地址。但其实，对于真实的IP地址，会有其他方式封锁，或对查询行为使用连接重置进行拦截</li>
<li>通常情况下，设置的NDS服务主要使用海外的DNS服务，所以都需要穿过GFW，不过一些小型的DNS有技术手段回避GFW污染，从而能够访问国外被封锁网站</li>
</ul>
<p>ISP域名劫持还包含一些互联网提供商劫持部分域名，转到自己制定的网站，已提供自己的广告。</p>
<h3 id="DNS记录"><a href="#DNS记录" class="headerlink" title="DNS记录"></a>DNS记录</h3><p>在DNS的分布式数据库中，不同记录类型有不同的用途。下面介绍了一些常见的记录类型。</p>
<ul>
<li>A记录，传回一个32位的IPv4地址，映射主机名到IP</li>
<li>AAAA记录，传回一个128位的IPv6地址，映射主机名到IP</li>
<li>CNAME：一个主机名的别名，只能指向一个域名，不能指向IP地址，可以保证原域名地址映射IP地址修改时，别名也能同步修改。CNAME意为真实名称，所以应当读作<code>alias.com</code>的“CNAME“是<code>real.com</code>。为保证效率，应当避免CNAME指向其他CNAME。</li>
<li>DNAME，和CNAME类似，不过不是映射域名，而是把域名下的整个解析子树映射到另一域名。如把<code>alias.com</code>DNAME到<code>real.com</code>后，不影响<code>alias.com</code>的原有的解析设置。而<code>xxx.alias.com</code>都会被映射到<code>xxx.real.com</code>上</li>
<li>MX（邮件交换）记录，将邮箱后缀（<code>@</code>后的部分）映射到类型为A或者AAAA的地址记录，原则上禁止映射到CNAME上</li>
<li>NS记录，委托DNS区域使用已提供的权威域名服务器</li>
<li>SRV记录，进行服务定位</li>
</ul>
<p>所有的记录都有一个有效期（TTL，time-to-live），时间耗尽后，所包含的信息必须从权威服务器上得到更新。</p>
<h2 id="useState和useEffect实现思路"><a href="#useState和useEffect实现思路" class="headerlink" title="useState和useEffect实现思路"></a><code>useState</code>和<code>useEffect</code>实现思路</h2><p>这两个React hooks中引入的特性背后是基于闭包 + 数组索引实现的，下面是一个实现的demo。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useState</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">values</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line"><span class="keyword">let</span> cursor = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> useState&lt;T&gt;(<span class="attr">initialState</span>: T): [T, <span class="function">(<span class="params">newState: T</span>) =&gt;</span> <span class="built_in">void</span>] &#123;</span><br><span class="line">	<span class="keyword">const</span> currentCursor = cursor;</span><br><span class="line">	values[currentCursor] = values[currentCursor] || initialState;</span><br><span class="line">	<span class="keyword">const</span> <span class="title function_">setFunc</span> = (<span class="params">newState: T</span>) =&gt; &#123;</span><br><span class="line">		values[currentCursor] = newState;</span><br><span class="line">    <span class="comment">// 触发重新渲染</span></span><br><span class="line">		<span class="title function_">renderApp</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	cursor++;</span><br><span class="line">	<span class="keyword">return</span> [values[currentCursor], setFunc];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;&#123;&#125;&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> [num, setNum] = useState&lt;<span class="built_in">number</span>&gt;(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setNum(num + 1)&#125;&gt;&#123;num&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderApp</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br><span class="line">  <span class="comment">// 重置计数器</span></span><br><span class="line">	cursor = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">renderApp</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// useEffect</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">deps</span>: <span class="built_in">any</span>[][] = [];</span><br><span class="line"><span class="keyword">let</span> cursor = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useEffect</span>(<span class="params">cb: () =&gt; <span class="built_in">void</span>, dep: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> currCursor = cursor;</span><br><span class="line">	<span class="keyword">if</span> (!deps[currCursor]) &#123;</span><br><span class="line">		deps[currCursor] = dep;</span><br><span class="line">		cursor++;</span><br><span class="line">		<span class="title function_">cb</span>();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dep.<span class="title function_">some</span>(<span class="function">(<span class="params">d, index</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (d !== deps[currCursor][index]) &#123;</span><br><span class="line">			deps[currCursor][index] = d;</span><br><span class="line">			cursor++;</span><br><span class="line">			<span class="title function_">cb</span>();</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;&#123;&#125;&gt; = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ok&#x27;</span>), <span class="number">1000</span>);</span><br><span class="line">	&#125;, []);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>ok<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderApp</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br><span class="line">	cursor = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">renderApp</span>();</span><br></pre></td></tr></table></figure>

<p>实际使用中，是把<code>useState</code>、<code>useEffect</code>这样的hooks放在<code>memorizedState</code>数组中，共用一个cursor。类似下面这样：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> memoizedState = [];</span><br><span class="line"><span class="keyword">let</span> cursor = <span class="number">0</span>; <span class="comment">// 当前下标</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">initialValue</span>) &#123;</span><br><span class="line">  memoizedState[cursor] = memoizedState[cursor] || initialValue;</span><br><span class="line">  <span class="keyword">const</span> currentCursor = cursor;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setState</span>(<span class="params">newState</span>) &#123;</span><br><span class="line">    memoizedState[currentCursor] = newState;</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [memoizedState[cursor++], setState];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useEffect</span>(<span class="params">callback, depArray</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hasNoDeps = !depArray;</span><br><span class="line">  <span class="keyword">const</span> deps = memoizedState[cursor];</span><br><span class="line">  <span class="keyword">const</span> hasChangedDeps = deps</span><br><span class="line">    ? !depArray.<span class="title function_">every</span>(<span class="function">(<span class="params">el, i</span>) =&gt;</span> el === deps[i])</span><br><span class="line">    : <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (hasNoDeps || hasChangedDeps) &#123;</span><br><span class="line">    <span class="title function_">callback</span>();</span><br><span class="line">    memoizedState[cursor] = depArray;</span><br><span class="line">  &#125;</span><br><span class="line">  cursor++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>memorized</code>数组也是hooks一定要在top level调用的原因。</p>
<p>在React实际实现上，hooks是以链表的形式存储，通过<code>next</code>属性链接到下一个hook。同时每一个<code>memorized</code>数组都会绑定到一个fiber上，从而在再次渲染时更新对应节点。让hooks之间互不干扰。</p>
<h2 id="proxy简单了解与应用"><a href="#proxy简单了解与应用" class="headerlink" title="proxy简单了解与应用"></a>proxy简单了解与应用</h2><p>Vue 3.0在重构后使用了ES6的proxy新特性来跟踪数据字段的更新。它可以封装一个目标对象，为之添加一个代理，返回一个Proxy对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler)</span><br></pre></td></tr></table></figure>

<p>其中<code>handler</code>即代理配置对象，也是Proxy对象的“魔力”所在。对于一个空的handler，返回的Proxy近似于target本身。在handler上定义任何handler函数的集合，都会让返回Proxy对象有不同的表现。</p>
<p><code>handler</code>有下面一些可选的属性：</p>
<ul>
<li><code>apply</code> 监听函数调用的钩子<ul>
<li><code>apply: function(target, thisArg, argumentsList) &#123;&#125;</code></li>
</ul>
</li>
<li><code>construct</code> 监听使用<code>new</code>调用的钩子<ul>
<li><code>construct: function(target, argumentsList, newTarget) &#123;&#125;</code></li>
</ul>
</li>
<li><code>defineProperty</code> 类似<code>Object.defineProperty</code><ul>
<li><code>defineProperty: function(target, property, descriptor) &#123;&#125;</code></li>
</ul>
</li>
<li><code>get</code> 监听属性访问<ul>
<li><code>get: function(target, property, receiver) &#123;&#125;</code></li>
</ul>
</li>
<li><code>deleteProperty</code> 监听<code>delete</code>操作<ul>
<li><code>deleteProperty: function(target, property) &#123;&#125;</code></li>
</ul>
</li>
<li><code>getOwnPropertyDescriptor</code> 监听<code>Object.getOwnPropertyDescriptor</code></li>
<li><code>getPrototypeOf()</code> 类似<code>Object.getPrototypeOf</code></li>
<li><code>has</code> 监听<code>in</code>操作<ul>
<li><code>has: function(target, prop) &#123;&#125;</code></li>
</ul>
</li>
<li><code>isExtensible</code> 监听<code>Object.isExtensible</code></li>
<li><code>ownKeys</code> 监听<code>Object.getOwnPropertyNames</code>和<code>Object.getOwnPropertySymbols</code></li>
<li><code>preventExtensions</code> 监听<code>Object.preventExtensions</code></li>
<li><code>set</code> 监听属性设置<ul>
<li><code>set: function(target, property, value, receiver) &#123;&#125;</code></li>
</ul>
</li>
<li><code>setPrototypeOf</code> 类似<code>Object.setPrototypeOf</code></li>
</ul>
<p>利用上面的<code>handler</code>已经可以实现很丰富的功能，immer的produce就有借助proxy来实现。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://shenlvmeng.github.com/blog/2020/04/17/fe-coverage-improve/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
      <meta itemprop="name" content="shenlvmeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shenlvmeng's Blog">
      <meta itemprop="description" content="Be sharp, my friend.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Shenlvmeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/04/17/fe-coverage-improve/" class="post-title-link" itemprop="url">前端代码覆盖率实时统计改进方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-04-17 00:08:03 / 修改时间：00:16:26" itemprop="dateCreated datePublished" datetime="2020-04-17T00:08:03+08:00">2020-04-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2020/04/17/fe-coverage-improve/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/04/17/fe-coverage-improve/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p><a target="_blank" rel="noopener" href="https://shenlvmeng.github.io/blog/2020/04/16/fe-coverage-scheme/">旧的覆盖率方案</a>实现了覆盖率采集的可行性探索。但是旧方案中也存在着侵入较多，适用场景有局限性，istanbul版本老旧，sourcemap支持不足等问题需要优化。有关覆盖率采集、维护、呈现、上报需要一个更通用和更具可拓展性的方案。</p>
<p>因此，在对整个覆盖率要解决的问题和目标进行抽象后，可以得到以下的实现方案。</p>
<h2 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h2><p><img src="https://s1.ax1x.com/2020/04/16/JEZ1J0.png" alt="整体结构"></p>
<p>新的覆盖率方案可以分为3层：</p>
<ul>
<li><strong>采集层</strong>，这一层主要解决对代码进行<strong>插桩</strong>（instrument）的过程，只有插桩过的代码才能在执行的过程中不断积累覆盖率数据，从而通过端到端测试得到代码的覆盖率情况</li>
<li><strong>数据层</strong>，采集到的覆盖率数据有上报的需求，浏览器端数据只有上报到服务端才能查看和操作，如果接入第三方平台，就更需要有专门数据<strong>处理和上报</strong>，这一层正是完成这部分工作</li>
<li><strong>视图层</strong>，方案要自带<strong>视图化</strong>能力，给开发者更直观的反馈，同时要有<strong>可交互性</strong>，满足开发者的日常需求。这一层要能比较方便地绑定到流行的服务端环境中，减少侵入成本</li>
</ul>
<p>整体实现上，基于新版本<a target="_blank" rel="noopener" href="https://github.com/gotwarlost/istanbul">istanbuljs</a>。下面分层介绍各层实现中需要进行的工作。</p>
<h2 id="采集层"><a href="#采集层" class="headerlink" title="采集层"></a>采集层</h2><p>代码插桩实现中，拆分为下面几点：</p>
<h3 id="babel-preset"><a href="#babel-preset" class="headerlink" title="babel preset"></a>babel preset</h3><p>对于使用babel转码的工程来说，<a target="_blank" rel="noopener" href="https://github.com/istanbuljs/babel-plugin-istanbul">babel-plugin-istanbul</a>直接提供了一个可以插桩代码的插件。这里要做的只是区分线上和其他环境，以及预定义preset，减少用户babel配置成本。</p>
<p>babel preset的书写可以参考<a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/presets#creating-a-preset">babel preset</a>一节，我们只需将原先<code>.babelrc</code>或<code>babel.config.js</code>中的配置项用<code>require</code>包裹即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">env</span>: &#123;</span><br><span class="line">            <span class="attr">development</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                    [<span class="built_in">require</span>(<span class="string">&#x27;babel-plugin-istanbul&#x27;</span>)]</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">boe</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                    [<span class="built_in">require</span>(<span class="string">&#x27;babel-plugin-istanbul&#x27;</span>)]</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>相对应的，接入方需要额外在<code>scm_build.sh</code>脚本中额外传入boe环境变量来区分boe和线上环境：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="variable">$BUILD_TYPE</span> = <span class="string">&quot;offline&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    BABEL_ENV=boe yarn build</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    yarn build</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>同时，默认情况下，istanbul只会对后缀为<code>[&#39;.js&#39;, &#39;.cjs&#39;, &#39;.mjs&#39;, &#39;.ts&#39;, &#39;.tsx&#39;, &#39;.jsx&#39;]</code>的文件进行处理，为了处理<code>.vue</code>文件，需要显式给<code>babel-plugin-istanbul</code>文件传入<code>extension</code>字段。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">env</span>: &#123;</span><br><span class="line">            <span class="attr">development</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                    [<span class="built_in">require</span>(<span class="string">&#x27;babel-plugin-istanbul&#x27;</span>), &#123; <span class="attr">extension</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.cjs&#x27;</span>, <span class="string">&#x27;.mjs&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>, <span class="string">&#x27;.vue&#x27;</span>] &#125;]</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">boe</span>: &#123;</span><br><span class="line">                <span class="attr">plugins</span>: [</span><br><span class="line">                    [<span class="built_in">require</span>(<span class="string">&#x27;babel-plugin-istanbul&#x27;</span>), &#123; <span class="attr">extension</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.cjs&#x27;</span>, <span class="string">&#x27;.mjs&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>, <span class="string">&#x27;.vue&#x27;</span>] &#125;]</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="hookRequire动态插桩"><a href="#hookRequire动态插桩" class="headerlink" title="hookRequire动态插桩"></a><code>hookRequire</code>动态插桩</h3><p>有些场景下并不使用babel进行转码，这里以最典型的TypeScript为例，<code>.ts</code>文件可以用<code>tsc</code>编译。<code>tsc</code>编译后的js代码只有插桩后，才可能采集到的覆盖率数据，因此接入方需要在所有业务代码的import之前调用hook，保证所有的服务端js代码在被执行前都完成了插桩。</p>
<p>实现上，新版本istanbuljs整个是个monorepo，原来istanbul各模块的功能拆分到了packages的各子项目中。其中和hook相关的位于<strong>istanbul-lib-hook</strong>。这个库虽然并没有API和文档。但还好，和老版本的hook.js区别不大。使用暴露出来的<strong>hookRequire</strong>方法即可，使用方式也与之前无异。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// old</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> istanbul <span class="keyword">from</span> <span class="string">&#x27;istanbul&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; hook &#125; = istanbul;</span><br><span class="line"></span><br><span class="line">instrumenter = <span class="keyword">new</span> <span class="title class_">Instrumenter</span>(options);</span><br><span class="line"><span class="keyword">const</span> transformer = instrumenter.<span class="property">instrumentSync</span>.<span class="title function_">bind</span>(instrumenter);</span><br><span class="line">hook.<span class="title function_">hookRequire</span>(matcher, transformer, &#123;</span><br><span class="line">    <span class="attr">postLoadHook</span>: <span class="function">(<span class="params">file: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// new</span></span><br><span class="line"><span class="keyword">import</span> &#123; hookRequire &#125; <span class="keyword">from</span> <span class="string">&#x27;istanbul-lib-hook&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createInstrumenter &#125; <span class="keyword">from</span> <span class="string">&#x27;istanbul-lib-instrument&#x27;</span>;</span><br><span class="line"></span><br><span class="line">instrumenter = <span class="title function_">createInstrumenter</span>(options);</span><br><span class="line"><span class="keyword">const</span> transformer = instrumenter.<span class="property">instrumentSync</span>.<span class="title function_">bind</span>(instrumenter);</span><br><span class="line"><span class="title function_">hookRequire</span>(matcher, transformer, &#123;</span><br><span class="line">    <span class="attr">postLoadHook</span>: <span class="function">(<span class="params">file: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>hookRequire</code>方法接受3个参数：</p>
<ul>
<li><code>matcher</code>，来自用户输入，用来判断当前文件是否要被hook</li>
<li><code>transformer</code>，最关键的代码转换函数，读入代码，返回转换后的代码，插桩的转换由<strong>istanbul-lib-instrument</strong>提供（原先的instrumenter.js），理论上也能支持其他的转换函数。这里使用<code>instrumentSync</code>这个同步转换。</li>
<li><code>options</code>，支持verbose和postLoadHook两个选项<ul>
<li><code>verbose</code>，boolean，是否打印详细日志</li>
<li><code>postLoadHook</code>，function，成功回调，函数会传入完整的文件名</li>
</ul>
</li>
</ul>
<h3 id="sourcemap处理"><a href="#sourcemap处理" class="headerlink" title="sourcemap处理"></a>sourcemap处理</h3><p>由于istanbuljs插桩的是编译后的js代码，需要借助sourcemap才能找到源文件的覆盖情况。编译后文件的覆盖情况对开发者没有借鉴意义。使用<code>hookRequire</code>动态插桩时，还是需要自己处理sourcemap。</p>
<p>老版本istanbul对sourcemap并不支持，需要借助<a target="_blank" rel="noopener" href="https://github.com/SitePen/remap-istanbul">remap-istanbul</a>才能实现。新版本的istanbuljs有一个独立的包<strong>istanbul-lib-source-maps</strong>支持这方面的功能。遗憾的是，再次没有文档介绍如何使用。</p>
<p>通过查看测试样例和阅读源码可以发现，istanbul-lib-instrument中的<code>instrumentSync</code>支持第三个<code>sourcemap</code>参数，如果传入，则会在采集文件的覆盖率数据中附加该文件的sourcemap信息到<code>inputSourceMap</code>字段。而istanbul-lib-source-maps这个包可以对覆盖率数据中带有<code>inputSourceMap</code>字段的数据进行反映射，得到源文件覆盖情况。最终达到我们的目的。</p>
<p>源文件的sourcemap信息需要自己采集，这里借鉴的nyc中使用的方案：<a target="_blank" rel="noopener" href="https://github.com/thlorenz/convert-source-map">convert-source-map</a>。这个npm包可以读取文件末尾的sourcemap字符串并转换为sourcemap对象。所以整体上，实现sourcemap处理的流程如下：</p>
<ol>
<li>在hookRequire的transformer中拿到代码字符串</li>
<li>通过convert-source-map的<code>fromSource</code>方法拿到sourcemap对象</li>
<li>在调用istanbul-lib-instrument的<code>instrumentSync</code>方法时，传入该对象<ol>
<li>instrumenter内部的visitor.js调用source-coverage.js的<code>inputSourceMap</code>方法将文件的sourcemap传入</li>
<li>source-coverage.js将sourcemap存入覆盖率数据中</li>
</ol>
</li>
<li>使用istanbul-lib-source-maps中的<code>transformCoverage</code>方法转换覆盖率数据即可得到原始的覆盖率</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createInstrumenter &#125; <span class="keyword">from</span> <span class="string">&#x27;istanbul-lib-instrument&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> convert <span class="keyword">from</span> <span class="string">&#x27;convert-source-map&#x27;</span>;</span><br><span class="line"></span><br><span class="line">instrumenter = <span class="title function_">createInstrumenter</span>(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Step 1</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">transformer</span>: <span class="title class_">Transformer</span> = <span class="function">(<span class="params">code, options</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Step 2</span></span><br><span class="line">    <span class="keyword">const</span> sourceMap = convert.<span class="title function_">fromSource</span>(code);</span><br><span class="line">    <span class="comment">// Step 3</span></span><br><span class="line">    <span class="keyword">const</span> transformed = instrumenter.<span class="title function_">instrumentSync</span>(</span><br><span class="line">        code,</span><br><span class="line">        options.<span class="property">filename</span>,</span><br><span class="line">        sourceMap ? sourceMap.<span class="title function_">toObject</span>() : <span class="literal">undefined</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> transformed;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">hook</span>(matcher, transformer, &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="数据层"><a href="#数据层" class="headerlink" title="数据层"></a>数据层</h2><p>在覆盖率数据维护上，主要有下面几点工作：</p>
<h3 id="sourcemap处理-1"><a href="#sourcemap处理-1" class="headerlink" title="sourcemap处理"></a>sourcemap处理</h3><p>在代码插桩附带上sourcemap信息后，可以参考istanbul-lib-source-maps的测试用例，用<code>transformCoverage</code>方法转换得到原始的覆盖率，即上一个同名小节中的第4步。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getOriginalCoverage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 采集到的覆盖率</span></span><br><span class="line">    <span class="keyword">const</span> currCoverage = <span class="variable language_">this</span>.<span class="title function_">getCoverage</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">const</span> coverageMap = <span class="title function_">createCoverageMap</span>(currCoverage);</span><br><span class="line">    <span class="keyword">const</span> mapStore = <span class="title function_">createSourceMapStore</span>(&#123;&#125;);</span><br><span class="line">    <span class="comment">// Step 4</span></span><br><span class="line">    <span class="keyword">const</span> transformed = <span class="keyword">await</span> mapStore.<span class="title function_">transformCoverage</span>(coverageMap);</span><br><span class="line">    <span class="comment">// 对应到源文件的覆盖率</span></span><br><span class="line">    <span class="keyword">return</span> transformed.<span class="property">data</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现时，还需要注意对一些sourcemap结构体中的<code>sourceRoot</code>进行特殊处理，避免反映射后得到嵌套的错误路径。</p>
<h3 id="覆盖率数据维护"><a href="#覆盖率数据维护" class="headerlink" title="覆盖率数据维护"></a>覆盖率数据维护</h3><p>在一个测试覆盖率的周期下，需要merge每次产生的新的覆盖率。同时，要能通过原始的覆盖率数据生成摘要，方便UI展示。</p>
<p>istanbul-lib-coverage的<code>CoverageMap</code>类型自带的<code>merge</code>方法，可以merge新的覆盖率数据到源<code>CoverageMap</code>中。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mergeClientCoverage</span>(<span class="params">clientCoverage: CoverageMap</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!clientCoverage) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> currCoverage = <span class="title function_">getCoverageObject</span>();</span><br><span class="line">    <span class="keyword">const</span> coverageMap = <span class="title function_">createCoverageMap</span>(currCoverage)</span><br><span class="line">    coverageMap.<span class="title function_">merge</span>(clientCoverage)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="基准覆盖数据维护"><a href="#基准覆盖数据维护" class="headerlink" title="基准覆盖数据维护"></a>基准覆盖数据维护</h3><p>有些js代码在未访问到业务代码时就会被执行到，比如<code>import</code>和<code>export</code>语句。这些覆盖率如果被清空，就再也无法通过端到端测试找回来，所以需要对于这部分覆盖数据专门维护，这里称作<strong>基准覆盖数据</strong>。</p>
<p>实现上，在hook完成后，取得hook文件的覆盖率数据，即可得到。这里需要异步执行，保证能够取到。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">hook</span>(matcher, transformer, &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">postLoadHook</span>: <span class="function">(<span class="params">filename: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="title function_">matcher</span>(filename) &amp;&amp; <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title class_">Coverage</span>.<span class="title function_">saveBaselineCoverage</span>(filename));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>每次reset操作，实现上并非简单的清空数据，而是将覆盖率数据置为基准覆盖数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/reset&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Coverage</span>.<span class="title function_">restoreBaselineCoverage</span>();</span><br><span class="line">    res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">0</span> &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="数据上报"><a href="#数据上报" class="headerlink" title="数据上报"></a>数据上报</h3><p>数据上报只需实现定期上报，在上报时通过使用方预先定义好的中间件，便于使用方做预处理的工作。同时，提供一个关闭方法，可以在适当时机停止上报，形如：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CoverageCollector</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="title function_">use</span>(<span class="params">middleware: Middleware</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">middlewares</span>.<span class="title function_">push</span>(middleware);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">intervalFlag</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">intervalFlag</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">send</span>(), <span class="variable language_">this</span>.<span class="property">interval</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">intervalFlag</span>) &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalFlag</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">intervalFlag</span> = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">send</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">const</span> coverageData = <span class="variable language_">this</span>.<span class="property">middlewares</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">data, middle</span>) =&gt;</span> <span class="title function_">middle</span>(data), coverage);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="variable language_">this</span>.<span class="property">url</span>, coverageData);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">log</span>(<span class="string">&#x27;Send coverage data failed: &#x27;</span>, err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h2><p>视图化和可操作性上，有下面几点工作：</p>
<h3 id="路由提供"><a href="#路由提供" class="headerlink" title="路由提供"></a>路由提供</h3><p>中间件对于开发者的受益，体现在能够通过浏览器访问得到视图化和可操作性的覆盖率数据。在功能上，中间件提供5个路由：</p>
<ul>
<li><code>/</code>，GET，提供整个项目的覆盖率摘要页面</li>
<li><code>/show</code>，GET，访问文件或文件夹时，提供文件覆盖率详情或文件夹覆盖率摘要</li>
<li><code>/reset</code>，POST，重置当前项目的覆盖率，开始一次新的采集周期</li>
<li><code>/object</code>，GET，返回覆盖率的原始数据的JSON格式</li>
<li><code>/client</code>，POST，用来接收来自浏览器端的覆盖率数据，merge到整体的覆盖率数据中</li>
</ul>
<p>实现上，直接提供预定义好的app或express应用，npm包暴露一个attachHandler API，使用方直接挂载即可拥有上述功能。类似下面所示。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="title function_">mount</span>(<span class="string">&#x27;/coverage&#x27;</span>, attachHandler.<span class="title function_">koa</span>()));</span><br></pre></td></tr></table></figure>

<p>由于绑定一定发生在服务端环境，可以的话，需要顺便区分线上和其他环境。</p>
<h3 id="报告html页面生成"><a href="#报告html页面生成" class="headerlink" title="报告html页面生成"></a>报告html页面生成</h3><p>开发者应该能在每个测试周期内（即请求<code>/reset</code>前），通过访问特定路由得到渲染好的html页面。istanbuljs通过istanbul-lib-report和istanbul-reports两个包相互配合实现导出report的功能。其中：</p>
<ul>
<li>istanbul-lib-report：重点负责构建文件层级结构和生成摘要数据，定义遍历每个节点时行为的几个抽象类</li>
<li>istanbul-reports：重点实现各种各样导出格式下内容的生成（只考虑了生成静态文件），通过实现istanbul-lib-report中ReportBase基类，完成遍历中内容的生成</li>
</ul>
<p>下面是README.md给出的示例</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> libReport = <span class="built_in">require</span>(<span class="string">&#x27;istanbul-lib-report&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> reports = <span class="built_in">require</span>(<span class="string">&#x27;istanbul-reports&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// coverageMap, for instance, obtained from istanbul-lib-coverage</span></span><br><span class="line"><span class="keyword">const</span> coverageMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> configWatermarks = &#123;</span><br><span class="line">    <span class="attr">statements</span>: [<span class="number">50</span>, <span class="number">80</span>],</span><br><span class="line">    <span class="attr">functions</span>: [<span class="number">50</span>, <span class="number">80</span>],</span><br><span class="line">    <span class="attr">branches</span>: [<span class="number">50</span>, <span class="number">80</span>],</span><br><span class="line">    <span class="attr">lines</span>: [<span class="number">50</span>, <span class="number">80</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create a context for report generation</span></span><br><span class="line"><span class="keyword">const</span> context = libReport.<span class="title function_">createContext</span>(&#123;</span><br><span class="line">    <span class="attr">dir</span>: <span class="string">&#x27;report/output/dir&#x27;</span>,</span><br><span class="line">    <span class="comment">// The summarizer to default to (may be overridden by some reports)</span></span><br><span class="line">    <span class="comment">// values can be nested/flat/pkg. Defaults to &#x27;pkg&#x27;</span></span><br><span class="line">    <span class="attr">defaultSummarizer</span>: <span class="string">&#x27;nested&#x27;</span>,</span><br><span class="line">    <span class="attr">watermarks</span>: configWatermarks,</span><br><span class="line">    coverageMap,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an instance of the relevant report class, passing the</span></span><br><span class="line"><span class="comment">// report name e.g. json/html/html-spa/text</span></span><br><span class="line"><span class="keyword">const</span> report = reports.<span class="title function_">create</span>(<span class="string">&#x27;json&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">skipEmpty</span>: configSkipEmpty,</span><br><span class="line">    <span class="attr">skipFull</span>: configSkipFull</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// call execute to synchronously create and write the report to disk</span></span><br><span class="line">report.<span class="title function_">execute</span>(context)</span><br></pre></td></tr></table></figure>

<p>在istanbul-reports&#x2F;lib&#x2F;html中主要定义了html相关内容的生成，但是其中对于fs模块的使用，限制了该npm包在server侧的应用。经过<a target="_blank" rel="noopener" href="https://github.com/istanbuljs/istanbuljs/issues/530">询问作者</a>得到，istanbuljs并没有想法支持动态生成html响应。另外，istanbul-lib-report和istanbul-reports关联较多，新开发一个report类型用于生成html响应成本较大。</p>
<p>综上，使用旧的方案，即旧版本istanbul生成html响应比较合适。</p>
<h2 id="新方案"><a href="#新方案" class="headerlink" title="新方案"></a>新方案</h2><p>上述工作完成后，最终可以实现一个新的覆盖率方案，基本解决了上面提到的侵入较多，适用场景有局限性，istanbul版本老旧，sourcemap支持不足等问题。</p>
<h2 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h2><p>上面的改进方案解决了方案接入上的困难，和实现上的一些纰漏，满足了开发者自测时的需求。但同时也有以下不足：</p>
<ul>
<li>对于更复杂的数据呈现和与业务流程的整合，即<a target="_blank" rel="noopener" href="https://shenlvmeng.github.io/blog/2020/04/16/fe-coverage-scheme/">旧方案</a>已知问题的第4点：“不能以分支、版本、仓库等空间维度或以历史信息、趋势等时间维度查看覆盖率报告，也没有diff内容覆盖率功能”，还需要更多努力。</li>
<li>对于一些特殊场景，如没有使用babel转码的纯前端，不使用express或koa框架的服务端等无法支持</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/thlorenz/convert-source-map">convert-source-map</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/istanbuljs/istanbuljs">istanbuljs</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/istanbuljs/nyc">nyc</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/blog/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/blog/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/31/">31</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/blog/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2014 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shenlvmeng</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">1.1m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">29:47</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.14.3/algoliasearch-lite.umd.js" integrity="sha256-dyJcbGuYfdzNfifkHxYVd/rzeR6SLLcDFYEidcybldM=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.49.2/instantsearch.production.min.js" integrity="sha256-Nu8yqoXoRZEVYyZf4/eY1V4FsenbiCw85RY3gWjN3zQ=" crossorigin="anonymous"></script><script src="/blog/js/third-party/search/algolia-search.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/blog/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"shenlvmengs-blog","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/blog/js/third-party/comments/disqus.js"></script>

</body>
</html>
