{
    "version": "https://jsonfeed.org/version/1",
    "title": "Shenlvmeng's Blog • All posts by \"爬虫\" tag",
    "description": "Be sharp, my friend.",
    "home_page_url": "http://shenlvmeng.github.com/blog",
    "items": [
        {
            "id": "http://shenlvmeng.github.com/blog/2015/01/09/compus-flow-chart-1/",
            "url": "http://shenlvmeng.github.com/blog/2015/01/09/compus-flow-chart-1/",
            "title": "校园网流量计开发心得 - 上",
            "date_published": "2015-01-09T13:28:56.000Z",
            "content_html": "<p>2015新年伊始，校园网开始收费。明光村职业学院免费上网的岁月一去不返。我等广大群众感慨之际，突然发现流量用得如此之快。身边的朋友也开始渐渐对看视频心有余悸，对实时流量（此处仅指收费的v4校外流量）的关注也日渐升级。校园网流量计的想法便这样出现了。</p>\n<p>p.s. 鉴于开发过程中，有队友的加入，所以下文按照<em>时间顺序</em>而非严格的<em>逻辑顺序</em>进行，望读者谅解。</p>\n<p>背景话毕，如何分解我们的需求呢？要想让流量数据可视化，当然又必不可少的两点：a）数据 b）可视化。具体说来便是：</p>\n<ul>\n<li>怎么拿到流量数据</li>\n<li>怎么更友好的用图表的形式展示</li>\n</ul>\n<p>这么一想，解决方案就出来了。</p>\n<h2 id=\"最初设计\"><a href=\"#最初设计\" class=\"headerlink\" title=\"最初设计\"></a>最初设计</h2><p>考虑到用户对流量实时性了解的需要，决定用动态的折线图呈现最终效果。折线图能显示最近半小时内校园网流量的变化，每约30s采集一次数据。</p>\n<h2 id=\"爬虫程序\"><a href=\"#爬虫程序\" class=\"headerlink\" title=\"爬虫程序\"></a>爬虫程序</h2><p>既然要收费，学校必定会给学生查看流量的渠道。<a href=\"http://netaccount.bupt.edu.cn/\" title=\"网络自服务窗口\">netaccount.bupt.edu.cn</a>需要离线后才能查看，<a href=\"http://10.3.8.211/\">上网注销窗</a>是最好的选择，每次刷新即可显示当前上线时间，使用流量，剩余网费，很直观；最重要的是每次刷新都能得到实时数据。就爬它了！</p>\n<p>写爬虫程序的语言可以有很多，从Java到python到php到js甚至windows shell都可以轻松完成这个简易的爬虫任务：爬取html页面，匹配流量字段，存储。</p>\n<p>在爬之前，我们需要知道流量值藏在html页面代码的什么地方。打开开发者工具，代码一览无余。</p>\n<p>从flow的大小来看，存储的单位是KB，没关系&#x2F;1024&#x2F;1024就行了。准备工作做完后，可以开始码代码了。python比较好上手，我们暂时选择python写爬虫。不说废话，直接上干货。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\">#---------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">#   程序：网关爬虫</span></span><br><span class=\"line\"><span class=\"comment\">#   版本：0.2</span></span><br><span class=\"line\"><span class=\"comment\">#   作者：xym</span></span><br><span class=\"line\"><span class=\"comment\">#   日期：2014-01-03</span></span><br><span class=\"line\"><span class=\"comment\">#   语言：Python 2.7</span></span><br><span class=\"line\"><span class=\"comment\">#   功能：输出当前已用流量</span></span><br><span class=\"line\"><span class=\"comment\">#---------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">#import urllib</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib2</span><br><span class=\"line\"><span class=\"keyword\">import</span> cookielib</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">GATE_Spider</span>:  </span><br><span class=\"line\">    <span class=\"comment\"># 申明相关的属性  </span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):    </span><br><span class=\"line\">        self.loginUrl = <span class=\"string\">&#x27;http://10.3.8.211&#x27;</span>           <span class=\"comment\"># 网关url</span></span><br><span class=\"line\">        self.cookieJar = cookielib.CookieJar()        <span class=\"comment\"># 初始化一个CookieJar来处理Cookie的信息</span></span><br><span class=\"line\">        self.flow = []      <span class=\"comment\">#存储流量</span></span><br><span class=\"line\">        self.flow_json = []</span><br><span class=\"line\">        self.opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(self.cookieJar))</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">flow_init</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>): </span><br><span class=\"line\">            <span class=\"comment\"># 初始化链接并且获取cookie</span></span><br><span class=\"line\">            myRequest = urllib2.Request(url = self.loginUrl)<span class=\"comment\"># 发送查看请求</span></span><br><span class=\"line\">            result = self.opener.<span class=\"built_in\">open</span>(myRequest)            <span class=\"comment\"># 得到上网注销窗</span></span><br><span class=\"line\">            <span class=\"comment\"># 打印返回的内容 调试用</span></span><br><span class=\"line\">            <span class=\"comment\"># print result.read()</span></span><br><span class=\"line\">            self.deal_data(result.read().decode(<span class=\"string\">&#x27;gbk&#x27;</span>))</span><br><span class=\"line\">            self.flow_json = json.dumps(self.flow,indent=<span class=\"number\">2</span>,separators=(<span class=\"string\">&#x27;,&#x27;</span>,<span class=\"string\">&#x27;:&#x27;</span>))</span><br><span class=\"line\">            self.cal_data(self.flow);</span><br><span class=\"line\">            time.sleep(<span class=\"number\">5</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 抠出流量并换算</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">deal_data</span>(<span class=\"params\">self,myPage</span>):  </span><br><span class=\"line\">        myFlow = re.search(<span class=\"string\">r&#x27;;flow=\\&#x27;\\d+&#x27;</span>,myPage)</span><br><span class=\"line\">        myFlow = re.search(<span class=\"string\">r&#x27;\\d+&#x27;</span>,myFlow.group(<span class=\"number\">0</span>))      </span><br><span class=\"line\">        self.flow.append(&#123;<span class=\"string\">&#x27;flow&#x27;</span>:<span class=\"built_in\">float</span>(myFlow.group(<span class=\"number\">0</span>).encode(<span class=\"string\">&#x27;gbk&#x27;</span>))/<span class=\"number\">1024</span>,<span class=\"string\">&#x27;time&#x27;</span>:time.time()&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 储存流量</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">cal_data</span>(<span class=\"params\">self,items</span>):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;./new.dat&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            f.write(self.flow_json)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#调用  </span></span><br><span class=\"line\">mySpider = GATE_Spider()  </span><br><span class=\"line\">mySpider.flow_init()</span><br></pre></td></tr></table></figure>\n<p>思路很清晰，因为登录工作在程序运行前已经完成，cookie已经存在本地，每次刷新只是简单地GET请求而已。所以在初始化后，只需模拟GET请求，拿到回复后，匹配第一次出现的flow和fee即可，以标准的json格式存储在.dat文件里，每过30s循环一次。</p>\n<p>p.s.有意思的是，上网注销窗那里的MB竟然是字符串拼接拼出来的，直接&#x2F;1024就可以得到的结果却都两个大圈子才拼出来，不知目的在哪里。。。</p>\n<p>好了，测试之后，文件里已经把流量，网费，时间都按顺序储存好了。怎么和前端数据可视化互动呢？最好的方式当然是选择js，用网页的形式呈现。不过，为了保证实时性，js需要不间断地向后台发起请求。整个流程应该是由js端驱动的。而我对python作网站后台并不熟悉，无奈之下，只能暂时放弃python爬虫这个主意，选择php爬虫。不过，思路上大同小异，没过多久，php的爬虫后台端就搞定了。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;Content-type: text/json&quot;</span>);</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Spider</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$flow</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$fee</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$time</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;flow = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;fee = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;time = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        get content from a certain URL</span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">@param</span> $url string</span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getURLcontent</span>(<span class=\"params\"><span class=\"variable\">$url</span></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化</span></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$curl</span> = <span class=\"title function_ invoke__\">curl_init</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 设置cURL 参数</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">curl_setopt</span>(<span class=\"variable\">$curl</span>, CURLOPT_URL, <span class=\"variable\">$url</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">curl_setopt</span>(<span class=\"variable\">$curl</span>, CURLOPT_HEADER, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">curl_setopt</span>(<span class=\"variable\">$curl</span>, CURLOPT_RETURNTRANSFER, <span class=\"number\">1</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"comment\">// 运行cURL，请求网页</span></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"title function_ invoke__\">curl_exec</span>(<span class=\"variable\">$curl</span>);</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;time = <span class=\"title function_ invoke__\">time</span>() * <span class=\"number\">1000</span>+<span class=\"number\">3600</span>*<span class=\"number\">8000</span>; <span class=\"comment\">//to fit UTC time</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">curl_close</span>(<span class=\"variable\">$curl</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"comment\">// 显示获得的数据</span></span><br><span class=\"line\">        <span class=\"comment\">//var_dump($data);</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$data</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        get flow and fee from certain message</span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">@param</span> $content string</span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">simplifyURLcontent</span>(<span class=\"params\"><span class=\"variable\">$content</span></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$flow</span> = <span class=\"number\">0</span>; <span class=\"variable\">$fee</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/flow=\\&#x27;([\\S\\s]*)\\&#x27;;fsele=\\d+;fee=([\\S\\s]*)\\&#x27;;xsele/&#x27;</span>, <span class=\"variable\">$content</span>, <span class=\"variable\">$matches</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"variable\">$matches</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//查找流量和费用字符串</span></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;flow = <span class=\"title function_ invoke__\">intval</span>(<span class=\"variable\">$matches</span>[<span class=\"number\">1</span>])/<span class=\"number\">1024</span>/<span class=\"number\">1024</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;fee  = <span class=\"title function_ invoke__\">intval</span>(<span class=\"variable\">$matches</span>[<span class=\"number\">2</span>]);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        return json to js</span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deliverFlow</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$ret</span> = <span class=\"keyword\">array</span>(<span class=\"variable language_\">$this</span>-&gt;time, <span class=\"variable language_\">$this</span>-&gt;fee, <span class=\"variable language_\">$this</span>-&gt;flow);</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">json_encode</span>(<span class=\"variable\">$ret</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        continous work flow</span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">@return</span> false</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">workFlow</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$ret</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">getURLcontent</span>(<span class=\"string\">&quot;http://10.3.8.211&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$isGet</span> = <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">simplifyURLcontent</span>(<span class=\"variable\">$ret</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$isGet</span>) <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">deliverFlow</span>();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$gate</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Spider</span>();</span><br><span class=\"line\">    <span class=\"variable\">$gate</span>-&gt;<span class=\"title function_ invoke__\">workFlow</span>();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这样，js每次发送.ajax请求时，php就可以返回前端需要的数据了。</p>\n<p>这么来看，后台爬虫端应该就这么多了。</p>\n<h2 id=\"数据可视化\"><a href=\"#数据可视化\" class=\"headerlink\" title=\"数据可视化\"></a>数据可视化</h2><p>好的，现在我们已经可以拿到所需的数据了。关键是怎么去呈现它。最好能有现成的工具来好好利用收集到的数据。前人怎么会没考虑到这点呢，js charts用SVG等方法渲染出来的图表足够用了。这里，我选择了Highcharts。Highcharts的文档很丰富，API文档也很充分，所以有一定web基础的人很容易上手。</p>\n<p>Highcharts提供了很多种图表类型，考虑到实时性的需要，我们选择最基础的line类型。这里不再介绍Highcharts的基本信息，感兴趣的可以去它的<a href=\"http://www.highcharts.com/\">官网</a>查看。既然后台php已经把json标准化的数据拿过来了，就看Highcharts这边怎么用了。</p>\n<p>由于这里各点数据是动态更新的。这里Highcharts的Chart对象里，series需要动态更新。这里写个简单的ajax,向后台index.php请求数据，根据上面的php程序，将得到一个[time,fee,flow]的json类型数据point，第一个自然是x轴数据，第二个是第二条y轴数据，第三个是第一条y轴数据。这里我们用series的addPoint方法把数据新增进去即可。由于图只显示近半小时数据，我们姑且视作50个点，因此这里还要判断点数是否超过50，然，则平移。因此addPoint的第二个第三个参数分别是TRUE和判断是否平移的Boolean值。在得到数据后，setTimeout来实现每约30s请求一次数据。代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.<span class=\"title function_\">ajax</span>(&#123;</span><br><span class=\"line\">\t<span class=\"attr\">url</span>: <span class=\"string\">&#x27;index.php&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">success</span>: <span class=\"keyword\">function</span>(<span class=\"params\">point</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> series = chart.<span class=\"property\">series</span>[<span class=\"number\">0</span>],</span><br><span class=\"line\">\t\tseries_f = chart.<span class=\"property\">series</span>[<span class=\"number\">1</span>],</span><br><span class=\"line\">\t\tshift = series.<span class=\"property\">data</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">50</span>,</span><br><span class=\"line\">\t\tshift_f = series_f.<span class=\"property\">data</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">50</span>; <span class=\"comment\">// shift if the series is longer than 50</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// add the point</span></span><br><span class=\"line\">\t\tchart.<span class=\"property\">series</span>[<span class=\"number\">0</span>].<span class=\"title function_\">addPoint</span>([point[<span class=\"number\">0</span>],point[<span class=\"number\">2</span>]], <span class=\"literal\">true</span>, shift);</span><br><span class=\"line\">\t\tchart.<span class=\"property\">series</span>[<span class=\"number\">1</span>].<span class=\"title function_\">addPoint</span>([point[<span class=\"number\">0</span>],point[<span class=\"number\">1</span>]], <span class=\"literal\">true</span>, shift_f);</span><br><span class=\"line\">\t\t<span class=\"comment\">// call it again after one second</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">setTimeout</span>(requestData, <span class=\"number\">20000</span>);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">cache</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>之后的就比较简单了。设置好前端表格的格式就可以看到炫酷的效果了。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"variable language_\">document</span>).<span class=\"title function_\">ready</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\tchart = <span class=\"keyword\">new</span> <span class=\"title class_\">Highcharts</span>.<span class=\"title class_\">Chart</span>(&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">chart</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">renderTo</span>: <span class=\"string\">&#x27;container&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">defaultSeriesType</span>: <span class=\"string\">&#x27;spline&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">events</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">load</span>: requestData</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">text</span>: <span class=\"string\">&#x27;Campus Network Live Flow Data(ipv4 only)&#x27;</span></span><br><span class=\"line\">\t\t&#125;,\t\t</span><br><span class=\"line\">\t\t<span class=\"attr\">credits</span>:&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">enabled</span>:<span class=\"literal\">false</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">xAxis</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">type</span>: <span class=\"string\">&#x27;datetime&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">tickPixelInterval</span>: <span class=\"number\">40</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">maxZoom</span>: <span class=\"number\">50</span> * <span class=\"number\">1000</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">yAxis</span>: [&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">minPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">maxPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">                \t<span class=\"attr\">text</span>: <span class=\"string\">&#x27;Flow (GB)&#x27;</span>,</span><br><span class=\"line\">                \t<span class=\"attr\">margin</span>: <span class=\"number\">30</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;,&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">opposite</span>:<span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">minPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">maxPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">\t                <span class=\"attr\">text</span>: <span class=\"string\">&#x27;Balance(yuan)&#x27;</span>,</span><br><span class=\"line\">        \t        <span class=\"attr\">margin</span>: <span class=\"number\">30</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;],</span><br><span class=\"line\">\t\t<span class=\"attr\">series</span>: [&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">name</span>: <span class=\"string\">&#x27;FLow data&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">data</span>: []</span><br><span class=\"line\">\t\t&#125;,&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">yAxis</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">name</span>: <span class=\"string\">&#x27;Balance data&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"string\">`\t\tdata: []</span></span><br><span class=\"line\"><span class=\"string\">\t\t&#125;]</span></span><br><span class=\"line\"><span class=\"string\">\t&#125;);        </span></span><br><span class=\"line\"><span class=\"string\">&#125;);</span></span><br></pre></td></tr></table></figure>\n\n<p>嗯~ 看上去还不错。</p>\n<p>p.s. 经测试，在后台取的时间不经处理会早8个小时，这是由于UTC和时区的原因，在后台额外加上整8个小时即可。</p>\n<h2 id=\"历史数据\"><a href=\"#历史数据\" class=\"headerlink\" title=\"历史数据\"></a>历史数据</h2><p>在实时数据做完后，有朋友参与了进来。经过讨论，我们认为做一个历史性数据展示窗口也是必要的。毕竟，不是所有人都愿意开着网页等着数据更新。后台悄悄地采集数据会更友好。于是，下一步开始了。</p>\n<p>有了前面的基础后，后面的开发要快许多。不过我们遇到了一个现实的问题。既然我们的小工具是面向不一定懂编程的用户的，那么php做后台就变得有些不现实。所以这里我们决定用windows的shell来写，并推广到不同操作系统。由于篇幅限制，我们将在下篇日志里介绍这种方法。这里仅对前段部分进行讲解。</p>\n<p>思路还是类似的，后台采到的数据用csv格式存在.dat或诸如此类的文件里。Highcharts需要读入其中所有的数据，并存入到series的data域里，一次请求，一次性完成，这是不同于上个功能的。</p>\n<p>依旧，在Highcharts的chart对象实体化前，得对变量赋值。重点当然在对csv格式的文件读取中。这里用jQuery的get方法，虽然js跨域访问陌生网站很困难，访问本地资源还是没问题的。读入数据后，以’\\n’为分隔得到每个点，这里要初始化一个series对象，预存两条数据线的name，yAxis属性。然后.each函数里，split数据by ‘ , ‘, push到series的data域里即可（注意，这里最好对值parseFLoat处理一下较好）。最后将两组series push到chart的options里（注意，需要push两次，因为是两组数据）。代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;data.csv&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Split the lines</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> lines = data.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\">    \t<span class=\"keyword\">var</span> series = [&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">name</span>: <span class=\"string\">&#x27;Flow Data&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">data</span>: []</span><br><span class=\"line\">\t\t&#125;,&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">name</span>: <span class=\"string\">&#x27;Balance Data&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">yAxis</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">data</span>: []</span><br><span class=\"line\">\t&#125;];</span><br><span class=\"line\">\t<span class=\"comment\">// Iterate over the lines and add categories or series</span></span><br><span class=\"line\">\t$.<span class=\"title function_\">each</span>(lines, <span class=\"keyword\">function</span>(<span class=\"params\">lineNo,line</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> items = line.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">\t\tseries[<span class=\"number\">0</span>].<span class=\"property\">data</span>.<span class=\"title function_\">push</span>([<span class=\"built_in\">parseFloat</span>(items[<span class=\"number\">0</span>]),<span class=\"built_in\">parseFloat</span>(items[<span class=\"number\">2</span>])]);</span><br><span class=\"line\">\t\tseries[<span class=\"number\">1</span>].<span class=\"property\">data</span>.<span class=\"title function_\">push</span>([<span class=\"built_in\">parseFloat</span>(items[<span class=\"number\">0</span>]),<span class=\"built_in\">parseFloat</span>(items[<span class=\"number\">1</span>])]);</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\toptions.<span class=\"property\">series</span>.<span class=\"title function_\">push</span>(series[<span class=\"number\">0</span>]);</span><br><span class=\"line\">\toptions.<span class=\"property\">series</span>.<span class=\"title function_\">push</span>(series[<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t<span class=\"comment\">// Create the chart</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> chart = <span class=\"keyword\">new</span> <span class=\"title class_\">Highcharts</span>.<span class=\"title class_\">Chart</span>(options); </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>配合上预先设定好的Highcharts其他属性，综合成一个options初始化一个Highcharts.chart对象即可完成任务。再稍微处理一下前端，将两个功能组合在一起，加上css样式和一个简单的收起js，得到了半成品.</p>\n<p>整体代码js如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">requestData</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t$.<span class=\"title function_\">ajax</span>(&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">url</span>: <span class=\"string\">&#x27;index.php&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">success</span>: <span class=\"keyword\">function</span>(<span class=\"params\">point</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> series = chart.<span class=\"property\">series</span>[<span class=\"number\">0</span>],</span><br><span class=\"line\">\t\t\tseries_f = chart.<span class=\"property\">series</span>[<span class=\"number\">1</span>],</span><br><span class=\"line\">\t\t\tshift = series.<span class=\"property\">data</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">50</span>,</span><br><span class=\"line\">\t\t\tshift_f = series_f.<span class=\"property\">data</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">50</span>; <span class=\"comment\">// shift if the series is longer than 50</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// add the point</span></span><br><span class=\"line\">\t\t\tchart.<span class=\"property\">series</span>[<span class=\"number\">0</span>].<span class=\"title function_\">addPoint</span>([point[<span class=\"number\">0</span>],point[<span class=\"number\">2</span>]], <span class=\"literal\">true</span>, shift);</span><br><span class=\"line\">\t\t\tchart.<span class=\"property\">series</span>[<span class=\"number\">1</span>].<span class=\"title function_\">addPoint</span>([point[<span class=\"number\">0</span>],point[<span class=\"number\">1</span>]], <span class=\"literal\">true</span>, shift_f);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// call it again after one second</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">setTimeout</span>(requestData, <span class=\"number\">20000</span>);</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">cache</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> options = &#123;</span><br><span class=\"line\">\t<span class=\"attr\">chart</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">renderTo</span>: <span class=\"string\">&#x27;container_h&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">defaultSeriesType</span>: <span class=\"string\">&#x27;spline&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">zoomType</span>: <span class=\"string\">&#x27;x&#x27;</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">text</span>: <span class=\"string\">&#x27;Campus Network History Flow Data(ipv4 only)&#x27;</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">credits</span>:&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">enabled</span>:<span class=\"literal\">false</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">xAxis</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">type</span>:<span class=\"string\">&#x27;datetime&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">minRange</span>: <span class=\"number\">150000</span> <span class=\"comment\">// 150 seconds</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">yAxis</span>: [&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">minPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">maxPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">text</span>: <span class=\"string\">&#x27;Flow (GB)&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">margin</span>: <span class=\"number\">30</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">opposite</span>:<span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">minPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">maxPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">text</span>: <span class=\"string\">&#x27;Balance (yuan)&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">margin</span>: <span class=\"number\">30</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;],</span><br><span class=\"line\">\t<span class=\"attr\">series</span>: []</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">$.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;data.csv&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Split the lines</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> lines = data.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\">   \t<span class=\"keyword\">var</span> series = [&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">name</span>: <span class=\"string\">&#x27;Flow Data&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">data</span>: []</span><br><span class=\"line\">\t&#125;,&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">name</span>: <span class=\"string\">&#x27;Balance Data&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">yAxis</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">data</span>: []</span><br><span class=\"line\">\t&#125;];</span><br><span class=\"line\">\t<span class=\"comment\">// Iterate over the lines and add categories or series</span></span><br><span class=\"line\">\t$.<span class=\"title function_\">each</span>(lines, <span class=\"keyword\">function</span>(<span class=\"params\">lineNo,line</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> items = line.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">\t\tseries[<span class=\"number\">0</span>].<span class=\"property\">data</span>.<span class=\"title function_\">push</span>([<span class=\"built_in\">parseFloat</span>(items[<span class=\"number\">0</span>]),<span class=\"built_in\">parseFloat</span>(items[<span class=\"number\">2</span>])]);</span><br><span class=\"line\">\t\tseries[<span class=\"number\">1</span>].<span class=\"property\">data</span>.<span class=\"title function_\">push</span>([<span class=\"built_in\">parseFloat</span>(items[<span class=\"number\">0</span>]),<span class=\"built_in\">parseFloat</span>(items[<span class=\"number\">1</span>])]);</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\"> \toptions.<span class=\"property\">series</span>.<span class=\"title function_\">push</span>(series[<span class=\"number\">0</span>]);</span><br><span class=\"line\">\toptions.<span class=\"property\">series</span>.<span class=\"title function_\">push</span>(series[<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t<span class=\"comment\">// Create the chart</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> chart = <span class=\"keyword\">new</span> <span class=\"title class_\">Highcharts</span>.<span class=\"title class_\">Chart</span>(options);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">$(<span class=\"variable language_\">document</span>).<span class=\"title function_\">ready</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\tchart = <span class=\"keyword\">new</span> <span class=\"title class_\">Highcharts</span>.<span class=\"title class_\">Chart</span>(&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">chart</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">renderTo</span>: <span class=\"string\">&#x27;container&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">defaultSeriesType</span>: <span class=\"string\">&#x27;spline&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">events</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">load</span>: requestData</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">text</span>: <span class=\"string\">&#x27;Campus Network Live Flow Data(ipv4 only)&#x27;</span></span><br><span class=\"line\">\t\t&#125;,\t\t</span><br><span class=\"line\">\t\t<span class=\"attr\">credits</span>:&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">enabled</span>:<span class=\"literal\">false</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">xAxis</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">type</span>: <span class=\"string\">&#x27;datetime&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">tickPixelInterval</span>: <span class=\"number\">40</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">maxZoom</span>: <span class=\"number\">50</span> * <span class=\"number\">1000</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">yAxis</span>: [&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">minPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">maxPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">               \t\t<span class=\"attr\">text</span>: <span class=\"string\">&#x27;Flow (GB)&#x27;</span>,</span><br><span class=\"line\">                \t<span class=\"attr\">margin</span>: <span class=\"number\">30</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;,&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">opposite</span>:<span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">minPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">maxPadding</span>: <span class=\"number\">0.2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">title</span>: &#123;</span><br><span class=\"line\">                \t<span class=\"attr\">text</span>: <span class=\"string\">&#x27;Balance(yuan)&#x27;</span>,</span><br><span class=\"line\">                \t<span class=\"attr\">margin</span>: <span class=\"number\">30</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;],</span><br><span class=\"line\">\t\t<span class=\"attr\">series</span>: [&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">name</span>: <span class=\"string\">&#x27;FLow data&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">data</span>: []</span><br><span class=\"line\">\t\t&#125;,&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">yAxis</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">name</span>: <span class=\"string\">&#x27;Balance data&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">data</span>: []</span><br><span class=\"line\">\t\t&#125;]</span><br><span class=\"line\">\t&#125;);        </span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>剩下的部分，我们在下篇文章里继续。下期见 ~</p>\n",
            "tags": [
                "数据可视化",
                "爬虫"
            ]
        }
    ]
}