{
    "version": "https://jsonfeed.org/version/1",
    "title": "Shenlvmeng's Blog â€¢ All posts by \"hooks\" tag",
    "description": "Be sharp, my friend.",
    "home_page_url": "http://shenlvmeng.github.com/blog",
    "items": [
        {
            "id": "http://shenlvmeng.github.com/blog/2018/10/31/react-hooks-intro/",
            "url": "http://shenlvmeng.github.com/blog/2018/10/31/react-hooks-intro/",
            "title": "React Hooksç®€è¦ä»‹ç»",
            "date_published": "2018-10-31T15:32:17.000Z",
            "content_html": "<p><a href=\"https://reactjs.org/docs/hooks-intro.html\">Hooks</a>æ˜¯<a href=\"https://www.npmjs.com/package/react?activeTab=versions\">React v16.7.0-alpha</a>ä¸­å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œç›®å‰ï¼ˆ2018å¹´10æœˆåº•ï¼‰è¿˜åœ¨<a href=\"https://github.com/reactjs/rfcs/pull/68\">è®¨è®ºä¹‹ä¸­</a>ã€‚</p>\n<p>å…³äºè¿™æ¬¡æ”¹åŠ¨ï¼Œå®˜ç½‘é‡Œç‰¹åœ°è¡¨æ˜<a href=\"https://reactjs.org/docs/hooks-intro.html#no-breaking-changes\"><strong>è¿™ä¸æ˜¯Breaking Changes</strong></a>ï¼Œå¹¶ä¸”å‘å‰å…¼å®¹ï¼Œå¤§å®¶å¯ä»¥æ”¾å¿ƒåœ°ä½¿ç”¨ã€‚åœ¨åŠ¨æœºä¸Šï¼š</p>\n<ul>\n<li>ä½¿ç”¨Hookså°†ä¾¿äºå¼€å‘è€…æ‹†åˆ†å’Œå¤ç”¨state<strong>ç®¡ç†çš„é€»è¾‘</strong>ï¼ˆè€Œä¸æ˜¯stateæœ¬èº«ï¼‰</li>\n<li>ä½¿ç”¨Hookså°†æŠŠClassç»„ä»¶ä¸­çš„Reactç”Ÿå‘½å‘¨æœŸæ–¹æ³•æŠ½è±¡æˆeffectsï¼Œæ ¹æ®éœ€è¦æ’å…¥</li>\n<li>é™¤äº†stateå’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ŒReactè¿˜å°†classæä¾›çš„æ›´å¤šfeaturesæ‹†åˆ†å‡ºæ¥ä½œä¸ºé¢å¤–åŠŸèƒ½ï¼ŒæŒ‰éœ€ä½¿ç”¨</li>\n</ul>\n<p>ä¸‹é¢å°†ä»ä¸Šé¢å‡ ç‚¹åˆ†åˆ«å±•å¼€ä»‹ç»ï¼Œå¹¶ç»™å‡ºä¸€äº›ä½¿ç”¨é¡»çŸ¥ã€‚</p>\n<h2 id=\"State-Hook\"><a href=\"#State-Hook\" class=\"headerlink\" title=\"State Hook\"></a>State Hook</h2><p>æ ¹æ®ä¸Šé¢æ‰€è¿°ï¼Œç”¨æ¥æ‹†åˆ†å’Œå¤ç”¨stateç®¡ç†é€»è¾‘ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œclassç»„ä»¶ä¸­çš„stateæ›´æ–°é€»è¾‘æ¯”è¾ƒç®€å•ã€‚å’Œ<a href=\"https://reactjs.org/docs/hooks-state.html\">å®˜ç½‘ç»™çš„ä¾‹å­</a>æœ¬è´¨ä¸Šæ²¡ä»€ä¹ˆå·®åˆ«ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Example</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Declare a new state variable, which we&#x27;ll call &quot;count&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = <span class=\"title function_\">useState</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>You clicked &#123;count&#125; times<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        Click me</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>useState</code>æ˜¯State Hookæä¾›çš„APIæ–¹æ³•ï¼Œå®ƒåªéœ€<strong>1ä¸ªå…¥å‚</strong>ï¼Œè¡¨ç¤ºçŠ¶æ€çš„åˆå§‹å€¼ã€‚è¿”å›ä¸€ä¸ªpairï¼š</p>\n<ul>\n<li>ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ŒçŠ¶æ€æœ¬èº«ï¼Œç±»ä¼¼<code>this.state.xxx</code></li>\n<li>ç¬¬äºŒä¸ªå…ƒç´ ï¼Œè®¾ç½®çŠ¶æ€æ–¹æ³•ï¼Œç±»ä¼¼<code>this.setState(&#123; xxx: &#39;foo&#39; &#125;)</code></li>\n</ul>\n<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬äºŒä¸ªå…ƒç´ ï¼Œè®¾ç½®çŠ¶æ€çš„æ–¹æ³•ä¸æ˜¯å¢é‡æ›´æ–°ï¼Œè€Œæ˜¯ç›´æ¥æ›¿æ¢</strong>ï¼Œè¿™ç‚¹å’Œ<code>setState</code>æœ‰åŒºåˆ«ã€‚</p>\n<p>åœ¨ä¸‹é¢çš„æ¸²æŸ“éƒ¨åˆ†ï¼Œç›´æ¥ä½¿ç”¨çŠ¶æ€åå³å¯ã€‚å½“ç„¶è¿™é‡Œåªå£°æ˜äº†ä¸€ä¸ªéœ€è¦çš„çŠ¶æ€å˜é‡ï¼Œéœ€è¦æ–°çš„çŠ¶æ€å˜é‡ï¼ˆæ¯”å¦‚ï¼š<code>[fruit, setFruit]</code>ï¼‰æ—¶ï¼Œéœ€è¦ç”¨åŒæ ·çš„æ–¹æ³•è·å¾—è¿”å›ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Declare multiple state variables!</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> [age, setAge] = <span class=\"title function_\">useState</span>(<span class=\"number\">42</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> [fruit, setFruit] = <span class=\"title function_\">useState</span>(<span class=\"string\">&#x27;banana&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> [todos, setTodos] = <span class=\"title function_\">useState</span>([&#123; <span class=\"attr\">text</span>: <span class=\"string\">&#x27;Learn Hooks&#x27;</span> &#125;]);</span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨State Hookæ—¶ï¼Œå¦‚ä½•<strong>æ‹†åˆ†state</strong>åˆ°å„useStateä¸­æ˜¯éœ€è¦è€ƒè™‘çš„äº‹æƒ…ã€‚</p>\n<h2 id=\"Effect-Hook\"><a href=\"#Effect-Hook\" class=\"headerlink\" title=\"Effect Hook\"></a>Effect Hook</h2><p>Effect Hookç”¨æ¥å¤„ç†<strong>Reactæ¯æ¬¡æ¸²æŸ“å®Œæˆåçš„å‰¯ä½œç”¨</strong>ã€‚å®ƒç­‰åŒäº<code>componentDidMount</code>, <code>componentDidUpdate</code>, å†åŠ ä¸Š<code>componentWillUnmount</code>ã€‚å‰¯ä½œç”¨åˆ†ä¸¤ç§ï¼Œéœ€è¦cleanupå’Œä¸éœ€è¦cleanupçš„ã€‚</p>\n<p><strong>ä¸éœ€è¦Cleanup</strong></p>\n<p>é€šå¸¸çš„å‰¯ä½œç”¨åŒ…æ‹¬æ•°æ®è¯·æ±‚ã€DOMä¿®æ”¹ç­‰ç­‰ã€‚è¿™äº›æ“ä½œä¸éœ€è¦æ¸…ç†å ç”¨çš„èµ„æºã€‚ä½¿ç”¨æ—¶ç±»ä¼¼ä¸‹é¢è¿™æ ·ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useState, useEffect &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Example</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = <span class=\"title function_\">useState</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"property\">title</span> = <span class=\"string\">`You clicked <span class=\"subst\">$&#123;count&#125;</span> times`</span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>You clicked &#123;count&#125; times<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        Click me</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä½¿ç”¨<code>useEffect</code>æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå”¯ä¸€å…¥å‚ã€‚è¿™æ ·ï¼Œåœ¨<strong>æ¯æ¬¡renderå®Œæˆåï¼ˆåŒ…å«ç¬¬ä¸€æ¬¡renderï¼‰</strong>ï¼Œéƒ½ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå»å®Œæˆå‰¯ä½œç”¨çš„éƒ¨åˆ†ã€‚</p>\n<p>ä½ å¯èƒ½æœ‰äº›ç–‘æƒ‘ï¼Œå¦‚æœæˆ‘æœ‰æŸä¸ªå‰¯ä½œç”¨ï¼Œåªåœ¨componentDidMountä½¿ç”¨ä¸€æ¬¡ï¼Œæ¯”å¦‚è·å–DOM refè¿™ç§å‘¢ï¼Ÿå¦å¤–ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“åï¼Œå¦‚æœå‰¯ä½œç”¨ä¾èµ–äºå½“å‰çš„çŠ¶æ€å€¼ï¼Œéš¾é“è¿˜éœ€è¦å†™ifè¯­å¥åˆ¤æ–­çŠ¶æ€æœ‰æ²¡æœ‰å˜åŒ–å—ï¼Ÿæ¥ç€ï¼Œå¾€ä¸‹çœ‹ã€‚</p>\n<p><code>userEffect</code>è¿™ä¸ªæ–¹æ³•å¯ä»¥æœ‰ç¬¬äºŒä¸ªå…¥å‚ï¼Œè¿™ä¸ªå…¥å‚æ˜¯æ•°ç»„ç±»å‹ï¼Œè¡¨ç¤ºè¿™ä¸ªeffectsæ‰€ä¾èµ–çš„å†…éƒ¨çŠ¶æ€ã€‚ï¼ˆ<strong>æ³¨æ„ï¼šè¿™ä¸ªçŠ¶æ€å¿…é¡»æ˜¯ä¸Šé¢ç”¨<code>useState</code>å£°æ˜çš„</strong>ï¼‰åªæœ‰æ•°ç»„å†…çš„çŠ¶æ€å˜åŒ–æ—¶ï¼ŒReactæ‰ä¼šå»æ‰§è¡Œç¬¬ä¸€ä¸ªå…¥å‚çš„å‡½æ•°ã€‚</p>\n<p>å¦å¤–ï¼Œæ•°ç»„ä¸ºç©ºæ—¶ï¼Œè¡¨ç¤ºå‡½æ•°æ²¡æœ‰ä¾èµ–ï¼Œå³åªåœ¨componentDidMountæ—¶æ‰§è¡Œä¸€æ¬¡å³å¯ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">title</span> = <span class=\"string\">`You clicked <span class=\"subst\">$&#123;count&#125;</span> times`</span>;</span><br><span class=\"line\">&#125;, [count]); <span class=\"comment\">// Only re-run the effect if count changes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;This component has been rendered.&#x27;</span>);</span><br><span class=\"line\">&#125;, []); <span class=\"comment\">// Only re-run at the first rendering</span></span><br></pre></td></tr></table></figure>\n\n<p>æœ€åï¼Œ<code>useEffect</code>æ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œå³ä¸ä¼šblockæµè§ˆå™¨æ›´æ–°å±å¹•å†…å®¹ï¼Œä»¥èŠ‚çœèµ„æºã€‚åœ¨ä¸€äº›ä¸å¸¸è§çš„åœºæ™¯ï¼Œå¦‚éœ€è¦æµ‹é‡å½“å‰å¸ƒå±€æ—¶ï¼Œéœ€è¦ç”¨åŒæ­¥çš„<code>useLayoutEffect</code>ã€‚</p>\n<p><strong>éœ€è¦Cleanup</strong></p>\n<p>æœ‰çš„å‰¯ä½œç”¨ä»¥æ·»åŠ äº‹ä»¶ç›‘å¬ã€è®¾ç½®å®šæ—¶å™¨ç­‰ç­‰çš„subscriptionçš„å½¢å¼è¿›è¡Œï¼Œè¿™äº›åœ¨ç»„ä»¶é”€æ¯åéœ€è¦é‡Šæ”¾æ‰å ç”¨çš„èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚ç±»ä¼¼ä½ ä¹‹å‰åœ¨<code>componentWillUnmount</code>é‡Œå†™çš„é€»è¾‘ã€‚</p>\n<p>Reactç”¨<code>useEffect</code>è¡¨ç¤ºè¿™ä¸ªå‰¯ä½œç”¨çš„æ¸…é™¤æ“ä½œã€‚ç”¨æ³•ç±»ä¼¼<code>setTimeout</code>ï¼Œç”¨è¿”å›å€¼ä½œä¸ºhandlerã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">subscribeToFriendStatus</span>(props.<span class=\"property\">friend</span>.<span class=\"property\">id</span>, handleStatusChange);</span><br><span class=\"line\">  <span class=\"comment\">// Specify how to clean up after this effect:</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> <span class=\"title function_\">cleanup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">unsubscribeFromFriendStatus</span>(props.<span class=\"property\">friend</span>.<span class=\"property\">id</span>, handleStatusChange);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨å®é™…è¿è¡Œæ—¶ï¼Œä¸€ä¸ªEffectåœ¨ç»„ä»¶re-renderæ—¶éƒ½ä¼šè¢«é‡æ–°é”€æ¯å†é‡å»ºï¼Œä»¥ä¾¿äºåœ¨componentDidUpdateæ—¶ï¼Œä¹Ÿèƒ½è·Ÿè¸ªåˆ°å‰¯ä½œç”¨å†…ä½¿ç”¨çš„çŠ¶æ€çš„æœ€æ–°å€¼ã€‚ä¸Šé¢é‚£æ®µä»£ç å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢è¿™æ ·çš„å®é™…è¿è¡Œæƒ…å†µï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Mount with &#123; friend: &#123; id: 100 &#125; &#125; props</span></span><br><span class=\"line\"><span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">subscribeToFriendStatus</span>(<span class=\"number\">100</span>, handleStatusChange);     <span class=\"comment\">// Run first effect</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Update with &#123; friend: &#123; id: 200 &#125; &#125; props</span></span><br><span class=\"line\"><span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">unsubscribeFromFriendStatus</span>(<span class=\"number\">100</span>, handleStatusChange); <span class=\"comment\">// Clean up previous effect</span></span><br><span class=\"line\"><span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">subscribeToFriendStatus</span>(<span class=\"number\">200</span>, handleStatusChange);     <span class=\"comment\">// Run next effect</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Update with &#123; friend: &#123; id: 300 &#125; &#125; props</span></span><br><span class=\"line\"><span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">unsubscribeFromFriendStatus</span>(<span class=\"number\">200</span>, handleStatusChange); <span class=\"comment\">// Clean up previous effect</span></span><br><span class=\"line\"><span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">subscribeToFriendStatus</span>(<span class=\"number\">300</span>, handleStatusChange);     <span class=\"comment\">// Run next effect</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Unmount</span></span><br><span class=\"line\"><span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">unsubscribeFromFriendStatus</span>(<span class=\"number\">300</span>, handleStatusChange); <span class=\"comment\">// Clean up last effect</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸ºäº†é¿å…è¿™æ ·çš„é¢‘ç¹æ“ä½œå½±å“æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡ä¸Šé¢ä»‹ç»çš„ä¼ ç¬¬äºŒä¸ªå‚æ•°çš„æ–¹å¼ä¼˜åŒ–æ€§èƒ½ã€‚<a href=\"https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects\">å®˜æ–¹æ–‡æ¡£</a>åœ¨æœ€åè¿˜è¡¥å……äº†ä¸€å¥ï¼š</p>\n<blockquote>\n<p>In the future, the second argument might get added automatically by a build-time transformation.</p>\n</blockquote>\n<h2 id=\"ä¸€äº›ä½¿ç”¨å‡†åˆ™\"><a href=\"#ä¸€äº›ä½¿ç”¨å‡†åˆ™\" class=\"headerlink\" title=\"ä¸€äº›ä½¿ç”¨å‡†åˆ™\"></a>ä¸€äº›ä½¿ç”¨å‡†åˆ™</h2><ul>\n<li>åœ¨å‡½æ•°å†…éƒ¨çš„æœ€å¤–å±‚ä½¿ç”¨ï¼Œ<strong>åˆ«åœ¨å—è¯­å¥å†…ä½¿ç”¨</strong>ï¼Œä»¥ä¿è¯æ­£ç¡®çš„å†…éƒ¨çŠ¶æ€</li>\n<li><strong>åªåœ¨å‡½æ•°ç»„ä»¶å’Œè‡ªå®šä¹‰Hooksä¸­ä½¿ç”¨Hooks API</strong>ï¼Œä»¥ä¿è¯å¯è¯»æ€§</li>\n<li><a href=\"https://www.npmjs.com/package/eslint-plugin-react-hooks\">è¿™ä¸ªeslint-plugin</a>èƒ½å¸®åŠ©ä½ æ£€æŸ¥ä»£ç é£æ ¼</li>\n</ul>\n<p>ä¸ºä»€ä¹ˆä¼šæœ‰çœ‹èµ·æ¥æ¯”è¾ƒåˆ«æ‰­çš„ä¸Šé¢ä¸¤æ¡è§„åˆ™å‘¢ï¼Ÿ</p>\n<p>ä»<code>useState</code>å’Œ<code>useEffect</code>çœ‹åˆ°ï¼ŒAPIæœ¬èº«æ˜¯æ²¡æœ‰çŠ¶æ€çš„ï¼Œå¹¶ä¸çŸ¥é“APIçš„è¿”å›èµ‹å€¼ç»™äº†å“ªä¸ªå˜é‡åã€‚æ‰€ä»¥ï¼Œå°±åƒä»‹ç»é‡Œè¯´çš„ï¼š</p>\n<blockquote>\n<p>React relies on the order in which Hooks are called.</p>\n</blockquote>\n<p>Reactä¾èµ–äºHooksçš„è°ƒç”¨é¡ºåºï¼Œå› æ­¤åœ¨æ¯æ¬¡renderæ—¶ï¼ŒHooksæ–¹æ³•çš„è°ƒç”¨é¡ºåº<strong>ä¸€å®šè¦ä¿æŒä¸€è‡´</strong>ã€‚</p>\n<p><em>ï¼ˆçŒœæµ‹å†…éƒ¨ç”¨ç±»ä¼¼æ•°ç»„çš„ç»“æ„ä¿å­˜äº†ä¸€ä¸ªå‡½æ•°ç»„ä»¶å†…çš„å¤šä¸ªHooksï¼‰</em></p>\n<p>ä»è€Œï¼Œæ‰€æœ‰å¯¼è‡´Hookså¯èƒ½ä¸æŒ‰ä¸€è‡´é¡ºåºæ‰§è¡Œçš„å†™æ³•éƒ½ä¸å»ºè®®ä½¿ç”¨ã€‚ä¸ºäº†ä¿è¯Hooksæ‰§è¡Œé¡ºåºæ‰€è§å³æ‰€å¾—ï¼Œåˆæœ‰äº†ç¬¬äºŒæ¡å‡†åˆ™ã€‚</p>\n<h2 id=\"ç»„åˆ-è‡ªå®šä¹‰Hooks\"><a href=\"#ç»„åˆ-è‡ªå®šä¹‰Hooks\" class=\"headerlink\" title=\"ç»„åˆ - è‡ªå®šä¹‰Hooks\"></a>ç»„åˆ - è‡ªå®šä¹‰Hooks</h2><p>Hooksé™¤äº†æˆ–å¤šæˆ–å°‘åŸºäºReactæä¾›çš„Hookså¤–ï¼Œåªæ˜¯å†æ™®é€šä¸è¿‡çš„JavaScript functionè€Œå·²ã€‚å¯ä»¥å°†ç»„ä»¶ä¸­å…±ç”¨çš„<strong>çŠ¶æ€é€»è¾‘</strong>æ‹†åˆ†å‡ºæ¥ä½œä¸ºè‡ªå®šä¹‰Hooksã€‚ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useState, useEffect &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">useFriendStatus</span>(<span class=\"params\">friendID</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [isOnline, setIsOnline] = <span class=\"title function_\">useState</span>(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handleStatusChange</span>(<span class=\"params\">status</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setIsOnline</span>(status.<span class=\"property\">isOnline</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">subscribeToFriendStatus</span>(friendID, handleStatusChange);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"title class_\">ChatAPI</span>.<span class=\"title function_\">unsubscribeFromFriendStatus</span>(friendID, handleStatusChange);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> isOnline;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>å¼ºçƒˆå»ºè®®ç”¨æˆ·è‡ªå®šä¹‰çš„Hookså‡½æ•°ä¹Ÿä»¥<code>use</code>å¼€å¤´</strong>ã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œå°±åƒä½¿ç”¨æ­£å¸¸çš„å‡½æ•°å³å¯ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">FriendStatus</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> isOnline = <span class=\"title function_\">useFriendStatus</span>(props.<span class=\"property\">friend</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isOnline === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Loading...&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> isOnline ? <span class=\"string\">&#x27;Online&#x27;</span> : <span class=\"string\">&#x27;Offline&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">FriendListItem</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> isOnline = <span class=\"title function_\">useFriendStatus</span>(props.<span class=\"property\">friend</span>.<span class=\"property\">id</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">style</span>=<span class=\"string\">&#123;&#123;</span> <span class=\"attr\">color:</span> <span class=\"attr\">isOnline</span> ? &#x27;<span class=\"attr\">green</span>&#x27; <span class=\"attr\">:</span> &#x27;<span class=\"attr\">black</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;props.friend.name&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Hookså…±ç”¨çš„æ˜¯çŠ¶æ€é€»è¾‘ï¼Œä½¿ç”¨åŒä¸€ä¸ªè‡ªå®šä¹‰Hooksåˆ›å»ºçš„çŠ¶æ€æ˜¯ç›¸äº’éš”ç¦»çš„</strong>ã€‚</p>\n<p>ä½ å¯ä»¥å‘æŒ¥ä½ çš„æƒ³è±¡åŠ›ï¼ŒæŠ½è±¡å…±ç”¨çš„çŠ¶æ€é€»è¾‘ï¼Œä½¿ç”¨ç»„åˆçš„æ–¹å¼ï¼ˆåœ¨å‡½æ•°ä¸­ç»„åˆï¼ŒReactå¹¶ä¸å»ºè®®åœ¨classç»„ä»¶ä¸­ä½¿ç”¨mixinï¼‰æ„å»ºæ–°ç»„ä»¶ï¼Œå‡å°‘ç»„ä»¶ä»£ç é•¿åº¦ã€‚</p>\n<p>å®˜ç½‘ä¸¾äº†ä¸ªéå¸¸ç®€å•å´æ™®éçš„<code>useReducer</code>çš„ä¾‹å­ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">useReducer</span>(<span class=\"params\">reducer, initialState</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [state, setState] = <span class=\"title function_\">useState</span>(initialState);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">dispatch</span>(<span class=\"params\">action</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> nextState = <span class=\"title function_\">reducer</span>(state, action);</span><br><span class=\"line\">    <span class=\"title function_\">setState</span>(nextState);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> [state, dispatch];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Todos</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [todos, dispatch] = <span class=\"title function_\">useReducer</span>(todosReducer, []);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handleAddClick</span>(<span class=\"params\">text</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">dispatch</span>(&#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;add&#x27;</span>, text &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"è¿˜æœ‰ä»€ä¹ˆHooks\"><a href=\"#è¿˜æœ‰ä»€ä¹ˆHooks\" class=\"headerlink\" title=\"è¿˜æœ‰ä»€ä¹ˆHooks\"></a>è¿˜æœ‰ä»€ä¹ˆHooks</h2><ul>\n<li><code>useContext</code>ï¼Œæ¥å—<code>React.createContext</code>ä½œä¸ºå…¥å‚ï¼Œåœ¨æ¯æ¬¡provideræ›´æ–°åï¼Œè‡ªåŠ¨ç”¨æœ€æ–°çš„contexté‡æ¸²æŸ“ã€‚</li>\n<li><code>useReducer</code>ï¼Œç»„ä»¶çŠ¶æ€é€»è¾‘å¾ˆå¤æ‚æ—¶ï¼Œä»£æ›¿<code>useState</code>ä½¿ç”¨</li>\n<li><code>useCallback</code>ï¼Œä¿å­˜ä¸€ä¸ªå’Œå½“å‰çŠ¶æ€ç›¸å…³çš„å‡½æ•°ï¼Œåªæœ‰çŠ¶æ€å˜åŒ–æ—¶ï¼Œå‡½æ•°æ‰ä¼šæ›´æ–°ï¼Œé¿å…é‡å¤åˆ›å»ºå‡½æ•°ã€‚  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> memoizedCallback = <span class=\"title function_\">useCallback</span>(</span><br><span class=\"line\">  <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">doSomething</span>(a, b);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  [a, b]</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></li>\n<li><code>useMemo</code>ï¼Œä¿å­˜ä¸€ä¸ªå’Œå½“å‰çŠ¶æ€ç›¸å…³çš„å€¼ï¼Œåªæœ‰çŠ¶æ€å˜åŒ–æ—¶ï¼Œå€¼æ‰ä¼šé‡æ–°è®¡ç®—ã€‚ä¸æä¾›æ•°ç»„ä»£è¡¨æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ›´æ–°ã€‚</li>\n<li><code>useRef</code>ï¼Œè·å–DOM ref  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">TextInputWithFocusButton</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> inputEl = <span class=\"title function_\">useRef</span>(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"title function_\">onButtonClick</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// `current` points to the mounted text input element</span></span><br><span class=\"line\">    inputEl.<span class=\"property\">current</span>.<span class=\"title function_\">focus</span>();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;inputEl&#125;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;onButtonClick&#125;</span>&gt;</span>Focus the input<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><code>useImperativeMethods</code>ï¼Œæš´éœ²å½“å‰ç»„ä»¶Refç»™çˆ¶ç»„ä»¶</li>\n<li><code>useMutationEffect</code>å’Œ<code>useLayoutEffect</code>ï¼Œç±»ä¼¼<code>useEffect</code>åªæ˜¯åŒæ­¥æ‰§è¡Œï¼Œè€Œä¸”æ‰§è¡Œæ—¶æœºæœ‰åŒºåˆ«</li>\n</ul>\n<p>æ›´å¤šå‚è€ƒ<a href=\"https://reactjs.org/docs/hooks-reference.html\">æ–‡æ¡£ä»‹ç»</a></p>\n<h2 id=\"è¿˜æœ‰é—®é¢˜ï¼Ÿ\"><a href=\"#è¿˜æœ‰é—®é¢˜ï¼Ÿ\" class=\"headerlink\" title=\"è¿˜æœ‰é—®é¢˜ï¼Ÿ\"></a>è¿˜æœ‰é—®é¢˜ï¼Ÿ</h2><ul>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html#do-hooks-cover-all-use-cases-for-classes\">ä¸å¸¸è§çš„æ–¹æ³•å¦‚<code>componentDidCatch</code>æœªæ¥ä¼šæ”¯æŒ</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html#do-hooks-replace-render-props-and-higher-order-components\">èŒƒå¼ä¸Šï¼ŒHooksæ˜¯é«˜é˜¶ç»„ä»¶çš„æ›´ç®€å•å½¢å¼</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate\">å€ŸåŠ©<code>useMemo</code>ï¼Œ<code>shouldComponentUpdate</code>å¯ä»¥æœ‰æ›´å¥½çš„å†™æ³•</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables\"><code>this.foo</code>è¿™ç§å†™æ³•å¯ä»¥ç”¨<code>useRef</code>å®ç°</a> - ä¸ªäººæ„Ÿè§‰æœ‰ç‚¹ä¸ç¬¦åˆç›´è§‰</li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html#should-i-use-one-or-many-state-variables\">state splitå‡†åˆ™ï¼šå°†ä¸€èµ·æ”¹å˜çš„state splitåˆ°ä¸€èµ·</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state\"><code>useEffect</code>éœ€è¦ç”¨åˆ°prevStateï¼ŒprevPropsæ—¶éœ€è¦hack</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html#are-hooks-slow-because-of-creating-functions-in-render\">ä½¿ç”¨Hooksä¸ä¼šæ›´æ…¢ï¼Œåè€Œä¼šæ›´å¿«</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html#under-the-hood\">ideaæ¥æº</a></li>\n</ul>\n<h3 id=\"å®è·µ\"><a href=\"#å®è·µ\" class=\"headerlink\" title=\"å®è·µ\"></a>å®è·µ</h3><p>åˆšå¥½æœ€è¿‘åœ¨æŸç®¡ç†åå°éœ€è¦æœ‰ç”¨æˆ·åˆ—è¡¨é¡µçš„å±•ç¤ºï¼Œé™¤äº†è·å–æ•°æ®çš„å‰¯ä½œç”¨ï¼Œåªæœ‰æ¸²æŸ“çš„åŠŸèƒ½ï¼Œç”¨Hookså®ç°èµ·æ¥å°±å¾ˆè‡ªç„¶ï¼Œè€Œåœ¨åŸæ¥çš„èŒƒå¼ä¸‹ï¼Œå› ä¸ºä¸€ä¸ªé¢å¤–çš„ç½‘ç»œè¯·æ±‚ï¼Œå°±éœ€è¦æŠŠfunctionalç»„ä»¶è½¬æˆclassï¼Œéšä¹‹è€Œæ¥çš„åˆæ˜¯ä¸€ç³»åˆ—çš„æ¨¡æ¿ä»£ç å’Œå£°æ˜å‘¨æœŸå‡½æ•°ã€‚</p>\n<p>ä½¿ç”¨Hooksä¹‹åçš„ä»£ç åƒä¸‹é¢è¿™æ ·ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">UserList</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [users, setUsers] = <span class=\"title function_\">useState</span>([]);</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">fetchData</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> res = <span class=\"keyword\">await</span> <span class=\"title function_\">getUsers</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (res.<span class=\"property\">code</span> === <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">setUsers</span>(res.<span class=\"property\">data</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">fetchData</span>();</span><br><span class=\"line\">    &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;admin-users&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>ç”¨æˆ·ä¿¡æ¯<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">Table</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">columns</span>=<span class=\"string\">&#123;columns&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">dataSource</span>=<span class=\"string\">&#123;users&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">pagination</span>=<span class=\"string\">&#123;false&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä½¿ç”¨åŸæ¥çš„æ¨¡å¼æ—¶ï¼Œå¤§æ¦‚åƒä¸‹é¢è¿™æ ·ï¼š</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">UserList</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>(props);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">            <span class=\"attr\">users</span>: []</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> res = <span class=\"keyword\">await</span> <span class=\"title function_\">getUsers</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (res.<span class=\"property\">code</span> === <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123; <span class=\"attr\">users</span>: res.<span class=\"property\">data</span> &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;admin-users&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>ç”¨æˆ·ä¿¡æ¯<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">Table</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                    <span class=\"attr\">columns</span>=<span class=\"string\">&#123;columns&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                    <span class=\"attr\">dataSource</span>=<span class=\"string\">&#123;this.state.users&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                    <span class=\"attr\">pagination</span>=<span class=\"string\">&#123;false&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è™½ç„¶ä»£ç è¡Œæ•°ç±»ä¼¼ï¼Œä½†æ˜¯ä»£ç ä¿¡å™ªæ¯”å’Œå¯æ‹“å±•æ€§æ˜æ˜¾ä¸Šé¢æ›´ä¼˜ã€‚</p>\n<h2 id=\"æ„Ÿå—ä¸å±•æœ›\"><a href=\"#æ„Ÿå—ä¸å±•æœ›\" class=\"headerlink\" title=\"æ„Ÿå—ä¸å±•æœ›\"></a>æ„Ÿå—ä¸å±•æœ›</h2><p>æˆ‘ç†è§£Hooksçš„ç›®çš„å¹¶ä¸æ˜¯å¼ºè¡ŒæŠŠclassç»„ä»¶é‡Œçš„åŠŸèƒ½ç¡¬å¡åˆ°functionalç»„ä»¶é‡Œï¼ˆè™½ç„¶ä»ç”¨æ³•ä¸Šç¡®å®æœ‰è¿™ç§æ„Ÿè§‰ï¼‰ï¼Œæ¨èä½¿ç”¨funcationalç»„ä»¶çš„å½¢å¼ã€‚è€Œæ˜¯ä¸€æ¬¡<strong>æ–°çš„å¤ç”¨ç»„ä»¶é€»è¾‘æ–¹å¼çš„å°è¯•</strong>ã€‚æ¯•ç«Ÿç»„åˆå‡½æ•°æ¯”ç»„åˆclassç®€å•å¤šäº†ï¼ˆReactå¹¶ä¸å»ºè®®mixinï¼‰ã€‚åŒæ—¶é€šè¿‡ä¸Šé¢çš„ç®€å•å®è·µå¯ä»¥å‘ç°ï¼Œä½¿ç”¨Hooksä¹‹åï¼Œå°‘äº†è®¸å¤š<a href=\"https://en.wikipedia.org/wiki/Spaghetti_code\">Spaghetti code</a>ï¼Œçœ‹ä¸Šå»æ¸…çˆ½äº†è®¸å¤šï¼Œå¯è¯»æ€§ä¹Ÿéšç€æé«˜ã€‚</p>\n<p>ä¸è¿‡å¦ä¸€æ–¹é¢ï¼ŒHooksçš„APIåˆçœ‹ä¸Šå»æŒºç¾ï¼ŒæŒºç®€æ´å¥½ç”¨ï¼Œé‚£æ˜¯å› ä¸ºæœ€å¼€å§‹ä¸¾ä¾‹çš„åœºæ™¯ç®€å•ï¼Œä¸éœ€è¦hackã€‚ç”±äºä½¿ç”¨Hookså°±æ„å‘³ç€ç”¨å…¨ç›˜ç”¨functionçš„å½¢å¼å†™ç»„ä»¶ï¼ŒåŸæ¥ç”¨classå†™æ³•å†™çš„å¤æ‚çš„ä¸šåŠ¡ç»„ä»¶ï¼Œå¦‚æœéƒ½ç”¨Hooksçš„æ–¹å¼å†™ï¼Œä¹Ÿéœ€è¦å¼€å‘è€…å…·æœ‰ä¸€å®šçš„è®¾è®¡æ¨¡å¼æ„è¯†ã€‚åŒæ—¶åœ¨æœ‰äº›åœºæ™¯ï¼ˆæ¯”å¦‚ä¸Šé¢è¯´çš„prevStateï¼ŒprevPropsï¼‰è¦ä½¿ç”¨æ¯”è¾ƒåç›´è§‰çš„æ“ä½œæ‰èƒ½å®Œæˆã€‚æœŸå¾…åé¢Hooks APIä¸æ–­ä¼˜åŒ–åçš„ç»“æœã€‚</p>\n<p>åœ¨é€æ¸ä½¿ç”¨Hooksçš„æ–¹å¼å†™ç»„ä»¶åï¼Œä¸šåŠ¡ä¸­ä¼šæœ‰ä¸€äº›å…±ç”¨çš„HooksæŠ½è±¡å‡ºæ¥ï¼Œæ•´ä¸ªé¡¹ç›®ç›®å½•ç»“æ„ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼ŒHooksæ–‡ä»¶çš„ç®¡ç†æ–¹å¼è¿˜è¦å†å®è·µã€‚æœŸå¾…Hooksèƒ½è®©æ¯ä¸ªæ¨¡å—ä»£ç éƒ½èƒ½å°äº200è¡Œçš„ä¸€å¤©æ›´æ—©åˆ°æ¥ğŸ˜Œã€‚</p>\n",
            "tags": [
                "React",
                "Hooks",
                "å‡½æ•°ç»„ä»¶",
                "å¤ç”¨"
            ]
        }
    ]
}