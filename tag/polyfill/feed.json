{
    "version": "https://jsonfeed.org/version/1",
    "title": "Shenlvmeng's Blog • All posts by \"polyfill\" tag",
    "description": "Be sharp, my friend.",
    "home_page_url": "http://shenlvmeng.github.com/blog",
    "items": [
        {
            "id": "http://shenlvmeng.github.com/blog/2018/11/21/some-tips-5/",
            "url": "http://shenlvmeng.github.com/blog/2018/11/21/some-tips-5/",
            "title": "工作中的遇到的一些小知识 5",
            "date_published": "2018-11-21T15:06:54.000Z",
            "content_html": "<h2 id=\"smooth-scroll\"><a href=\"#smooth-scroll\" class=\"headerlink\" title=\"smooth scroll\"></a>smooth scroll</h2><p>使用<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/scroll\">window.scroll API </a>，从MDN的文档来看，各浏览器的支持情况还不错。</p>\n<p>或者自己通过<code>setTimeout</code>加上ease function实现难度也不大。</p>\n<h2 id=\"React在老版本浏览器或Webview下的支持问题\"><a href=\"#React在老版本浏览器或Webview下的支持问题\" class=\"headerlink\" title=\"React在老版本浏览器或Webview下的支持问题\"></a>React在老版本浏览器或Webview下的支持问题</h2><blockquote>\n<p>[JavaScript Environment Requirements</p>\n</blockquote>\n<ul>\n<li>React](<a href=\"https://reactjs.org/docs/javascript-environment-requirements.html\">https://reactjs.org/docs/javascript-environment-requirements.html</a>)</li>\n</ul>\n<p>React 16依赖于ES6中的Map和Set特性。如果需要React运行在老版本的不支持ES6的浏览器或Webview下，需要<a href=\"https://babeljs.io/docs/en/babel-polyfill\">babel-polyfill</a>或<a href=\"https://github.com/zloirock/core-js\">core-js</a>的支持。</p>\n<p>类似于下面这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;core-js/es6/map&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;core-js/es6/set&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// or</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;babel-polyfill&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react-dom&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, world!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>,</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;root&#x27;</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>需要格外注意的是，不论是import core-js还是import babel-polyfill，<strong>都一定要写在第一次<code>import React from &#39;react&#39;</code>的前面</strong>。否则是起不到polyfill React中ES6特性的效果的。</p>\n<h2 id=\"一些老版本Android的坑\"><a href=\"#一些老版本Android的坑\" class=\"headerlink\" title=\"一些老版本Android的坑\"></a>一些老版本Android的坑</h2><ul>\n<li>在伪元素如<code>:before</code>和<code>:after</code>使用动画会导致crash，<a href=\"https://caniuse.com/#search=%3Abefore\">caniuse</a>的known issues上只是说在safari v6版本和以下会有不支持的情况。</li>\n<li>不支持不带前缀的<code>transform</code>…</li>\n<li>不支持在<code>&lt;line&gt;</code>上的<code>stroke-width</code>属性上使用rem</li>\n<li>不支持Element.matches方法</li>\n</ul>\n<h2 id=\"ffmpeg\"><a href=\"#ffmpeg\" class=\"headerlink\" title=\"ffmpeg\"></a>ffmpeg</h2><blockquote>\n<p>wiki: <a href=\"https://en.wikipedia.org/wiki/FFmpeg\">https://en.wikipedia.org/wiki/FFmpeg</a><br>官网: <a href=\"https://www.ffmpeg.org/\">https://www.ffmpeg.org/</a></p>\n</blockquote>\n<p>主要包含三个命令行指令：</p>\n<ul>\n<li>ffmpeg，多媒体转码</li>\n<li>ffplay，基于SDL和ffmpeg的极简播放器</li>\n<li>ffprobe，多媒体分析</li>\n</ul>\n<p>ffmpeg部分支持参数：</p>\n<ul>\n<li><code>-i</code>指定输入文件</li>\n<li><code>-t</code>处理时间</li>\n<li><code>-ss</code>起始时间</li>\n<li><code>-b:a</code>或<code>-b:v</code>指定音频、视频的输出码率。</li>\n<li><code>-r</code>fps 帧率</li>\n<li><code>-s 1920x1080</code>设置帧大小</li>\n<li><code>-c:a</code>或<code>-c:v</code>设置音频、视频编码器</li>\n<li><code>-ac</code>声道数</li>\n<li><code>-ar</code>音频采样率</li>\n</ul>\n<p><a href=\"https://www.ffmpeg.org/ffmpeg.html#Options\">更多</a></p>\n<h2 id=\"React-Router使用History路由时，不识别带‘-’的路径\"><a href=\"#React-Router使用History路由时，不识别带‘-’的路径\" class=\"headerlink\" title=\"React Router使用History路由时，不识别带‘.’的路径\"></a>React Router使用History路由时，不识别带‘.’的路径</h2><p>webpack-dev-server的配置里，增加<code>disableDotRule</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">historyApiFallback: &#123;</span><br><span class=\"line\">    disableDotRule: true</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>注，这样做会使xxx.html的形式也重定向到默认的index.html，在多入口的项目下会有问题。</p>\n<h2 id=\"React-Hooks和React-Hot-Loader默认配置相冲突\"><a href=\"#React-Hooks和React-Hot-Loader默认配置相冲突\" class=\"headerlink\" title=\"React Hooks和React Hot Loader默认配置相冲突\"></a>React Hooks和React Hot Loader默认配置相冲突</h2><p>设置RHL的<code>pureSFC</code>配置为true，详见<a href=\"https://github.com/gaearon/react-hot-loader/issues/1088#issuecomment-434862175\">讨论</a>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setConfig(&#123; pureSFC: true &#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一个简单的rollup配置样例\"><a href=\"#一个简单的rollup配置样例\" class=\"headerlink\" title=\"一个简单的rollup配置样例\"></a>一个简单的rollup配置样例</h2><p>最近有一个开发前端录音库（严格来说是改进）的需求，目标是发布到npm管理平台上，在打包库上<a href=\"https://rollupjs.org/guide/en\">rollup</a>的发挥要优于webpack。刚好想用用试试，就用了rollup作为打包工具。因为场景比webpack更简单，配置上也比webpack好配很多，基本看看<a href=\"https://rollupjs.org/guide/zh#tutorial\">官方文档</a>就可以上手了。</p>\n<p>不过，文档里用的babel版本还是6.x，使用新版本babel后，配置文件<code>rollup.config.js</code>和<code>.babelrc</code>有些改动，这里列在下面。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// rollup.config.js</span><br><span class=\"line\">import resolve from &#x27;rollup-plugin-node-resolve&#x27;;</span><br><span class=\"line\">import commonjs from &#x27;rollup-plugin-commonjs&#x27;;</span><br><span class=\"line\">import babel from &#x27;rollup-plugin-babel&#x27;;</span><br><span class=\"line\">import &#123; terser &#125; from &quot;rollup-plugin-terser&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">    input: &#x27;src/index.js&#x27;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        file: &#x27;index.js&#x27;,</span><br><span class=\"line\">        format: &#x27;es&#x27;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        resolve(),</span><br><span class=\"line\">        commonjs(),</span><br><span class=\"line\">        babel(&#123;</span><br><span class=\"line\">            exclude: &#x27;node_modules/**&#x27;</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        terser()</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">// .babelrc</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    presets: [</span><br><span class=\"line\">        [</span><br><span class=\"line\">            &#x27;@babel/env&#x27;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                loose: true,</span><br><span class=\"line\">                modules: false</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        [&#x27;@babel/proposal-object-rest-spread&#x27;, &#123; loose: true &#125;]</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em>–END–</em></p>\n",
            "tags": [
                "polyfill",
                "Android",
                "ffmpeg",
                "React Hooks",
                "rollup"
            ]
        }
    ]
}