{
    "version": "https://jsonfeed.org/version/1",
    "title": "Shenlvmeng's Blog • All posts by \"crx\" tag",
    "description": "Be sharp, my friend.",
    "home_page_url": "http://shenlvmeng.github.com/blog",
    "items": [
        {
            "id": "http://shenlvmeng.github.com/blog/2020/04/16/crx-intro/",
            "url": "http://shenlvmeng.github.com/blog/2020/04/16/crx-intro/",
            "title": "Chrome Extension开发须知",
            "date_published": "2020-04-16T15:42:29.000Z",
            "content_html": "<h2 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h2><p>Extension是由HTML、CSS、JavaScript和图片等其他资源文件组成的压缩包。它可以增强浏览器体验，实现个性化。</p>\n<h2 id=\"Files\"><a href=\"#Files\" class=\"headerlink\" title=\"Files\"></a>Files</h2><p>Extension没有做目录的约定，但是它们需要已配置文件的形式写在manifest中。<code>manifest.json</code>中描述了Extension的基本信息、使用能力和重要文件。</p>\n<h3 id=\"manifest-json\"><a href=\"#manifest-json\" class=\"headerlink\" title=\"manifest.json\"></a><code>manifest.json</code></h3><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"comment\">// Required</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;manifest_version&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;My Extension&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;versionString&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Recommended</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;default_locale&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;en&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;A plain text description&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;icons&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Pick one (or none)</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;browser_action&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;page_action&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Optional</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;action&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;author&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;automation&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;background&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// Recommended</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;persistent&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"comment\">// Optional</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;service_worker&quot;</span><span class=\"punctuation\">:</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;chrome_settings_overrides&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;chrome_ui_overrides&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;bookmarks_ui&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;remove_bookmark_shortcut&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;remove_button&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;chrome_url_overrides&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;commands&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;content_capabilities&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;content_scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;content_security_policy&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;policyString&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;converted_from_user_script&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;current_locale&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;declarative_net_request&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;devtools_page&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;devtools.html&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_rules&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;externally_connectable&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;matches&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;*://*.example.com/*&quot;</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;file_browser_handlers&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span>...<span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;file_system_provider_capabilities&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;configurable&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;multiple_mounts&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;source&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;network&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;homepage_url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://path/to/homepage&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;import&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;incognito&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;spanning, split, or not_allowed&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;input_components&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;publicKey&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;minimum_chrome_version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;versionString&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;nacl_modules&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span>...<span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;oauth2&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;offline_enabled&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;omnibox&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;keyword&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aString&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;optional_permissions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;tabs&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;options_page&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;options.html&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;options_ui&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;chrome_style&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;page&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;options.html&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;permissions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;tabs&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;platforms&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;replacement_web_app&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;requirements&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;sandbox&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span>...<span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;short_name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Short Name&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;signature&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;spellcheck&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;storage&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;managed_schema&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;schema.json&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;system_indicator&quot;</span><span class=\"punctuation\">:</span> ...<span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;tts_engine&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>...<span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;update_url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://path/to/updateInfo.xml&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;version_name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aString&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;web_accessible_resources&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span>...<span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>manifest_version</code>表明使用manifest的格式版本号，目前是整数2</li>\n<li><code>icons</code>推荐使用PNG格式</li>\n<li><code>browser_action</code>和<code>page_action</code>类型二选一，前者用于所有页面，后者用于特定一些页面。</li>\n<li><code>background</code>可以指定在后台运行的脚本</li>\n<li><code>chrome</code>打头的三个配置可以定制浏览器本身的UI或行为</li>\n<li><code>commands</code>快捷键配置</li>\n<li><code>content_scripts</code>描述需要声明式插入的规则</li>\n<li><code>devtools_page</code>描述自定义的devtools选项卡</li>\n<li><code>externally_connectable</code>描述其他能够连接到该Extension的url规则</li>\n<li><code>omnibox</code>配置关键词当用户在地址栏输入特定字符时，变成与Extension交互</li>\n<li><code>permissions</code>显式声明Extension需要使用的权限</li>\n</ul>\n<p>Extension中的文件路径类似HTML中，通常使用相对路径访问。在使用绝对路径时，需要使用<code>chrome-extension://&lt;extensionID&gt;/&lt;pathToFile&gt;</code>风格的路径，可以使用<code>chrome.runtime.getURL()</code>得到某资源的绝对路径。</p>\n<h3 id=\"browser-action\"><a href=\"#browser-action\" class=\"headerlink\" title=\"browser_action\"></a>browser_action</h3><p>下面是一个browser_action的manifest样例。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// browser action</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;My extension&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"attr\">&quot;browser_action&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;default_icon&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>                    <span class=\"comment\">// optional</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;16&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;images/icon16.png&quot;</span><span class=\"punctuation\">,</span>           <span class=\"comment\">// optional</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;24&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;images/icon24.png&quot;</span><span class=\"punctuation\">,</span>           <span class=\"comment\">// optional</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;32&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;images/icon32.png&quot;</span>            <span class=\"comment\">// optional</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;default_title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Google Mail&quot;</span><span class=\"punctuation\">,</span>      <span class=\"comment\">// optional; shown in tooltip</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;default_popup&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;popup.html&quot;</span>        <span class=\"comment\">// optional</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>browser_action的UI可以包括icon、tooltip、badge、popup。</p>\n<ul>\n<li>icon，可以是图片文件或HTML5 canvas元素。后者可以动态创建，以提供更流畅的效果。</li>\n<li>tooltip，即配置文件中的title</li>\n<li>badge，用于描述Extension工作状态的徽章，最长4个字符，可以调用browserAction API动态修改内容或背景色</li>\n<li>popup，点击Extension按钮弹窗的窗口，可以包含任意HTML内容，可以在<code>default_popup</code>中定义，或调用API动态修改</li>\n</ul>\n<p>browser_action有下面一些最佳实践：</p>\n<ul>\n<li>在Extension作用于<strong>大多数页面</strong>时使用，在作用于<strong>少数页面</strong>时使用page_action</li>\n<li>使用更多彩和重的图标，体现出和轻量级page_action的区别</li>\n<li>不要模仿chrome内置图标，会造成误解</li>\n<li>注意图标在不同主题背景色下的表现形态</li>\n<li>不要使用动图，会引起用户焦虑</li>\n</ul>\n<h3 id=\"page-action\"><a href=\"#page-action\" class=\"headerlink\" title=\"page_action\"></a>page_action</h3><p>更轻量级。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// page action</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;My extension&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"attr\">&quot;page_action&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;default_icon&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>                    <span class=\"comment\">// optional</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;16&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;images/icon16.png&quot;</span><span class=\"punctuation\">,</span>           <span class=\"comment\">// optional</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;24&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;images/icon24.png&quot;</span><span class=\"punctuation\">,</span>           <span class=\"comment\">// optional</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;32&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;images/icon32.png&quot;</span>            <span class=\"comment\">// optional</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;default_title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Google Mail&quot;</span><span class=\"punctuation\">,</span>      <span class=\"comment\">// optional; shown in tooltip</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;default_popup&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;popup.html&quot;</span>        <span class=\"comment\">// optional</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>UI上没有badge，其余和browser_action一致。另外，在非指定页面下，会有灰度展示。最佳实践同上。</p>\n<h2 id=\"架构\"><a href=\"#架构\" class=\"headerlink\" title=\"架构\"></a>架构</h2><p>除了manifest描述项目结构外，需要另外一些组件组成完整的Extension功能。</p>\n<ul>\n<li>background script，Extension的事件handler，用于监听对于Extension来说重要的浏览器事件</li>\n<li>UI元素，有多种体现形式，如右键菜单，omnibox，点击按钮的弹出层等</li>\n<li>content scripts，用于和页面交互的js脚本。它可以传递消息给Extension的其他部分</li>\n<li>options page，用于配置Extension的页面</li>\n</ul>\n<p>下面是一些详细介绍</p>\n<h3 id=\"background-scripts\"><a href=\"#background-scripts\" class=\"headerlink\" title=\"background scripts\"></a>background scripts</h3><p>有效率的后台脚本应该由浏览器事件触发，执行命令之后卸载。这部分脚本在manifest的<code>background</code>中声明。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Awesome Test Extension&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"attr\">&quot;background&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;background.js&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;persistent&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>在<code>scripts</code>可以指定需要执行的多个后台脚本。<code>persistent</code>需要指定为false。只有使用了<code>chrome.webRequest</code>API的后台脚本才指定persistent为true。</p>\n<p>使用上，</p>\n<ol>\n<li>在Extension加载时，初始化一次性配置。</li>\n<li>添加监听函数，一些监听函数还提供更多参数便于筛选事件。</li>\n<li>在监听函数内，实现业务逻辑</li>\n<li>在卸载前，执行持久化数据、释放请求等操作</li>\n</ol>\n<h3 id=\"content-scripts\"><a href=\"#content-scripts\" class=\"headerlink\" title=\"content scripts\"></a>content scripts</h3><p>Content scripts运行在页面的执行环境下，通过DOM访问页面元素并和所在的Extension交互。它还可以调用Chrome APIs完成一些原生操作。Content scripts执行在和页面JS脚本相隔离的环境里，两者共享1个DOM。</p>\n<p>Content scripts有两种执行方式，命令式插入或声明式插入。前者通过<code>chrome.tabs.executeScript</code>实现，后者通过在manifest中声明实现在访问特定url时自动加载js文件：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"> <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;My extension&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"> ...</span><br><span class=\"line\"> <span class=\"attr\">&quot;content_scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">     <span class=\"attr\">&quot;matches&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;http://*.nytimes.com/*&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">     <span class=\"attr\">&quot;css&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;myStyles.css&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">     <span class=\"attr\">&quot;js&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;contentScript.js&quot;</span><span class=\"punctuation\">]</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"> ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>Content scripts和页面脚本虽然是隔离开的，但共享一个DOM，可以通过<code>window.postMessage</code>沟通和传递消息。</p>\n<h2 id=\"Chrome-API\"><a href=\"#Chrome-API\" class=\"headerlink\" title=\"Chrome API\"></a>Chrome API</h2><p>Extension使用特定的Chrome API在浏览器的环境下执行原生操作。API绝大多数都是异步的，这意味着如果想知道操作的结果，需要在回调函数中进行操作。Chrome的所有API都整合在Chrome这个namespace下，根据类型拆分成多个子模块，如chrome.runtime。</p>\n<h2 id=\"页面通信\"><a href=\"#页面通信\" class=\"headerlink\" title=\"页面通信\"></a>页面通信</h2><p>由于content scripts运行在网页环境下，它通常需要和Extension本身进行通信。</p>\n<ul>\n<li>一次性通信，content scripts端使用<code>chrome.runtime.sendMessage</code>，Extension端使用<code>chrome.tabs.sendMessage</code>。接收侧一律使用<code>chrome.runtime.onMessage.addListener</code></li>\n<li>持久性连接，类似上面使用<code>chrome.runtime.connect</code>或<code>tabs.connect</code>，详见<a href=\"https://developer.chrome.com/extensions/messaging#connect\">文档</a></li>\n<li>跨Extension通信，使用<code>chrome.onMessageExternal</code>或<code>runtime.onConnectExternal</code>接收事件，发送事件可以使用上面的一次性通信或持久性连接的方式</li>\n</ul>\n",
            "tags": [
                "chrome",
                "crx",
                "扩展"
            ]
        }
    ]
}