<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/favicon.png">
  <link rel="mask-icon" href="/blog/favicon.png" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shenlvmeng.github.com","root":"/blog/","images":"/blog/images","scheme":"Muse","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"01WTSQD4O5","apiKey":"594aedcbfa1fad5b80958ce48f1bc16a","indexName":"blog","hits":{"per_page":10}}}</script><script src="/blog/js/config.js"></script>

    <meta name="description" content="全文参考自马丁大叔的《架构整洁之道》，书中文笔清爽易懂，不过在后半段有点条理不清流于术而非道  在编程领域，问题就像一个生命体一样，是在不断繁殖和进化的。它甚至经常不会人们预期中一般发展。作为一名出色的软件工程师或架构师，你需要有超出普通程序员的视角，考虑系统宏观的未来的发展。你的使命是，在这种恶劣的开发环境下，绘制一幅相对最优的图纸，用最少的时间、人力、金钱构建和维护一个随时可能融化在熵增热汤">
<meta property="og:type" content="article">
<meta property="og:title" content="《架构整洁之道》—— 软件设计的思考">
<meta property="og:url" content="http://shenlvmeng.github.com/blog/2021/03/22/clean-architecture/">
<meta property="og:site_name" content="Shenlvmeng&#39;s Blog">
<meta property="og:description" content="全文参考自马丁大叔的《架构整洁之道》，书中文笔清爽易懂，不过在后半段有点条理不清流于术而非道  在编程领域，问题就像一个生命体一样，是在不断繁殖和进化的。它甚至经常不会人们预期中一般发展。作为一名出色的软件工程师或架构师，你需要有超出普通程序员的视角，考虑系统宏观的未来的发展。你的使命是，在这种恶劣的开发环境下，绘制一幅相对最优的图纸，用最少的时间、人力、金钱构建和维护一个随时可能融化在熵增热汤">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-22T15:47:20.000Z">
<meta property="article:modified_time" content="2021-05-08T15:11:37.419Z">
<meta property="article:author" content="shenlvmeng">
<meta property="article:tag" content="设计">
<meta property="article:tag" content="架构">
<meta property="article:tag" content="组件">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://shenlvmeng.github.com/blog/2021/03/22/clean-architecture/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://shenlvmeng.github.com/blog/2021/03/22/clean-architecture/","path":"2021/03/22/clean-architecture/","title":"《架构整洁之道》—— 软件设计的思考"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>《架构整洁之道》—— 软件设计的思考 | Shenlvmeng's Blog</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Shenlvmeng's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%A0%E8%A6%81%E5%81%9A%E4%BB%80%E4%B9%88"><span class="nav-number">1.</span> <span class="nav-text">你要做什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F"><span class="nav-number">2.</span> <span class="nav-text">编程范式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E7%BC%96%E7%A8%8B"><span class="nav-number">2.1.</span> <span class="nav-text">结构化编程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="nav-number">2.2.</span> <span class="nav-text">面向对象编程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">函数式编程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="nav-number">3.</span> <span class="nav-text">设计原则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SRP"><span class="nav-number">3.1.</span> <span class="nav-text">SRP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OCP"><span class="nav-number">3.2.</span> <span class="nav-text">OCP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LSP"><span class="nav-number">3.3.</span> <span class="nav-text">LSP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP"><span class="nav-number">3.4.</span> <span class="nav-text">ISP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DIP"><span class="nav-number">3.5.</span> <span class="nav-text">DIP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E6%9E%84%E5%BB%BA"><span class="nav-number">4.</span> <span class="nav-text">组件构建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6"><span class="nav-number">4.1.</span> <span class="nav-text">组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E8%81%9A%E5%90%88"><span class="nav-number">4.2.</span> <span class="nav-text">组件聚合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E8%80%A6%E5%90%88"><span class="nav-number">4.3.</span> <span class="nav-text">组合耦合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="nav-number">5.</span> <span class="nav-text">软件架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8B%AC%E7%AB%8B%E6%80%A7"><span class="nav-number">5.1.</span> <span class="nav-text">独立性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%92%E5%88%86%E8%BE%B9%E7%95%8C"><span class="nav-number">5.2.</span> <span class="nav-text">划分边界</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%B9%E7%95%8C%E5%89%96%E6%9E%90"><span class="nav-number">5.3.</span> <span class="nav-text">边界剖析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%E5%92%8C%E5%B1%82%E6%AC%A1"><span class="nav-number">5.4.</span> <span class="nav-text">策略和层次</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91"><span class="nav-number">5.5.</span> <span class="nav-text">业务逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%9C%E5%B0%96%E5%8F%AB%E2%80%9D%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="nav-number">5.6.</span> <span class="nav-text">“尖叫”的软件架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84"><span class="nav-number">5.7.</span> <span class="nav-text">整洁架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Main%E7%BB%84%E4%BB%B6"><span class="nav-number">5.8.</span> <span class="nav-text">Main组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%EF%BC%9A%E5%BE%AE%E8%A7%82%E5%92%8C%E5%AE%8F%E8%A7%82"><span class="nav-number">5.9.</span> <span class="nav-text">服务：微观和宏观</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E6%B4%81%E7%9A%84%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%9E%B6%E6%9E%84"><span class="nav-number">5.10.</span> <span class="nav-text">整洁的嵌入式架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="nav-number">6.</span> <span class="nav-text">实现细节</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E8%A7%86%E9%A2%91%E9%94%80%E5%94%AE%E7%BD%91%E7%AB%99"><span class="nav-number">6.1.</span> <span class="nav-text">案例：视频销售网站</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="shenlvmeng"
      src="/blog/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">shenlvmeng</p>
  <div class="site-description" itemprop="description">Be sharp, my friend.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">143</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">424</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/shenlvmeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shenlvmeng" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/shenlvmeng" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;shenlvmeng" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shenlvmeng.github.com/blog/2021/03/22/clean-architecture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
      <meta itemprop="name" content="shenlvmeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shenlvmeng's Blog">
      <meta itemprop="description" content="Be sharp, my friend.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="《架构整洁之道》—— 软件设计的思考 | Shenlvmeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《架构整洁之道》—— 软件设计的思考
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-22 23:47:20" itemprop="dateCreated datePublished" datetime="2021-03-22T23:47:20+08:00">2021-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-05-08 23:11:37" itemprop="dateModified" datetime="2021-05-08T23:11:37+08:00">2021-05-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">工程</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/blog/2021/03/22/clean-architecture/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/03/22/clean-architecture/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p>全文参考自马丁大叔的《架构整洁之道》，书中文笔清爽易懂，不过在后半段有点条理不清流于术而非道</p>
</blockquote>
<p>在编程领域，问题就像一个生命体一样，是在不断繁殖和进化的。它甚至经常不会人们预期中一般发展。作为一名出色的软件工程师或架构师，你需要有超出普通程序员的视角，考虑系统宏观的未来的发展。你的使命是，在这种恶劣的开发环境下，绘制一幅相对最优的图纸，用最少的时间、人力、金钱构建和维护一个随时可能融化在熵增热汤里的软件系统。和现实物理世界里的架构师类似，你需要了解编程世界里的一般规律，帮助你挑选武器（技术），修炼秘籍（方法论），在不同的江湖里（业务）打造不同的门派（软件系统）。</p>
<p>开卷有益，祝你练武愉快~</p>
<h2 id="你要做什么"><a href="#你要做什么" class="headerlink" title="你要做什么"></a>你要做什么</h2><p>简而言之，架构师的终极目标就是<strong>用最少的人力成本来满足构建和维护软件系统的需求</strong>。糟糕的架构设计会让软件在成功之前，就带来高昂的边际人力成本，即开发新需求的开支越来越大（因为程序员的时间都耗费在系统的修修补补上了）。然而，这种日益增长的边际人力成本现象并不少见。来源于类似龟兔赛跑中兔子的盲目自信，实际上，<strong>无论从短期还是长期看，胡乱编写代码的工作速度其实比循规蹈矩更慢</strong>。</p>
<p>架构师存在的一个必要性就是，软件存在着两种价值维度：</p>
<ul>
<li><strong>行为价值（现在时）</strong>：即实现功能和弥补bug。这类价值是<strong>紧急却并不总是重要的</strong>。</li>
<li><strong>架构价值（将来时）</strong>：即软件是否足够“软”（易于被修改），这类价值是<strong>重要却并不总是紧急的</strong>。</li>
</ul>
<p>很现实的一点是，在公司中，<strong>团队之间的抗争本来就是无穷无尽的</strong>。你作为研发团队的一员，职责的一部分就是避免你的代码在抗争的风吹雨打下变成一坨没人爱的shit。</p>
<h2 id="编程范式"><a href="#编程范式" class="headerlink" title="编程范式"></a>编程范式</h2><p>没错，架构师们也有祖师爷。在1958到1968年期间，3大编程范式就已经陆续出现了。</p>
<ul>
<li><strong>结构化编程</strong>，由Dijkstra在1968年提出，并发扬光大，<strong>它对程序控制权的直接转移（程序语句）进行了限制和规范</strong></li>
<li><strong>面向对象编程</strong>，最早在1966年提出，Ole Johan Dahl和Kriste Nygaard注意到，函数调用堆栈可以被放到堆内存中，从而在函数返回后继续保留。<strong>它对程序控制权的间接转移（函数调用）进行了限制和规范</strong></li>
<li><strong>函数式编程</strong>，启发自Alonzo Church于1936年发明的lambda演算，发扬于1958年的LISP语言。<strong>它对程序的赋值进行了限制和规范</strong></li>
</ul>
<p>值得思考是，三大范式做的都是<strong>限制和规范</strong>，即告诉我们<strong>不能做什么</strong>，而不是可以做什么。另外，多态带来的架构边界飞跃，函数式编程带来的数据访问限制，结构化编程带来的算法拆解为我们架构软件提供了强大武器。这也与软件架构的三个关注点所契合：</p>
<ul>
<li><strong>功能性</strong>，即完整的功能实现</li>
<li><strong>组件独立性</strong>，即合适的耦合度与细粒度</li>
<li><strong>数据管理</strong>，即良好的数据结构设计</li>
</ul>
<h3 id="结构化编程"><a href="#结构化编程" class="headerlink" title="结构化编程"></a>结构化编程</h3><p>Dijkstra在1950年代思考编程时，得出过一个结论：编程是一项<strong>难度很大</strong>的活动。他倾向于把编程类比为数学推导过程，并发现<code>goto</code>的<strong>某些使用</strong>会导致<strong>模块无法被递归拆解成更小的单元</strong>。然而，去掉这些使用的<code>goto</code>可以被<strong>顺序结构、分支结构、循环结构这三种最小集</strong>等价表示出来。从而，大问题可以被逐步拆解为小问题。</p>
<p>不过，事情也并非这么理想，当程序复杂后，我们不可能像Dijkstra一样，用严格的数学推导形式化证明编程的正确性。相反，类似实验学科的<strong>无法被证伪即正确</strong>，我们现今依旧使用着Dijkstra的结构化编程思路将大问题拆解为小问题。</p>
<blockquote>
<p>有趣的是，“无法被证伪即正确”和Dijkstra的一个观点<strong>“测试只能展示bug的存在，并不能证明不存在bug”</strong>不谋而合</p>
</blockquote>
<p>简而言之，去掉goto糟粕诞生的结构化编程中，最有价值的地方就是，它赋予我们创造<strong>可证伪程序单元</strong>的能力，从而架构起大程序。在架构设计领域，<strong>功能性拆解仍然是最佳实践之一</strong>。</p>
<blockquote>
<p>什么？什么叫做可证伪？你应该写过单元测试吧。</p>
</blockquote>
<h3 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h3><p>什么是面向对象？有人说面向对象是“数据和函数的组合”，也有人说是“对真实世界的一种建模方式”。但这两种理解要么片面，要么虚无缥缈。为了总结这种范式，我们先从它的3大特征入手：</p>
<ul>
<li><strong>封装</strong>，即将一组关联数据和函数圈起来。然而这种特性，从C语言起就支持（struct + 头文件），很难说它是面向对象编程的必要条件</li>
<li><strong>继承</strong>，即可以在某个作用域对外部定义的一组变量与函数进行覆盖。不过C语言也能模拟出这种能力，看起来也比较勉强。</li>
<li><strong>多态</strong>，即在同一接口描述下的不同具体实现形式，C语言起也做了支持（STDOUT），然而使用函数指针显式实现多态问题就在于指针的<strong>危险性</strong>。而面向对象编程对这种程序间接控制权的转移做了约束。</li>
</ul>
<p>传统的函数调用树中，系统行为决定了自上而下的控制流，而控制流决定了<strong>源代码依赖</strong>（代码实现）是自上而下的，比如在C中会使用<code>#include</code>引入依赖。此时不论是代码实现还是代码执行都是自上而下的。然而在<strong>多态</strong>的帮助下，底层函数需要依赖高层接口实现，作为高层函数的插件引入，从而将这种依赖关系和控制流反向，即<strong>依赖反转</strong>。实际上，借助安全便利的多态实现，可以轻松将依赖关系反转。</p>
<p>从而架构师可以<strong>完全控制</strong>这种方式下，系统中所有的源代码依赖关系，进而随意更改源代码依赖关系。让每个组件都有<strong>独立部署</strong>和<strong>独立开发</strong>能力。好了，我们现在可以说明面向对象编程的含义了：</p>
<p>面向对象编程就是以多态为手段来对源代码中的依赖关系进行控制的能力。这种能力让架构师可以构建<strong>插件式架构</strong>，让高层<strong>策略性组件</strong>和底层<strong>实现性组件</strong>相分离。借助接口，底层实现性组件作为插件，可以独立于高层组件开发和部署。</p>
<h3 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h3><p>函数式编程依据的原理早在编程之前就已出现，相对前两种范式，函数式编程的风格可能相对陌生一点。在这类风格中，变量都是不可变的。从而让竞争问题、死锁问题、并发更新问题不复存在。一个架构良好的系统，需要将状态修改的部分和不需要修改的部分隔离开，然后用类似事务型内存的方式来保护可变量。另外，架构师应该着力于将大部分逻辑归于不可变组件中，可变组件的逻辑越少越好。</p>
<p>书中还提到了只包含CR的事件溯源存储逻辑，即通过事务日志的方式保存当前状态。因为不存在更改和删除，从而不存在并发问题。也是一种很新颖的思路。</p>
<p>回顾上面的三种编程范式，都在说什么<strong>不应该做</strong>。也即编程好似在充满死路的熵增旷野中，只有沿着相对安全的几个大方向才可拨开迷雾。</p>
<h2 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h2><p>软件的中层需要具有良好的可读性、可扩展性。这里就不得不提到SOLID原则：</p>
<ul>
<li>SRP：<strong>单一职责原则</strong>，每个模块有且只有一个需要被改变的理由</li>
<li>OCP：<strong>开闭原则</strong>，对扩展开放，对修改封闭</li>
<li>LSP：<strong>里氏替换原则</strong>，子类型应该能够无无缝替换类型使用</li>
<li>ISP：<strong>接口隔离原则</strong>，依赖的模块不要包含不需要的接口</li>
<li>DIP：<strong>依赖反转原则</strong>，高层策略性代码不要依赖底层实现性代码</li>
</ul>
<h3 id="SRP"><a href="#SRP" class="headerlink" title="SRP"></a>SRP</h3><p>任何一个软件模块（一组紧密相关的函数和数据结构）都应该只对一个行为者负责。实际上，代码和数据就是靠着和某一类行为者的相关性组合起来的。我们需要<strong>将服务不同行为者的代码进行切分</strong>。</p>
<h3 id="OCP"><a href="#OCP" class="headerlink" title="OCP"></a>OCP</h3><p>设计良好的软件应该易于扩展，同时抗拒修改。实现方式可以通过将系统划分为一系列组件，并且将依赖关系按层次组织，使得高阶组件不会因为低阶组件修改受到影响。</p>
<h3 id="LSP"><a href="#LSP" class="headerlink" title="LSP"></a>LSP</h3><p>里氏替换原则表示，子类型应该能够被当做父类型使用。它实际上表示了一种面向接口设计的设计原则。一旦违背了这种可替换性，就会不得不在系统架构中增加大量复杂的应对机制。</p>
<h3 id="ISP"><a href="#ISP" class="headerlink" title="ISP"></a>ISP</h3><p>ISP告诉我们任何软件设计如果依赖了不需要的东西，都是不好的迹象，很容易带来不必要的麻烦。</p>
<h3 id="DIP"><a href="#DIP" class="headerlink" title="DIP"></a>DIP</h3><p>DIP告诉我们，应该多引用抽象类型，而不是具体实现。因为软件是经常变动的，而抽象出共性的接口则是较少变化的。从而可以衍生出一些守则，譬如：</p>
<ul>
<li>应该多使用抽象接口，避免使用多变的实现类</li>
<li>不要在实现类上创建衍生类</li>
<li>不要覆盖具体实现的函数</li>
</ul>
<p>不过当然了，还是得有人做实现的脏活累活的</p>
<h2 id="组件构建"><a href="#组件构建" class="headerlink" title="组件构建"></a>组件构建</h2><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p>组件是构建软件的最小单元，同时也是源代码的集合。在早期会使用链接技术将程序和库函数链接起来，而后随着机器性能的增长，我们会在程序运行中插入动态链接文件，如今这种组件化插件式架构是最常见的软件构建形式。</p>
<h3 id="组件聚合"><a href="#组件聚合" class="headerlink" title="组件聚合"></a>组件聚合</h3><p>和类相似，组件也有一些原则指引我们的构建工作。</p>
<ul>
<li>REP：复用&#x2F;发布原则，即可以一起发布的最小粒度就是复用的最小粒度，也即按可以同时发布聚合</li>
<li>CCP：共同闭包原则，即因为同一原因修改的放在一起，反之不要放在一起，也即按变更原因聚合</li>
<li>CRP：共同复用原则，即会被一起复用的放在一起，反之不要放在一起，也即按减少无用耦合聚合</li>
</ul>
<p>这三大原则相互牵制，在项目的不同阶段，某一原则重要性也会不同；比如在项目早期CCP就会更重要，而后REP会比较重要。</p>
<h3 id="组合耦合"><a href="#组合耦合" class="headerlink" title="组合耦合"></a>组合耦合</h3><p>本节提出了一些可以定量衡量耦合健康度的指标，比较新颖。</p>
<ul>
<li>无依赖环原则：依赖关系中不能有环，会不利于厘清依赖关系；可以通过<strong>依赖反转</strong>或<strong>创建第三方依赖组件</strong>解决。循环依赖关系务必持续监控。</li>
<li>稳定依赖原则：依赖关系必须指向稳定的方向，简单点说就是让经常变更的组件依赖于不经常变更的组件。一个组件的位置稳定性可以通过入向和出向依赖算出，它要能和组件的实际稳定性匹配。</li>
<li>稳定抽象原则：抽象化程度需要和稳定性程度一直，即经常变更的组件要容易变更，即更具体实现；反之，稳定的组件要不容易变更，即更抽象。结合上条看，依赖关系应该指向更抽象的方向。</li>
</ul>
<p>使用位置稳定性指标I和抽象程度A，可以绘制一个坐标系。在主序列上的是最健康的，相反的两块痛苦区和无用区则是不健康的表现。用偏离主序列线的距离可以大致衡量依赖关系的健康程度。结合发布版本的变化来看，还可以得到变化趋势。</p>
<h2 id="软件架构"><a href="#软件架构" class="headerlink" title="软件架构"></a>软件架构</h2><p>软件架构目的就是方便在工作中更好地对组件进行研发、部署、运行和维护。其中的策略就是<strong>保留尽可能多的可选项</strong>。让系统最大化程序员的生产力，同时最小化系统运营成本：</p>
<ul>
<li>开发：系统架构需要方便开发团队对它的开发，不同的团队结构应该采用不同的架构设计，比如团队的大小就会影响架构的选择</li>
<li>部署：一键式部署</li>
<li>运行：几乎任何运行问题都可以通过增加硬件来解决</li>
<li>维护：减小新功能和系统缺陷占用的人力资源</li>
</ul>
<p>保持可选项，忽略那些无关紧要的实现细节。任何软件系统都可以拆解成<strong>策略</strong>（业务的宏观逻辑和流程）和<strong>细节</strong>（具体操作行为）。而<strong>策略才是系统的真正价值所在</strong>。细节是指那些和策略交互的东西，包括:</p>
<ul>
<li>I&#x2F;O设备</li>
<li>数据库</li>
<li>Web系统</li>
<li>服务器</li>
<li>框架</li>
<li>交互协议</li>
</ul>
<p>在设计时，可以尽量拖延上面这些的设计，这样我们做出的决策才不会依赖各种很容易变化的信息。另一方面，也可以<strong>增加实现底层的可替换性</strong>。举个具体例子：<strong>设备无关性</strong>。</p>
<h3 id="独立性"><a href="#独立性" class="headerlink" title="独立性"></a>独立性</h3><p>一个良好的架构应支持下面几点：</p>
<ul>
<li>系统用例：设计良好的架构需要能够<strong>看起来</strong>就可以反映系统的设计意图，比如一个购物车应用架构应该看起来就该是用来实现购物车的</li>
<li>系统运行：可以解耦出多个独立服务，然后通过某种网络协议通信，这种架构即微服务</li>
<li>系统维护</li>
<li>系统开发</li>
<li>系统部署：理想的独立部署应该能够做到<strong>热更新</strong></li>
</ul>
<p>要注意留意表面的重复和实际的重复，如果两段代码变更速率和缘由不同，那么就不算是真正的重复。</p>
<h3 id="划分边界"><a href="#划分边界" class="headerlink" title="划分边界"></a>划分边界</h3><ul>
<li>设计良好的系统架构不应该依赖细节，而应该尽可能推迟细节性的决策。通过划清边界，可以推迟和延后细节性的决策，从而节省大量时间，避免问题。</li>
<li>边界线应该画在不相干的事情中间，譬如GUI和业务逻辑</li>
<li>针对核心业务逻辑的插件式架构可以提高可维护性和可扩展性</li>
</ul>
<h3 id="边界剖析"><a href="#边界剖析" class="headerlink" title="边界剖析"></a>边界剖析</h3><p>简言之，应该尽可能从底层组件指向高层组件。</p>
<h3 id="策略和层次"><a href="#策略和层次" class="headerlink" title="策略和层次"></a>策略和层次</h3><ul>
<li>变更原因、时间和层次不同的策略应该属于不同的组件</li>
<li>按距离系统输入、输出距离的远近，可以确定策略的层次</li>
<li>源码间的依赖关系，应该主要和组件所在的层次挂钩</li>
<li>低层组件应该以插件的方式依赖高层组件</li>
</ul>
<h3 id="业务逻辑"><a href="#业务逻辑" class="headerlink" title="业务逻辑"></a>业务逻辑</h3><p><strong>业务逻辑是程序中真正用于或者体现赚钱&#x2F;省钱的逻辑与过程</strong>。其中关键逻辑和关键数据紧密组合成为<strong>业务实体</strong>。业务实体应该只有高层逻辑，没有具体实现。而<strong>用例</strong>是业务实体在不同侧面的具体体现。通过用例可以规范用户和业务实体的交互方式。</p>
<h3 id="“尖叫”的软件架构"><a href="#“尖叫”的软件架构" class="headerlink" title="“尖叫”的软件架构"></a>“尖叫”的软件架构</h3><p>“尖叫”即所见即所得。软件架构本身就足以能够体现其用途。一个良好的架构设计应该围绕用例展开，推迟和延后框架的选择，不要过度拘泥于框架。<strong>框架只是一个可选项</strong>，是一个工具，而不是一种信念，更不是一种架构。</p>
<h3 id="整洁架构"><a href="#整洁架构" class="headerlink" title="整洁架构"></a>整洁架构</h3><p>一些常见的系统架构通常具有以下特点：</p>
<ul>
<li>独立于框架</li>
<li>可被测试</li>
<li>独立于UI</li>
<li>独立于数据库</li>
<li>独立于外部接口</li>
</ul>
<h3 id="Main组件"><a href="#Main组件" class="headerlink" title="Main组件"></a>Main组件</h3><ul>
<li>Main组件包含了系统中最细节化最底层的策略，它应该在做完脏活累活后，将程序的控制权交给最高抽象层的代码去执行</li>
<li>针对不同系统可以配置不同的Main组件，即将Main组件视为应用程序的一个插件</li>
</ul>
<h3 id="服务：微观和宏观"><a href="#服务：微观和宏观" class="headerlink" title="服务：微观和宏观"></a>服务：微观和宏观</h3><ul>
<li>系统的架构边界事实上并不落在服务之间，而是<strong>穿透</strong>所有服务，在服务内以组件形式存在</li>
<li>服务可以提升系统的可扩展性和可开发性，不过服务却并不能代表整个系统的架构设计</li>
</ul>
<h3 id="整洁的嵌入式架构"><a href="#整洁的嵌入式架构" class="headerlink" title="整洁的嵌入式架构"></a>整洁的嵌入式架构</h3><ul>
<li>固件即对平台或硬件的强依赖代码，在固件和软件之间可以设置HAL（硬件抽象层），为它上层的软件提供服务，它可以帮助软件<em>脱离</em>目标硬件平台来测试</li>
<li>类似地，我们还可以引入OSAL（操作系统抽象层）来减少软件对操作系统的依赖</li>
</ul>
<h2 id="实现细节"><a href="#实现细节" class="headerlink" title="实现细节"></a>实现细节</h2><p>那么什么算是实现细节呢？</p>
<ul>
<li><strong>数据库</strong>，数据的组织结构和模型都是系统架构的一部分，但是从磁盘中存储&#x2F;读取数据的机制或手段则没那么重要，就比如数据库或静态文件</li>
<li><strong>Web</strong>，Web只是UI，只是一种I&#x2F;O设备</li>
<li><strong>应用框架</strong>，框架被创造的目的是解决作者遇到的问题，它要求我们去阅读文档，按照作者的要求整合到我们的应用中，可以使用但是不要被框架绑定</li>
</ul>
<h3 id="案例：视频销售网站"><a href="#案例：视频销售网站" class="headerlink" title="案例：视频销售网站"></a>案例：视频销售网站</h3><ul>
<li>系统架构设计的第一步是识别系统中的各种角色和用例</li>
</ul>
<p><em>–END–</em></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/%E8%AE%BE%E8%AE%A1/" rel="tag"># 设计</a>
              <a href="/blog/tags/%E6%9E%B6%E6%9E%84/" rel="tag"># 架构</a>
              <a href="/blog/tags/%E7%BB%84%E4%BB%B6/" rel="tag"># 组件</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/2021/01/29/zen-of-unix/" rel="prev" title="Unix编程艺术集萃">
                  <i class="fa fa-chevron-left"></i> Unix编程艺术集萃
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/2021/09/10/trunk-based-development/" rel="next" title="Trunk Based Development（主干开发）介绍">
                  Trunk Based Development（主干开发）介绍 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2014 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shenlvmeng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.14.3/algoliasearch-lite.umd.js" integrity="sha256-dyJcbGuYfdzNfifkHxYVd/rzeR6SLLcDFYEidcybldM=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.49.2/instantsearch.production.min.js" integrity="sha256-Nu8yqoXoRZEVYyZf4/eY1V4FsenbiCw85RY3gWjN3zQ=" crossorigin="anonymous"></script><script src="/blog/js/third-party/search/algolia-search.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/blog/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"shenlvmengs-blog","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/blog/js/third-party/comments/disqus.js"></script>

</body>
</html>
